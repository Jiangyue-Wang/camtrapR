<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Optical character recognition (OCR) from data fields in digital images — OCRdataFields • camtrapR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Optical character recognition (OCR) from data fields in digital images — OCRdataFields"><meta property="og:description" content="Extracts information from the data fields in camera trap images (not the
metadata). Many camera traps include data fields in camera trap images,
often including date and time of images, and sometimes other information.
This function extracts the information from these fields using optical
character recognition provided by the package tesseract after reading
images using the package magick."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">camtrapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/camtrapr1.html">1. Organising raw camera trap images in camtrapR</a>
    </li>
    <li>
      <a href="../articles/camtrapr2.html">2. Species and Individual Identification</a>
    </li>
    <li>
      <a href="../articles/camtrapr3.html">3. Data Extraction from Images and videos, creating occupancy &amp; secr input</a>
    </li>
    <li>
      <a href="../articles/camtrapr4.html">4. Data exploration and visualisation</a>
    </li>
    <li>
      <a href="../articles/camtrapr5.html">5. Multi-species occupancy models</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/jniedballa/camtrapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Optical character recognition (OCR) from data fields in digital images</h1>
    <small class="dont-index">Source: <a href="https://github.com/jniedballa/camtrapR/blob/HEAD/R/OCRdataFields.R" class="external-link"><code>R/OCRdataFields.R</code></a></small>
    <div class="hidden name"><code>OCRdataFields.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Extracts information from the data fields in camera trap images (not the
metadata). Many camera traps include data fields in camera trap images,
often including date and time of images, and sometimes other information.
This function extracts the information from these fields using optical
character recognition provided by the package <span class="pkg">tesseract</span> after reading
images using the package <span class="pkg">magick</span>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">OCRdataFields</span><span class="op">(</span><span class="va">inDir</span>, <span class="va">geometries</span>, invert <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>inDir</dt>
<dd><p>character. Directory containing camera trap images (or
subdirectories containing images)</p></dd>


<dt>geometries</dt>
<dd><p>list. A (possibly named) list of geometry strings defining
the image area(s) to extract.</p></dd>


<dt>invert</dt>
<dd><p>logical. Invert colors in the image? Set to TRUE if text in
data field is white on black background. Leave if FALSE if text is black in
white background.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code>data.frame</code> with original directory and file names, and
additional columns for the OCR data of each extracted geometry.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Normally all these information should be in the image metadata. This
function is meant as a last resort if image metadata are unreadable or were
removed from images. OCR is not perfect and may misidentify characters, so
check the output carefully.</p>
<p>The output of this function can be used in
<code><a href="writeDateTimeOriginal.html">writeDateTimeOriginal</a></code> to write date/time into the
DateTimeOriginal tag in image metadata, making these images available for
automatic processing with <code><a href="recordTable.html">recordTable</a></code> and other functions that
extract image metadata.</p>

<p>This function reads all images in inDir (including subdirectories), crops
them to the geometries in the "geometries" list, and performs optical
character recognition (OCR) on each of these fields (leveraging the magick
and tesseract packages).</p>
<p>Geometries are defined with <code>geometry_area</code> from <span class="pkg">magick</span>. See
<code><a href="https://docs.ropensci.org/magick/reference/geometry.html" class="external-link">geometry</a></code> for details on how to specify geometries with
<code>geometry_area</code>. The format is: "widthxheight+x_off+y_off", where:</p>
<dl><dt>width</dt>
<dd><p>width of the area of interest</p></dd>
 <dt>height</dt>
<dd><p>height
of the area of interest</p></dd>
 <dt>x_off</dt>
<dd><p>offset from the left side of the
image</p></dd>
 <dt>y_off</dt>
<dd><p>offset from the top of the image</p></dd>
 
</dl><p>Units are pixels for all fields. digiKam can help in identifying the correct
specification for geometries. Open the Image Editor, left-click and draw a
box around the data field of interest. Ensure the entire text field is
included inside the box, but nothing else. Now note two pairs of numbers at
the bottom of the window, showing the offsets and box size as e.g.:</p>
<p>"(400, 1800) (300 x 60)"</p>
<p>This corresponds to the geometry values as follows:</p>
<p>"(x_off, y_off) (width x height)"</p>
<p>Using these values, you'd run:</p>
<p><code>geometry_area(x_off = 400, y_off = 1800, width = 300, height = 60)</code></p>
<p>and receive</p>
<p>"300x60+400+1800"</p>
<p>as your geometry.</p>
<p>OCR in tesseract has problems with white font on black background. If that
is the case in your images, set <code>invert</code> to <code>TRUE</code> to invert the
image and ensure OCR uses black text on white background.</p>
<p>Even then, output will not be perfect. Error rates in OCR depend on multiple
factors, including the text size and font type used. We don't have control
over these, so check the output carefully and edit as required.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="writeDateTimeOriginal.html">writeDateTimeOriginal</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Juergen Niedballa</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># dontrun is to avoid forcing users to install additional dependencies</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">wd_images_OCR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"pictures/full_size_for_ocr"</span>, package <span class="op">=</span> <span class="st">"camtrapR"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/magick/" class="external-link">magick</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define geometries</span></span></span>
<span class="r-in"><span><span class="va">geometry1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/geometry.html" class="external-link">geometry_area</a></span><span class="op">(</span>x_off <span class="op">=</span> <span class="fl">0</span>, y_off <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">183</span>, height <span class="op">=</span> <span class="fl">37</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">geometry2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/geometry.html" class="external-link">geometry_area</a></span><span class="op">(</span>x_off <span class="op">=</span> <span class="fl">196</span>, y_off <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">200</span>, height <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">geometry3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/geometry.html" class="external-link">geometry_area</a></span><span class="op">(</span>x_off <span class="op">=</span> <span class="fl">447</span>, y_off <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">63</span>, height <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">geometry4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/geometry.html" class="external-link">geometry_area</a></span><span class="op">(</span>x_off <span class="op">=</span> <span class="fl">984</span>, y_off <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">47</span>, height <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">geometry5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/geometry.html" class="external-link">geometry_area</a></span><span class="op">(</span>x_off <span class="op">=</span> <span class="fl">0</span>, y_off <span class="op">=</span> <span class="fl">793</span>, width <span class="op">=</span> <span class="fl">320</span>, height <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># combine geometries into list</span></span></span>
<span class="r-in"><span><span class="va">geometries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">geometry1</span>, </span></span>
<span class="r-in"><span>                   time <span class="op">=</span> <span class="va">geometry2</span>, </span></span>
<span class="r-in"><span>                   sequence_id <span class="op">=</span> <span class="va">geometry3</span>,</span></span>
<span class="r-in"><span>                   temperature <span class="op">=</span> <span class="va">geometry4</span>,</span></span>
<span class="r-in"><span>                   camera_model <span class="op">=</span> <span class="va">geometry5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">df_image_data</span>  <span class="op">&lt;-</span> <span class="fu">OCRdataFields</span><span class="op">(</span>inDir <span class="op">=</span> <span class="va">wd_images_OCR</span>,</span></span>
<span class="r-in"><span>                                geometries <span class="op">=</span> <span class="va">geometries</span>, </span></span>
<span class="r-in"><span>                                invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>       </span></span>
<span class="r-in"><span><span class="va">df_image_data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># note the mistake in "camera_model"</span></span></span>
<span class="r-in"><span><span class="co"># it should be "PC850", not "PC8S0O"</span></span></span>
<span class="r-in"><span><span class="co"># date and time are correct though</span></span></span>
<span class="r-in"><span>                   </span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Juergen Niedballa, Alexandre Courtiol, Rahel Sollmann.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

