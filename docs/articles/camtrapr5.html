<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5. Multi-species occupancy models • camtrapR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="5. Multi-species occupancy models">
<meta property="og:description" content="camtrapR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">camtrapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/camtrapr1.html">1. Organising raw camera trap images in camtrapR</a>
    </li>
    <li>
      <a href="../articles/camtrapr2.html">2. Species and Individual Identification</a>
    </li>
    <li>
      <a href="../articles/camtrapr3.html">3. Data Extraction from Images and videos, creating occupancy &amp; secr input</a>
    </li>
    <li>
      <a href="../articles/camtrapr4.html">4. Data exploration and visualisation</a>
    </li>
    <li>
      <a href="../articles/camtrapr5.html">5. Multi-species occupancy models</a>
    </li>
    <li>
      <a href="../articles/test.html">5. Multi-species occupancy models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jniedballa/camtrapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="camtrapr5_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="camtrapr5_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="camtrapr5_files/datatables-binding-0.20/datatables.js"></script><script src="camtrapr5_files/jquery-3.6.0/jquery-3.6.0.min.js"></script><link href="camtrapr5_files/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="camtrapr5_files/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="camtrapr5_files/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="camtrapr5_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="camtrapr5_files/crosstalk-1.2.0/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>5. Multi-species occupancy models</h1>
                        <h4 data-toc-skip class="author">Juergen Niedballa (<a href="mailto:camtrapr@gmail.com" class="email">camtrapr@gmail.com</a>)</h4>
            
            <h4 data-toc-skip class="date">2022-01-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jniedballa/camtrapR/blob/HEAD/vignettes/camtrapr5.Rmd" class="external-link"><code>vignettes/camtrapr5.Rmd</code></a></small>
      <div class="hidden name"><code>camtrapr5.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jniedballa/camtrapR" class="external-link">camtrapR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT" class="external-link">DT</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: package 'DT' was built under R version 4.1.2</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></code></pre></div>
<div class="section level1">
<h1 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h1>
<p>Multi-species occupancy models are a powerful group of models that combine information from many species to estimate individual species’ responses as well as community-level responses to environmental variables.</p>
<p>They are normally fit in Bayesian frameworks, e.g. BUGS, JAGS or Nimble. Creating the necessary input for these models from camera trapping data, writing the model code, setting parameters to monitor, initial values etc. can however be daunting, and even for seasoned users can be a tedious and time-consuming task.</p>
<p>A new extension of camtrapR aims to simplify this process by automatically and flexibly creating custom community occupancy models that are ready for analysis in JAGS or Nimble. The workflow supports:</p>
<ul>
<li>continuous and categorical site covariates on detection and occupancy probability</li>
<li>fixed and random effects of these covariates</li>
<li>continuous and categorical observation-level covariates on detection probability</li>
<li>fixed or random intercepts of detection and occupancy probability</li>
<li>nested random effects</li>
<li>random effects of categorical site covariates</li>
<li>data augmentation (fully open community or known maximum species richness)</li>
<li>species richness estimates</li>
<li>models in JAGS and Nimble</li>
<li>Bayesian p-values (overall and by species)</li>
</ul>
<p>The main function is <code><a href="../reference/communityModel.html">communityModel()</a></code>. It automates:</p>
<ul>
<li>writing model code</li>
<li>setting parameters to monitor</li>
<li>setting initial values</li>
<li>bundling input data</li>
</ul>
<p>The workflow provides methods for:</p>
<ul>
<li>fitting models</li>
<li>plottingmarginal effects (response curves)</li>
<li>plotting effect sizes</li>
<li>spatial predictions of species occupancy probabilities</li>
<li>spatial predictions of species richness</li>
</ul>
<p>The output of fit() is an mcmc.list from the coda package and can be uses as such, so the summary(), plot(), etc. methods are available as well as the functions from bayesplot.</p>
<p>The main function <code>communityModel</code> does not support R formula syntax the way packages like unmarked or ubms do Instead, covariates and their effect types are specified via a few dedicated function arguments. This non-standard approach may change in the future to instead support formula syntax. On the other hand it might be less confusing than the lme4 syntax for random effects.</p>
</div>
<div class="section level1">
<h1 id="warning">Warning<a class="anchor" aria-label="anchor" href="#warning"></a>
</h1>
<p>A word of caution, please always check the model code and make sure you understand the code and agree with it. The workflow is meant to be convenient and does not require you to even look at the model code, but you should (there are many comments in the model code to make it easier). This workflow still requires a proper understanding of Bayesian modelling frameworks and the concepts behind multi-species occupancy models.</p>
</div>
<div class="section level1">
<h1 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h1>
<p>The workflow is still rather experimental, so please remain critical of the results and check carefully. If you encounter any problems, please let me know.</p>
<p>There are currently a few limitations in the workflow:</p>
<ul>
<li>priors can not be customized yet.</li>
<li>models with categorical observation-level covariates cannot be compiled in Nimble and must be fit in JAGS instead</li>
<li>nested random effects and random effects of site covariates are still experimental, and the plot_* methods don’t work on these yet</li>
<li>likewise, the output of <code>predict</code> may not be correct for these</li>
<li>input checks are a bit limited and may not always lead to meaningful error messages. This will improve over time with user feedback.</li>
</ul>
</div>
<div class="section level1">
<h1 id="parameter-naming-convention">Parameter naming convention<a class="anchor" aria-label="anchor" href="#parameter-naming-convention"></a>
</h1>
<p>The parameter names are assembled from standardized building blocks. The nomenclature is as follows:</p>
<p>For example, a fixed intercept of occupancy (constant across species) is <em>beta0</em>, and a fixed intercept of detection probability is <em>alpha0</em>.</p>
<p>An occupancy probability intercept with a random effect of species is:</p>
<p><strong>beta0.mean</strong> community mean of the occupancy probability intercept</p>
<p><strong>beta0.sigma</strong> standard deviation of the community occupancy probability intercept.</p>
<p><strong>beta0[1]</strong> occupancy probability intercept of species 1 (likewise for other species).</p>
<p>For effects of site covariates, the pattern is:</p>
<p><em>submodel.effectType.covariateType.CovariateName.hyperparameter</em></p>
<p>For example:</p>
<p><strong>beta.ranef.cont.habitat.mean</strong> is the mean community effect of the continuous site covariate ‘habitat’ on occupancy probability.</p>
<p><strong>beta.ranef.cont.habitat[1]</strong> is the effect of continuous site covariate ‘habitat’ on occupancy probability of species 1.</p>
<p>Site-occasion covariates are denoted by <em>.obs</em> after the submodel, e.g.:</p>
<p><strong>alpha.obs.fixed.cont.effort</strong> is the fixed effect of the continuous observation-level covariate ‘effort’ on detection probability</p>
</div>
<div class="section level1">
<h1 id="quick-example">Quick example<a class="anchor" aria-label="anchor" href="#quick-example"></a>
</h1>
<p>Here is a quick example using the sample data that are included in camtrapR. The data set only contains five species at three fictional camera trap stations, and use made-up covariates (so the parameter estimates will be nonsense, ecologically). It is only a technical demonstration for how community models fit into the camtrapR workflow.</p>
<div class="section level2">
<h2 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>First load the camera trap table and create a camera operation matrix:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"camtraps"</span><span class="op">)</span>

 <span class="va">camop_no_problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cameraOperation.html">cameraOperation</a></span><span class="op">(</span>CTtable      <span class="op">=</span> <span class="va">camtraps</span>,
                                     stationCol   <span class="op">=</span> <span class="st">"Station"</span>,
                                     setupCol     <span class="op">=</span> <span class="st">"Setup_date"</span>,
                                     retrievalCol <span class="op">=</span> <span class="st">"Retrieval_date"</span>,
                                     hasProblems  <span class="op">=</span> <span class="cn">FALSE</span>,
                                     dateFormat   <span class="op">=</span> <span class="st">"dmy"</span>
 <span class="op">)</span></code></pre></div>
<p>Now we load the record table and create a list of detection histories. Here we include all species, but you may want to subset the record table first. Note the argument <code>includeEffort = TRUE</code>, hence the output for each species will be a list (containing the detection history and effort matrix).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"recordTableSample"</span><span class="op">)</span>

 <span class="co"># list of detection histories</span>
 <span class="va">DetHist_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">recordTableSample</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
   <span class="fu"><a href="../reference/detectionHistory.html">detectionHistory</a></span><span class="op">(</span>
     recordTable         <span class="op">=</span> <span class="va">recordTableSample</span>,
     camOp                <span class="op">=</span> <span class="va">camop_no_problem</span>,
     stationCol           <span class="op">=</span> <span class="st">"Station"</span>,
     speciesCol           <span class="op">=</span> <span class="st">"Species"</span>,
     recordDateTimeCol    <span class="op">=</span> <span class="st">"DateTimeOriginal"</span>,
     species              <span class="op">=</span> <span class="va">x</span>,     <span class="co"># this gets modifies by lapply</span>
     occasionLength       <span class="op">=</span> <span class="fl">7</span>,
     day1                 <span class="op">=</span> <span class="st">"station"</span>,
     datesAsOccasionNames <span class="op">=</span> <span class="cn">FALSE</span>,
     includeEffort        <span class="op">=</span> <span class="cn">TRUE</span>,
     scaleEffort          <span class="op">=</span> <span class="cn">TRUE</span>,
     timeZone             <span class="op">=</span> <span class="st">"Asia/Kuala_Lumpur"</span>
   <span class="op">)</span><span class="op">}</span>
 <span class="op">)</span>

 <span class="co"># assign species names to the list items</span>
 <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DetHist_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">recordTableSample</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>

 <span class="co"># note, DetHist_list is a list containing a list for each species</span></code></pre></div>
<p>Get the detection history of each species and put into a new list (get rid of effort matrix).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">ylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">DetHist_list</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">detection_history</span><span class="op">)</span></code></pre></div>
<p>Create some fake covariates (only for demonstration):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">sitecovs</span> <span class="op">&lt;-</span> <span class="va">camtraps</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>
 <span class="va">sitecovs</span><span class="op">$</span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">500</span>, <span class="fl">600</span><span class="op">)</span>
 <span class="va">sitecovs</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">sitecovs</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>   <span class="co"># scale numeric covariates</span>
 <span class="va">sitecovs</span><span class="op">$</span><span class="va">fact</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span>    <span class="co"># categorical covariate</span></code></pre></div>
<p>Now we bundle the necessary data for <code>communityModel</code> in a list with 3 items:</p>
<ul>
<li>ylist: the list of detection histories</li>
<li>siteCovs: data frame with site covariates</li>
<li>obsCovs: (named) list with observation level covariates. Requires at least the effort matrix.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ylist    <span class="op">=</span> <span class="va">ylist</span>,
                   siteCovs <span class="op">=</span> <span class="va">sitecovs</span>,
                   obsCovs  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>effort <span class="op">=</span> <span class="va">DetHist_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">effort</span><span class="op">)</span><span class="op">)</span>  <span class="co"># is identical for all species</span></code></pre></div>
<p>Now <code>data_list</code> is a list containing the detection histories, site covariates and occasion level covariates.</p>
<p>N.B.: It is always necessary to provide an effort matrix. This is to ensure that detection probability is 0 when there was no effort. This is achieved by creating a binary effort matrix based on the user-provided effort matrix. The binary effort matrix is 0 for all cells where effort = NA, and 1 for all cells with values (no matter what values). Thus, all occasions with effort = NA in the povided above effort matrix will have detection probability = 0.</p>
<p>Also note that this does <strong>not</strong> automatically include effort as a covariate on detection probability. To include effort as a covariate on detection probability, include “effort” in argument <code>detCovsObservation</code> (you can specify a fixed or random effect).</p>
</div>
<div class="section level2">
<h2 id="fit-model-in-jags">Fit model in JAGS<a class="anchor" aria-label="anchor" href="#fit-model-in-jags"></a>
</h2>
<p>Now the interesting part. The function communityModel() creates a new class, “commOccu”. It is an object that contains all relevant information for running a community occupancy model. Here we will create a JAGS model (the default). For a model in Nimble, see further below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># text file to save the model</span>
 <span class="va">modelfile1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

 <span class="va">mod.jags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span><span class="va">data_list</span>,
                            occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"utm_y"</span>, ranef <span class="op">=</span> <span class="st">"elevation"</span><span class="op">)</span>,
                            detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"effort"</span><span class="op">)</span>,
                            intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
                            modelFile <span class="op">=</span> <span class="va">modelfile1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Wrote model to C:\Users\NIEDBA~1\AppData\Local\Temp\Rtmp8MjixD\file116435c2387b.txt</span></code></pre>
<p>This call defined a model with a fixed effect of utm_y on occupancy probability of all species, and a species-specific (random) effect of elevation on occupancy probability. Furthermore, we specified effort as a covariate on detection probability (constant across species), and there are random effects of species on the intercepts of detection and occupancy probabilities.</p>
<p>Note that throughout this vignette we use a temporary file to save the model text. In real examples you’d probably want to use a persistent file.</p>
<p>One can also see the model code using (not shown here for brevity):</p>
<p>There is a very basic summary method for commOccu objects:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.jags</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## commOccu object (for JAGS)</span>
<span class="co">## </span>
<span class="co">## 5 species,  3 stations,  7 occasions</span>
<span class="co">## 21 occasions with effort</span>
<span class="co">## Number of detections (by species): 2 - 11 </span>
<span class="co">## </span>
<span class="co">## Available site covariates:</span>
<span class="co">##  Station, utm_y, utm_x, elevation, fact </span>
<span class="co">## </span>
<span class="co">## Used site covariates:</span>
<span class="co">##  utm_y, elevation </span>
<span class="co">## </span>
<span class="co">## Available site-occasion covariates:</span>
<span class="co">##  effort</span></code></pre>
<p>The model is fit with <code>fit()</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">fit.jags</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">mod.jags</span>,
                 n.iter <span class="op">=</span> <span class="fl">1000</span>,
                 n.burnin <span class="op">=</span> <span class="fl">500</span>,
                 chains <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: package 'rjags' was built under R version 4.1.2</span></code></pre>
<pre><code><span class="co">## Warning: package 'coda' was built under R version 4.1.2</span></code></pre>
<pre><code><span class="co">## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams</span>
<span class="co">## (currently) not available in serial execution. Random numbers may differ in</span>
<span class="co">## serial &amp; parallel execution.</span></code></pre>
<pre><code><span class="co">## Compiling model graph</span>
<span class="co">##    Resolving undeclared variables</span>
<span class="co">##    Allocating nodes</span>
<span class="co">## Graph information:</span>
<span class="co">##    Observed stochastic nodes: 105</span>
<span class="co">##    Unobserved stochastic nodes: 143</span>
<span class="co">##    Total graph size: 764</span>
<span class="co">## </span>
<span class="co">## Initializing model</span>
<span class="co">## </span>
<span class="co">## NOTE: Stopping adaptation</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Compiling model graph</span>
<span class="co">##    Resolving undeclared variables</span>
<span class="co">##    Allocating nodes</span>
<span class="co">## Graph information:</span>
<span class="co">##    Observed stochastic nodes: 105</span>
<span class="co">##    Unobserved stochastic nodes: 143</span>
<span class="co">##    Total graph size: 764</span>
<span class="co">## </span>
<span class="co">## Initializing model</span>
<span class="co">## </span>
<span class="co">## NOTE: Stopping adaptation</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Compiling model graph</span>
<span class="co">##    Resolving undeclared variables</span>
<span class="co">##    Allocating nodes</span>
<span class="co">## Graph information:</span>
<span class="co">##    Observed stochastic nodes: 105</span>
<span class="co">##    Unobserved stochastic nodes: 143</span>
<span class="co">##    Total graph size: 764</span>
<span class="co">## </span>
<span class="co">## Initializing model</span>
<span class="co">## </span>
<span class="co">## NOTE: Stopping adaptation</span></code></pre>
<p>The output of the <code>fit()</code> method is an<code>mcmc.list</code> from the coda package.</p>
<p>Summarize posterior estimates:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit.jags</span><span class="op">)</span></code></pre></div>
<p>Statistics of parameter estimates:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Note, colors may not render correctly in dark themes in RStudio.</span>
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_summary</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-3d102f58b958f847730e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3d102f58b958f847730e">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R3","alpha.obs.fixed.cont.effort","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0.mean","alpha0.sigma","beta.fixed.cont.utm_y","beta.ranef.cont.elevation[1]","beta.ranef.cont.elevation[2]","beta.ranef.cont.elevation[3]","beta.ranef.cont.elevation[4]","beta.ranef.cont.elevation[5]","beta.ranef.cont.elevation.mean","beta.ranef.cont.elevation.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R3"],[0.491,0.22,0.281,0.689,0.367,0.387,5,0.143,0.296,1.37,0.144,0.145,2.098,3.635,-1.033,-2.253,-2.604,-0.316,-0.375,-1.292,1.474,3.435,-0.322,-0.425,0.123,1.255,1.274,0.15,2.265,8.116,8.337,3.372,-1.782,-1.973,1.714,6.73,0.38,0.885,0.658,0.083,0.091,2.098],[0.5,0.414,0.45,0.463,0.482,0.487,0,0.146,0.23,0.934,0.45,0.444,1.207,1.76,0.827,0.852,1.096,1.17,1.221,1.073,0.925,3.646,3.911,3.874,4.317,4.492,4.655,3.221,3.425,6.964,8.049,5.339,2.641,3.025,2.59,6.365,0.555,0.91,0.712,0.194,0.234,1.344],[0.013,0.011,0.012,0.012,0.012,0.013,0,0.004,0.006,0.024,0.012,0.011,0.031,0.045,0.021,0.022,0.028,0.03,0.032,0.028,0.024,0.094,0.101,0.1,0.111,0.116,0.12,0.083,0.088,0.18,0.208,0.138,0.068,0.078,0.067,0.164,0.014,0.023,0.018,0.005,0.006,0.035],[0.014,0.012,0.012,0.018,0.015,0.015,0,0.005,0.007,0.066,0.026,0.028,0.078,0.196,0.085,0.073,0.094,0.085,0.094,0.079,0.048,0.534,0.557,0.495,0.569,0.825,0.711,0.675,0.54,0.97,1.36,0.649,0.241,0.37,0.121,1.161,0.014,0.023,0.032,0.006,0.007,0.036]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Quantiles of parameter estimates:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_summary</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-64630e385d4c22e3fbd9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-64630e385d4c22e3fbd9">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R3","alpha.obs.fixed.cont.effort","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0.mean","alpha0.sigma","beta.fixed.cont.utm_y","beta.ranef.cont.elevation[1]","beta.ranef.cont.elevation[2]","beta.ranef.cont.elevation[3]","beta.ranef.cont.elevation[4]","beta.ranef.cont.elevation[5]","beta.ranef.cont.elevation.mean","beta.ranef.cont.elevation.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R3"],[0.491,0.22,0.281,0.689,0.367,0.387,5,0.143,0.296,1.37,0.144,0.145,2.098,3.635,-1.033,-2.253,-2.604,-0.316,-0.375,-1.292,1.474,3.435,-0.322,-0.425,0.123,1.255,1.274,0.15,2.265,8.116,8.337,3.372,-1.782,-1.973,1.714,6.73,0.38,0.885,0.658,0.083,0.091,2.098],[0.5,0.414,0.45,0.463,0.482,0.487,0,0.146,0.23,0.934,0.45,0.444,1.207,1.76,0.827,0.852,1.096,1.17,1.221,1.073,0.925,3.646,3.911,3.874,4.317,4.492,4.655,3.221,3.425,6.964,8.049,5.339,2.641,3.025,2.59,6.365,0.555,0.91,0.712,0.194,0.234,1.344],[0.013,0.011,0.012,0.012,0.012,0.013,0,0.004,0.006,0.024,0.012,0.011,0.031,0.045,0.021,0.022,0.028,0.03,0.032,0.028,0.024,0.094,0.101,0.1,0.111,0.116,0.12,0.083,0.088,0.18,0.208,0.138,0.068,0.078,0.067,0.164,0.014,0.023,0.018,0.005,0.006,0.035],[0.014,0.012,0.012,0.018,0.015,0.015,0,0.005,0.007,0.066,0.026,0.028,0.078,0.196,0.085,0.073,0.094,0.085,0.094,0.079,0.048,0.534,0.557,0.495,0.569,0.825,0.711,0.675,0.54,0.97,1.36,0.649,0.241,0.37,0.121,1.161,0.014,0.023,0.032,0.006,0.007,0.036]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Marginal effect plots (response curves) can be plotted with <code><a href="../reference/plot_effects-commOccu-method.html">plot_effects()</a></code>. Argument <code>submodel</code> defines whether the output is for the detection or occupancy part of the model:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.jags</span>,
              <span class="va">fit.jags</span>,
              submodel <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $utm_y</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<pre><code><span class="co">## </span>
<span class="co">## $elevation</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-16-2.png" width="700"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.jags</span>,
              <span class="va">fit.jags</span>,
              submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $effort</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-16-3.png" width="700"></p>
<p>Likewise, we can plot effect sizes for easier comparison between species and for easily checking significance with <code><a href="../reference/plot_coef-commOccu-method.html">plot_coef()</a></code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.jags</span>,
           <span class="va">fit.jags</span>,
           submodel <span class="op">=</span> <span class="st">"state"</span>,
           combine <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'combine' and 'ordered' can't both be TRUE. Setting 'ordered = FALSE'</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.jags</span>,
           <span class="va">fit.jags</span>,
           submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $effort</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-17-2.png" width="700"></p>
<p>There are further arguments for the significance levels, sorting species by parameter estimates, and for combining multiple plots.</p>
</div>
<div class="section level2">
<h2 id="models-in-nimble">Models in Nimble<a class="anchor" aria-label="anchor" href="#models-in-nimble"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>NIMBLE is a system for building and sharing analysis methods for statistical models, especially for hierarchical models and computationally-intensive methods. NIMBLE is built in R but compiles your models and algorithms using C++ for speed.</p>
<p>(<a href="https://r-nimble.org/" class="external-link uri">https://r-nimble.org/</a>)</p>
<p>It allows you to run the same models as BUGS or JAGS, but can be much faster in some situations.</p>
<p>Using Nimble for community occupancy models requires the packages “nimble” and “nimbleEcology”:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-nimble.org" class="external-link">nimble</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: package 'nimble' was built under R version 4.1.2</span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nimble-dev/nimbleEcology" class="external-link">nimbleEcology</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: package 'nimbleEcology' was built under R version 4.1.2</span></code></pre>
</div>
<div class="section level3">
<h3 id="compilation-and-rtools">Compilation and Rtools<a class="anchor" aria-label="anchor" href="#compilation-and-rtools"></a>
</h3>
<p>Using nimble only makes sense if one can compile the models (which runs them as fast C++ code). Compiling Nimble code requires Rtools.</p>
<p>You can obtain Rtools from: <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link uri">https://cran.r-project.org/bin/windows/Rtools/</a>.</p>
<p>It then needs to be put in PATH, see here for how to do it: <a href="https://cran.r-project.org/bin/windows/Rtools/#putting-rtools-on-the-path" class="external-link uri">https://cran.r-project.org/bin/windows/Rtools/#putting-rtools-on-the-path</a>.</p>
<p>Depending on where you installed Rtools, you should see something like “C:/rtools40/usr/bin” somewhere in the output of the following line (for me it’s usually the first or second entry).</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"PATH"</span><span class="op">)</span> </code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-models-in-nimble">Fit models in Nimble<a class="anchor" aria-label="anchor" href="#fit-models-in-nimble"></a>
</h3>
<p>We can fit the same model in Nimble using the exact same functions as for the JAGS model above. Only set <code>nimble = TRUE</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">modelfile2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

 <span class="va">mod.nimble</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span><span class="va">data_list</span>,
                              occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"utm_x"</span>, ranef <span class="op">=</span> <span class="st">"utm_y"</span><span class="op">)</span>,
                              detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"effort"</span><span class="op">)</span>,
                              intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
                              modelFile <span class="op">=</span> <span class="va">modelfile2</span>,
                              nimble <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>      <span class="co"># set nimble = TRUE</span></code></pre></div>
<pre><code><span class="co">## Wrote model to C:\Users\NIEDBA~1\AppData\Local\Temp\Rtmp8MjixD\file1164268159f7.txt</span></code></pre>
<p>It is possible to fit uncompiled models, but it is usually extremely slow and should only be done for checking model structure and expected outputs, using very few iterations.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">fit.nimble.uncomp</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">mod.nimble</span>,
                          n.iter <span class="op">=</span> <span class="fl">10</span>,
                          chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Defining model</span></code></pre>
<pre><code><span class="co">## Warning in checkForDeterministicDorR(code[[i]]): Model includes deterministic</span>
<span class="co">## assignment using '&lt;-' of the result of a density ('d') or simulation ('r')</span>
<span class="co">## calculation. This is likely not what you intended in: new.y[i, j, 1:maxocc] &lt;-</span>
<span class="co">## rOcc_v(n = 1, probOcc = psi[i, j], probDetect = p.eff[i, j, 1:maxocc], len =</span>
<span class="co">## maxocc).</span></code></pre>
<pre><code><span class="co">##   [Note] Using 'y' (given within 'constants') as data.</span></code></pre>
<pre><code><span class="co">## Building model</span></code></pre>
<pre><code><span class="co">## Setting data and initial values</span></code></pre>
<pre><code><span class="co">## Running calculate on model</span>
<span class="co">##   [Note] Any error reports that follow may simply reflect missing values in model variables.</span></code></pre>
<pre><code><span class="co">## Error in if (u &gt; probOcc) return(nimNumeric(0, length = k)) : </span>
<span class="co">##   missing value where TRUE/FALSE needed</span></code></pre>
<pre><code><span class="co">## Checking model sizes and dimensions</span></code></pre>
<pre><code><span class="co">##   [Note] This model is not fully initialized. This is not an error.</span>
<span class="co">##          To see which variables are not initialized, use model$initializeInfo().</span>
<span class="co">##          For more information on model initialization, see help(modelInitialization).</span></code></pre>
<pre><code><span class="co">## ===== Monitors =====</span>
<span class="co">## thin = 1: alpha.obs.fixed.cont.effort, alpha0, alpha0.mean, alpha0.sigma, beta.fixed.cont.utm_x, beta.ranef.cont.utm_y, beta.ranef.cont.utm_y.mean, beta.ranef.cont.utm_y.sigma, beta0, beta0.mean, beta0.sigma, Bpvalue, Bpvalue_species, new.R2, new.R3, R2, R3</span>
<span class="co">## ===== Samplers =====</span>
<span class="co">## RW sampler (17)</span>
<span class="co">##   - alpha.obs.fixed.cont.effort</span>
<span class="co">##   - beta.fixed.cont.utm_x</span>
<span class="co">##   - beta0[]  (5 elements)</span>
<span class="co">##   - alpha0[]  (5 elements)</span>
<span class="co">##   - beta.ranef.cont.utm_y[]  (5 elements)</span>
<span class="co">## conjugate sampler (6)</span>
<span class="co">##   - beta0.mean</span>
<span class="co">##   - beta0.tau</span>
<span class="co">##   - alpha0.mean</span>
<span class="co">##   - alpha0.tau</span>
<span class="co">##   - beta.ranef.cont.utm_y.mean</span>
<span class="co">##   - beta.ranef.cont.utm_y.tau</span></code></pre>
<pre><code><span class="co">## Compiling</span>
<span class="co">##   [Note] This may take a minute.</span>
<span class="co">##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></code></pre>
<pre><code><span class="co">## Compiling</span>
<span class="co">##   [Note] This may take a minute.</span>
<span class="co">##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></code></pre>
<pre><code><span class="co">## running chain 1...</span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the notes and the error message below are harmless</span></code></pre></div>
<p>To fit a compiled model, set compile = TRUE:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">fit.nimble.comp</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">mod.nimble</span>,
                        n.iter <span class="op">=</span> <span class="fl">10000</span>,
                        n.burnin <span class="op">=</span> <span class="fl">5000</span>,
                        chains <span class="op">=</span> <span class="fl">3</span>,
                        compile <span class="op">=</span> <span class="cn">TRUE</span>, 
<span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Defining model</span></code></pre>
<pre><code><span class="co">## Warning in checkForDeterministicDorR(code[[i]]): Model includes deterministic</span>
<span class="co">## assignment using '&lt;-' of the result of a density ('d') or simulation ('r')</span>
<span class="co">## calculation. This is likely not what you intended in: new.y[i, j, 1:maxocc] &lt;-</span>
<span class="co">## rOcc_v(n = 1, probOcc = psi[i, j], probDetect = p.eff[i, j, 1:maxocc], len =</span>
<span class="co">## maxocc).</span></code></pre>
<pre><code><span class="co">##   [Note] Using 'y' (given within 'constants') as data.</span></code></pre>
<pre><code><span class="co">## Building model</span></code></pre>
<pre><code><span class="co">## Setting data and initial values</span></code></pre>
<pre><code><span class="co">## Running calculate on model</span>
<span class="co">##   [Note] Any error reports that follow may simply reflect missing values in model variables.</span></code></pre>
<pre><code><span class="co">## Error in if (u &gt; probOcc) return(nimNumeric(0, length = k)) : </span>
<span class="co">##   missing value where TRUE/FALSE needed</span></code></pre>
<pre><code><span class="co">## Checking model sizes and dimensions</span></code></pre>
<pre><code><span class="co">##   [Note] This model is not fully initialized. This is not an error.</span>
<span class="co">##          To see which variables are not initialized, use model$initializeInfo().</span>
<span class="co">##          For more information on model initialization, see help(modelInitialization).</span></code></pre>
<pre><code><span class="co">## ===== Monitors =====</span>
<span class="co">## thin = 1: alpha.obs.fixed.cont.effort, alpha0, alpha0.mean, alpha0.sigma, beta.fixed.cont.utm_x, beta.ranef.cont.utm_y, beta.ranef.cont.utm_y.mean, beta.ranef.cont.utm_y.sigma, beta0, beta0.mean, beta0.sigma, Bpvalue, Bpvalue_species, new.R2, new.R3, R2, R3</span>
<span class="co">## ===== Samplers =====</span>
<span class="co">## RW sampler (17)</span>
<span class="co">##   - alpha.obs.fixed.cont.effort</span>
<span class="co">##   - beta.fixed.cont.utm_x</span>
<span class="co">##   - beta0[]  (5 elements)</span>
<span class="co">##   - alpha0[]  (5 elements)</span>
<span class="co">##   - beta.ranef.cont.utm_y[]  (5 elements)</span>
<span class="co">## conjugate sampler (6)</span>
<span class="co">##   - beta0.mean</span>
<span class="co">##   - beta0.tau</span>
<span class="co">##   - alpha0.mean</span>
<span class="co">##   - alpha0.tau</span>
<span class="co">##   - beta.ranef.cont.utm_y.mean</span>
<span class="co">##   - beta.ranef.cont.utm_y.tau</span></code></pre>
<pre><code><span class="co">## Compiling</span>
<span class="co">##   [Note] This may take a minute.</span>
<span class="co">##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></code></pre>
<pre><code><span class="co">## Compiling</span>
<span class="co">##   [Note] This may take a minute.</span>
<span class="co">##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></code></pre>
<pre><code><span class="co">## running chain 1...</span></code></pre>
<pre><code><span class="co">## |-------------|-------------|-------------|-------------|</span>
<span class="co">## |-------------------------------------------------------|</span></code></pre>
<pre><code><span class="co">## running chain 2...</span></code></pre>
<pre><code><span class="co">## |-------------|-------------|-------------|-------------|</span>
<span class="co">## |-------------------------------------------------------|</span></code></pre>
<pre><code><span class="co">## running chain 3...</span></code></pre>
<pre><code><span class="co">## |-------------|-------------|-------------|-------------|</span>
<span class="co">## |-------------------------------------------------------|</span></code></pre>
<p>The output as an <code>mcmc.list</code>, just like for the JAGS model above, and can be treated just the same:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="co"># parameter summary statistics (not shown)</span>
 <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit.nimble.comp</span><span class="op">)</span></code></pre></div>
<p>Response curves (= marginal effect plots)</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.nimble</span>,
              <span class="va">fit.nimble.comp</span>,
              submodel <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $utm_x</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<pre><code><span class="co">## </span>
<span class="co">## $utm_y</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-25-2.png" width="700"></p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.nimble</span>,
              <span class="va">fit.nimble.comp</span>,
              submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $effort</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-25-3.png" width="700"></p>
<p>Effect size plots:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.nimble</span>,
           <span class="va">fit.nimble.comp</span>,
           submodel <span class="op">=</span> <span class="st">"state"</span>,
           combine <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'combine' and 'ordered' can't both be TRUE. Setting 'ordered = FALSE'</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.nimble</span>,
           <span class="va">fit.nimble.comp</span>,
           submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $effort</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-26-2.png" width="700"></p>
<p>Traceplots (not shown)</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit.nimble.comp</span><span class="op">)</span></code></pre></div>
<p>The estimates and marginal effects are not very pretty, and the model would likely require more iterations to achieve smooth estimates.</p>
</div>
</div>
</div>
<div class="section level1">
<h1 id="more-complete-example">More complete example<a class="anchor" aria-label="anchor" href="#more-complete-example"></a>
</h1>
<p>The example above was very small and unrealistic. We can’t provide a large camera trapping data set, but we can simulate one using the <code>simComm</code> function from the <code>AHMbook</code> package.</p>
<div class="section level2">
<h2 id="prepare-data">Prepare data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h2>
<p>First, install GitHub version of the AHMbook package:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span>
<span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"mikemeredith/AHMbook"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sites.google.com/site/appliedhierarchicalmodeling/home" class="external-link">AHMbook</a></span><span class="op">)</span></code></pre></div>
<p>Simulate community with <code><a href="https://rdrr.io/pkg/AHMbook/man/simComm.html" class="external-link">simComm()</a></code>. Here we simulate a community with 20 species, 30 camera trap stations and 5 occasions.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">com</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AHMbook/man/simComm.html" class="external-link">simComm</a></span><span class="op">(</span>nspecies <span class="op">=</span> <span class="fl">20</span>, 
                nsites <span class="op">=</span> <span class="fl">30</span>,
                nreps <span class="op">=</span> <span class="fl">5</span>,
                mean.psi <span class="op">=</span> <span class="fl">0.25</span>,     <span class="co"># community mean of psi over all species in community (probability scale)  (0.25 = -1.1 on logit scale)</span>
                sig.lpsi <span class="op">=</span> <span class="fl">1</span>,        <span class="co"># SD around intercept of logit(psi)</span>
                mean.p <span class="op">=</span> <span class="fl">0.25</span>,       <span class="co"># community mean of detection probability over all species (0.25 = -1.1 on logit scale)</span>
                sig.lp <span class="op">=</span> <span class="fl">1</span>,          <span class="co"># SD around intercept of logit(p)</span>
                mu.beta.lpsi <span class="op">=</span> <span class="fl">0.5</span>,  <span class="co"># mean (community) effect of habitat on logit(psi)</span>
                sig.beta.lpsi <span class="op">=</span> <span class="fl">0.5</span>, <span class="co"># SD around mean (community) effect of habitat on logit(psi)</span>
                mu.beta.lp <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,   <span class="co"># mean (community) effect of wind on logit(p)</span>
                sig.beta.lp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>     <span class="co"># SD around mean (community) effect of wind on logit(p)</span></code></pre></div>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-30-1.png" width="700"><img src="camtrapr5_files/figure-html/unnamed-chunk-30-2.png" width="700"></p>
<p>We need to wrangle the data a little to convert the data to input for <code><a href="../reference/communityModel.html">communityModel()</a></code>. This is only needed here because the data are generated by <code><a href="https://rdrr.io/pkg/AHMbook/man/simComm.html" class="external-link">AHMbook::simComm()</a></code>.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get continuous site covariate "habitat"</span>
<span class="va">habitat</span> <span class="op">&lt;-</span> <span class="va">com</span><span class="op">$</span><span class="va">habitat</span>

<span class="co"># create (fake) categorical covariate (3 levels)</span>
<span class="co"># setting "medium" as reference level</span>
<span class="va">categ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">habitat</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="st">"low"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">habitat</span> <span class="op">&lt;</span> <span class="fl">0.5</span>, <span class="st">"medium"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"medium"</span>, <span class="st">"low"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># get observation covariate</span>
<span class="va">wind</span> <span class="op">&lt;-</span> <span class="va">com</span><span class="op">$</span><span class="va">wind</span>

<span class="co"># list of detection histories</span>
<span class="va">ylist</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/array-coercion.html" class="external-link">array_branch</a></span><span class="op">(</span><span class="va">com</span><span class="op">$</span><span class="va">y.all</span>, <span class="fl">3</span><span class="op">)</span>

<span class="co"># remove unobserved species  (we leave that to data augmentation)</span>
<span class="va">ylist</span> <span class="op">&lt;-</span> <span class="va">ylist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ylist</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">]</span>

<span class="co"># here, effort was constant at all stations and occasions. Effort is thus a matrix of all 1</span>
<span class="va">effort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimMatrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ylist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, ncol <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ylist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="co"># bundle data</span>
<span class="va">input_AHM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ylist <span class="op">=</span> <span class="va">ylist</span>, 
                  siteCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>habitat <span class="op">=</span> <span class="va">habitat</span>,
                                        categ   <span class="op">=</span> <span class="va">categ</span><span class="op">)</span>,
                  obsCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>effort <span class="op">=</span> <span class="va">effort</span>,
                                 wind <span class="op">=</span> <span class="va">wind</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="jags-model">JAGS Model<a class="anchor" aria-label="anchor" href="#jags-model"></a>
</h2>
<p>Here’s a model in JAGS, with a species-specific effect of habitat on occupancy and wind on detection, and species-specific intercepts.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Wrote model to C:\Users\NIEDBA~1\AppData\Local\Temp\Rtmp8MjixD\file116475c32589.txt</span></code></pre>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_ahm_jags</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags</span>, 
                    n.iter <span class="op">=</span> <span class="fl">5000</span>, 
                    n.burnin <span class="op">=</span> <span class="fl">2500</span>,
                    thin <span class="op">=</span> <span class="fl">5</span>,
                    chains <span class="op">=</span> <span class="fl">3</span>,
                    cores <span class="op">=</span> <span class="fl">1</span>,      <span class="co"># simple models may be faster with cores = 1</span>
                    quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code><span class="co">## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</span></code></pre>
<pre><code><span class="co">## sfExportAll() ignored in sequential mode.</span></code></pre>
<pre><code><span class="co">## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams</span>
<span class="co">## (currently) not available in serial execution. Random numbers may differ in</span>
<span class="co">## serial &amp; parallel execution.</span></code></pre>
<pre><code><span class="co">## NOTE: Stopping adaptation</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## NOTE: Stopping adaptation</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## NOTE: Stopping adaptation</span></code></pre>
<p>Summary statistics of model parameters</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-2708b2712ff4aa2b52b4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2708b2712ff4aa2b52b4">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat[1]","beta.ranef.cont.habitat[2]","beta.ranef.cont.habitat[3]","beta.ranef.cont.habitat[4]","beta.ranef.cont.habitat[5]","beta.ranef.cont.habitat[6]","beta.ranef.cont.habitat[7]","beta.ranef.cont.habitat[8]","beta.ranef.cont.habitat[9]","beta.ranef.cont.habitat[10]","beta.ranef.cont.habitat[11]","beta.ranef.cont.habitat[12]","beta.ranef.cont.habitat[13]","beta.ranef.cont.habitat[14]","beta.ranef.cont.habitat[15]","beta.ranef.cont.habitat[16]","beta.ranef.cont.habitat[17]","beta.ranef.cont.habitat[18]","beta.ranef.cont.habitat[19]","beta.ranef.cont.habitat.mean","beta.ranef.cont.habitat.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.484,0.344,0.538,0.607,0.152,0.395,0.495,0.683,0.502,0.55,0.249,0.265,0.299,0.713,0.454,0.679,0.454,0.587,0.548,0.495,19,3.526,2.45,1.073,2.415,4.056,4.18,3.134,0.715,3.045,1.128,1.848,2.251,1.017,2.195,1.895,2.009,1.239,1.716,1.244,41.134,1.086,0.001,-0.202,-0.188,0.291,-0.812,-0.571,-0.909,-0.356,0.156,0.804,0.381,-1.27,-0.923,-0.575,-0.068,-0.757,-0.568,-0.413,-0.266,0.797,-1.56,-1.179,-0.811,-1.794,-1.665,-0.515,-1.251,0.712,-1.132,0.249,-1.799,-1.969,-0.623,-1.712,-0.984,-0.438,-1.458,-1.735,-1.907,-1.118,0.973,-0.448,0.015,0.669,1.932,-0.604,1.046,0.391,-0.637,0.387,-0.822,2.106,1.017,-0.065,1.525,0.726,0.513,0.925,0.621,1.194,0.558,1.11,-0.772,-1.443,-2.197,-0.767,-0.82,0.454,-1.173,-1.326,-1.016,-1.203,-1.228,-1.104,-1.872,-1.217,-1.669,-1.075,-2.034,-1.68,-1.926,-1.258,0.84,4.108,2.157,0.579,3.49,4.385,4.289,2.397,0.783,2.854,1.563,2.518,2.637,0.551,2.215,1.408,2.029,0.856,1.47,1.062,41.353],[0.5,0.475,0.499,0.488,0.359,0.489,0.5,0.465,0.5,0.498,0.432,0.441,0.458,0.452,0.498,0.467,0.498,0.492,0.498,0.5,0,2.11,1.964,1.3,1.393,2.039,1.941,1.982,0.664,2.056,1.345,1.334,1.453,1.118,1.456,1.578,1.791,1.223,1.378,1.094,7.671,0.51,0.402,0.625,0.425,0.355,0.242,0.382,0.409,0.379,0.339,0.57,0.526,0.659,0.472,0.519,0.346,0.618,0.506,0.654,0.237,0.238,0.439,0.56,0.911,0.482,0.467,0.249,0.507,0.374,0.463,0.331,0.543,0.59,0.675,0.585,0.573,0.383,0.908,0.744,0.922,0.295,0.232,0.622,0.636,0.748,0.985,0.652,0.57,0.649,0.469,0.58,0.508,0.96,0.729,0.578,0.881,0.687,0.529,0.849,0.724,0.931,0.349,0.357,0.54,0.553,0.687,0.602,0.615,0.521,0.563,0.432,0.549,0.425,0.598,0.623,0.531,0.589,0.563,0.443,0.739,0.649,0.779,0.276,0.246,1.762,1.534,0.804,1.289,1.735,2.104,1.517,0.718,1.658,1.27,1.334,1.291,0.716,1.178,1.179,1.52,0.907,1.085,0.885,6.321],[0.013,0.012,0.013,0.013,0.009,0.013,0.013,0.012,0.013,0.013,0.011,0.011,0.012,0.012,0.013,0.012,0.013,0.013,0.013,0.013,0,0.054,0.051,0.034,0.036,0.053,0.05,0.051,0.017,0.053,0.035,0.034,0.037,0.029,0.038,0.041,0.046,0.032,0.036,0.028,0.198,0.013,0.01,0.016,0.011,0.009,0.006,0.01,0.011,0.01,0.009,0.015,0.014,0.017,0.012,0.013,0.009,0.016,0.013,0.017,0.006,0.006,0.011,0.014,0.024,0.012,0.012,0.006,0.013,0.01,0.012,0.009,0.014,0.015,0.017,0.015,0.015,0.01,0.023,0.019,0.024,0.008,0.006,0.016,0.016,0.019,0.025,0.017,0.015,0.017,0.012,0.015,0.013,0.025,0.019,0.015,0.023,0.018,0.014,0.022,0.019,0.024,0.009,0.009,0.014,0.014,0.018,0.016,0.016,0.013,0.015,0.011,0.014,0.011,0.015,0.016,0.014,0.015,0.015,0.011,0.019,0.017,0.02,0.007,0.006,0.045,0.04,0.021,0.033,0.045,0.054,0.039,0.019,0.043,0.033,0.034,0.033,0.018,0.03,0.03,0.039,0.023,0.028,0.023,0.163],[0.014,0.012,0.015,0.013,0.009,0.012,0.012,0.013,0.013,0.013,0.011,0.011,0.012,0.012,0.013,0.013,0.013,0.014,0.012,0.014,0,0.057,0.06,0.04,0.04,0.059,0.052,0.059,0.019,0.063,0.031,0.035,0.041,0.03,0.041,0.044,0.05,0.038,0.039,0.031,0.292,0.014,0.01,0.016,0.012,0.009,0.006,0.01,0.011,0.011,0.009,0.017,0.015,0.02,0.012,0.014,0.009,0.018,0.015,0.017,0.006,0.008,0.013,0.017,0.027,0.014,0.014,0.007,0.014,0.01,0.014,0.009,0.015,0.016,0.019,0.016,0.017,0.01,0.029,0.023,0.03,0.009,0.007,0.019,0.02,0.02,0.032,0.02,0.016,0.018,0.012,0.015,0.013,0.029,0.021,0.015,0.026,0.018,0.014,0.027,0.02,0.03,0.011,0.013,0.016,0.016,0.025,0.017,0.018,0.018,0.017,0.01,0.017,0.013,0.017,0.021,0.018,0.017,0.016,0.011,0.028,0.02,0.028,0.01,0.01,0.051,0.044,0.026,0.037,0.046,0.055,0.039,0.02,0.05,0.032,0.034,0.038,0.018,0.032,0.03,0.039,0.028,0.03,0.028,0.202]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Since we used simulated data we can compare model estimates with the truth. For example, the true effect of habitat on occupancy was mean = 0.5 (SD = 0.5). See <code>beta.ranef.cont.habitat.mean</code> and <code>beta.ranef.cont.habitat.sigma</code> in the table above for estimates.</p>
<p>The mean effect of wind on detection probability was -0.5 (SD = 1). See <code>alpha.obs.ranef.cont.wind.mean</code> and <code>alpha.obs.ranef.cont.wind.sigma</code> in the table above for estimates.</p>
<p>Plot response curves (marginal effects)</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_resp_jags_occu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">model1_jags</span>, 
                                    <span class="va">out_ahm_jags</span><span class="op">)</span>
<span class="va">plot_resp_jags_occu</span></code></pre></div>
<pre><code><span class="co">## $habitat</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_resp_jags_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">model1_jags</span>, 
                                   <span class="va">out_ahm_jags</span>,
                                   submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span>
<span class="va">plot_resp_jags_det</span></code></pre></div>
<pre><code><span class="co">## $wind</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-35-2.png" width="700"></p>
<p>Plot coefficient estimates</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_eff_jags_occu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">model1_jags</span>, 
                                <span class="va">out_ahm_jags</span><span class="op">)</span>
<span class="va">plot_eff_jags_occu</span></code></pre></div>
<pre><code><span class="co">## $habitat</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_eff_jags_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">model1_jags</span>, 
                               <span class="va">out_ahm_jags</span>,
                               submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span>
<span class="va">plot_eff_jags_det</span></code></pre></div>
<pre><code><span class="co">## $wind</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-36-2.png" width="700"></p>
<p>By default, species are sorted by effect size. Alternatively, you can have them sorted by species names. Set <code>ordered = FALSE</code>:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_eff_jags_occu2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">model1_jags</span>, 
                                <span class="va">out_ahm_jags</span>,
                                ordered <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">plot_eff_jags_occu2</span></code></pre></div>
<pre><code><span class="co">## $habitat</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="nimble-model">Nimble Model<a class="anchor" aria-label="anchor" href="#nimble-model"></a>
</h2>
<p>Here’s the same model in Nimble:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_nimble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_nimble</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>,
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_nimble</span>,
  nimble <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Wrote model to C:\Users\NIEDBA~1\AppData\Local\Temp\Rtmp8MjixD\file11644f8637fa.txt</span></code></pre>
<p>We use some more iterations, since these Nimble models tend to require more iterations than equivalent JAGS models to achieve good estimates (numbers are still too low for publication quality though).</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compiled model run</span>
<span class="va">out_ahm_nimble2</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_nimble</span>, 
                       n.iter <span class="op">=</span> <span class="fl">5000</span>,
                       n.burnin <span class="op">=</span> <span class="fl">2500</span>,
                       thin <span class="op">=</span> <span class="fl">5</span>,
                       chains <span class="op">=</span> <span class="fl">3</span>,
                       compile <span class="op">=</span> <span class="cn">TRUE</span>,
                       quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Defining model</span></code></pre>
<pre><code><span class="co">## Warning in checkForDeterministicDorR(code[[i]]): Model includes deterministic</span>
<span class="co">## assignment using '&lt;-' of the result of a density ('d') or simulation ('r')</span>
<span class="co">## calculation. This is likely not what you intended in: new.y[i, j, 1:maxocc] &lt;-</span>
<span class="co">## rOcc_v(n = 1, probOcc = psi[i, j], probDetect = p.eff[i, j, 1:maxocc], len =</span>
<span class="co">## maxocc).</span></code></pre>
<pre><code><span class="co">##   [Note] Using 'y' (given within 'constants') as data.</span></code></pre>
<pre><code><span class="co">## Building model</span></code></pre>
<pre><code><span class="co">## Setting data and initial values</span></code></pre>
<pre><code><span class="co">## Running calculate on model</span>
<span class="co">##   [Note] Any error reports that follow may simply reflect missing values in model variables.</span></code></pre>
<pre><code><span class="co">## Error in if (u &gt; probOcc) return(nimNumeric(0, length = k)) : </span>
<span class="co">##   missing value where TRUE/FALSE needed</span></code></pre>
<pre><code><span class="co">## Checking model sizes and dimensions</span></code></pre>
<pre><code><span class="co">##   [Note] This model is not fully initialized. This is not an error.</span>
<span class="co">##          To see which variables are not initialized, use model$initializeInfo().</span>
<span class="co">##          For more information on model initialization, see help(modelInitialization).</span></code></pre>
<pre><code><span class="co">## Compiling</span>
<span class="co">##   [Note] This may take a minute.</span>
<span class="co">##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span>
<span class="co">## Compiling</span>
<span class="co">##   [Note] This may take a minute.</span>
<span class="co">##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></code></pre>
<pre><code><span class="co">## running chain 1...</span></code></pre>
<pre><code><span class="co">## running chain 2...</span></code></pre>
<pre><code><span class="co">## running chain 3...</span></code></pre>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_ahm_nimble2</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-2f69770b291343ba56d9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2f69770b291343ba56d9">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat[1]","beta.ranef.cont.habitat[2]","beta.ranef.cont.habitat[3]","beta.ranef.cont.habitat[4]","beta.ranef.cont.habitat[5]","beta.ranef.cont.habitat[6]","beta.ranef.cont.habitat[7]","beta.ranef.cont.habitat[8]","beta.ranef.cont.habitat[9]","beta.ranef.cont.habitat[10]","beta.ranef.cont.habitat[11]","beta.ranef.cont.habitat[12]","beta.ranef.cont.habitat[13]","beta.ranef.cont.habitat[14]","beta.ranef.cont.habitat[15]","beta.ranef.cont.habitat[16]","beta.ranef.cont.habitat[17]","beta.ranef.cont.habitat[18]","beta.ranef.cont.habitat[19]","beta.ranef.cont.habitat.mean","beta.ranef.cont.habitat.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.437,0.398,0.537,0.785,0.194,0.317,0.148,0.461,0.507,0.473,0.477,0.331,0.359,0.431,0.41,0.635,0.441,0.761,0.539,0.697,25.389,33.949,49.187,19.756,20.858,26.47,31.757,71.755,32.851,59.2,21.526,18.846,52.115,27.96,41.443,46.25,35.68,27.956,25.713,668.661,1.096,-0.009,-0.231,-0.195,0.288,-0.818,-0.585,-0.932,-0.352,0.153,0.839,0.348,-1.293,-0.976,-0.577,-0.047,-0.768,-0.588,-0.43,-0.269,0.804,-1.528,-1.159,-0.847,-1.802,-1.639,-0.522,-1.282,0.731,-1.13,0.247,-1.816,-2.005,-0.652,-1.713,-1.006,-0.45,-1.506,-1.69,-1.958,-1.138,0.978,-0.468,0.061,0.701,2.067,-0.619,1.057,0.411,-0.627,0.388,-0.854,2.2,1.063,-0.083,1.579,0.763,0.549,0.956,0.637,1.225,0.585,1.135,-0.802,-1.465,-2.186,-0.796,-0.835,0.448,-1.162,-1.308,-1.055,-1.234,-1.248,-1.072,-1.878,-1.235,-1.621,-1.022,-2.01,-1.715,-1.897,-1.265,0.83,25.953,33.435,46.523,20.923,21.689,33.673,31.798,71.462,32.797,59.267,22.206,19.112,52.067,28.119,40.019,46.506,34.09,27.392,24.593,671.626],[0.496,0.49,0.499,0.411,0.396,0.466,0.355,0.499,0.5,0.499,0.5,0.471,0.48,0.495,0.492,0.482,0.497,0.427,0.499,0.46,6.751,12.591,24.379,7.519,6.895,3.093,10.382,7.662,9.455,7.713,7.423,8.644,14.726,10.461,13.49,9.544,20.208,13.784,17.679,65.724,0.518,0.386,0.625,0.418,0.341,0.245,0.395,0.397,0.371,0.332,0.577,0.542,0.657,0.503,0.548,0.347,0.644,0.492,0.688,0.231,0.231,0.428,0.559,0.929,0.478,0.453,0.244,0.53,0.372,0.445,0.319,0.54,0.613,0.66,0.599,0.555,0.369,0.938,0.735,0.935,0.284,0.234,0.585,0.632,0.768,1.017,0.691,0.546,0.677,0.466,0.58,0.524,1.057,0.74,0.582,0.849,0.709,0.525,0.887,0.729,0.932,0.342,0.366,0.517,0.582,0.728,0.595,0.607,0.554,0.55,0.433,0.517,0.442,0.563,0.661,0.561,0.588,0.558,0.433,0.787,0.679,0.751,0.275,0.274,7.725,12.96,23.347,7.583,7.39,8.042,10.925,12.809,10.228,11.523,7.526,8.708,14.712,10.647,13.625,11.23,19.47,13.443,16.684,69.259],[0.013,0.013,0.013,0.011,0.01,0.012,0.009,0.013,0.013,0.013,0.013,0.012,0.012,0.013,0.013,0.012,0.013,0.011,0.013,0.012,0.174,0.325,0.629,0.194,0.178,0.08,0.268,0.198,0.244,0.199,0.192,0.223,0.38,0.27,0.348,0.246,0.522,0.356,0.456,1.697,0.013,0.01,0.016,0.011,0.009,0.006,0.01,0.01,0.01,0.009,0.015,0.014,0.017,0.013,0.014,0.009,0.017,0.013,0.018,0.006,0.006,0.011,0.014,0.024,0.012,0.012,0.006,0.014,0.01,0.011,0.008,0.014,0.016,0.017,0.015,0.014,0.01,0.024,0.019,0.024,0.007,0.006,0.015,0.016,0.02,0.026,0.018,0.014,0.017,0.012,0.015,0.014,0.027,0.019,0.015,0.022,0.018,0.014,0.023,0.019,0.024,0.009,0.009,0.013,0.015,0.019,0.015,0.016,0.014,0.014,0.011,0.013,0.011,0.015,0.017,0.014,0.015,0.014,0.011,0.02,0.018,0.019,0.007,0.007,0.199,0.335,0.603,0.196,0.191,0.208,0.282,0.331,0.264,0.298,0.194,0.225,0.38,0.275,0.352,0.29,0.503,0.347,0.431,1.788],[0.015,0.015,0.014,0.011,0.011,0.012,0.01,0.013,0.013,0.014,0.013,0.011,0.012,0.014,0.013,0.012,0.013,0.012,0.013,0.012,0.211,0.456,0.788,0.218,0.237,0.095,0.336,0.228,0.292,0.236,0.242,0.298,0.551,0.327,0.418,0.307,0.708,0.462,0.681,3.107,0.019,0.014,0.019,0.013,0.01,0.008,0.013,0.012,0.011,0.01,0.023,0.018,0.029,0.017,0.016,0.011,0.021,0.016,0.023,0.006,0.01,0.015,0.02,0.038,0.014,0.016,0.008,0.018,0.011,0.014,0.01,0.02,0.022,0.029,0.019,0.017,0.011,0.038,0.026,0.039,0.012,0.009,0.019,0.02,0.023,0.043,0.029,0.022,0.023,0.017,0.018,0.019,0.045,0.023,0.018,0.03,0.022,0.015,0.03,0.023,0.035,0.011,0.019,0.019,0.019,0.03,0.02,0.025,0.027,0.019,0.015,0.017,0.015,0.018,0.024,0.021,0.018,0.019,0.014,0.031,0.028,0.029,0.011,0.014,0.275,0.457,0.768,0.235,0.272,0.271,0.356,0.373,0.311,0.343,0.257,0.309,0.551,0.339,0.426,0.387,0.733,0.469,0.654,3.301]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Plot responses (marginal effects):</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_resp_nimble_occu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">model1_nimble</span>, 
                                      <span class="va">out_ahm_nimble2</span><span class="op">)</span>
<span class="va">plot_resp_nimble_occu</span></code></pre></div>
<pre><code><span class="co">## $habitat</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-40-1.png" width="700"></p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_resp_nimble_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">model1_nimble</span>, 
                                     <span class="va">out_ahm_nimble2</span>,
                                     submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span>
<span class="va">plot_resp_nimble_det</span></code></pre></div>
<pre><code><span class="co">## $wind</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-40-2.png" width="700"></p>
<p>Plot coefficient estimates:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_eff_nimble_occu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">model1_nimble</span>, 
                                  <span class="va">out_ahm_nimble2</span><span class="op">)</span>
<span class="va">plot_eff_nimble_occu</span></code></pre></div>
<pre><code><span class="co">## $habitat</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-41-1.png" width="700"></p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_eff_nimble_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">model1_nimble</span>, 
                                 <span class="va">out_ahm_nimble2</span>,
                                 submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span>
<span class="va">plot_eff_nimble_det</span></code></pre></div>
<pre><code><span class="co">## $wind</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-41-2.png" width="700"></p>
</div>
</div>
<div class="section level1">
<h1 id="further-possibilies">Further possibilies<a class="anchor" aria-label="anchor" href="#further-possibilies"></a>
</h1>
<p>This section demonstrates additional possibilities. The models here are (mostly) fit in JAGS, but can also be fit with Nimble.</p>
<div class="section level2">
<h2 id="fixed-effects">Fixed effects<a class="anchor" aria-label="anchor" href="#fixed-effects"></a>
</h2>
<p>One can define fixed effects of covariates if the responses are thought to be constant across all species. This might make sense for the effect of sampling effort in camera trapping studies.</p>
</div>
<div class="section level2">
<h2 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h2>
<p>It is not yet possible to customize priors. The current defaults are:</p>
<ul>
<li>dnorm(0, 0.05) : random effect means</li>
<li>dgamma(0.1, 0.1): random effect precision (tau)</li>
</ul>
<p>Future versions may allow more flexibility. In the meantime feel free to adjust the model code in the txt file as needed.</p>
</div>
<div class="section level2">
<h2 id="data-augmentation">Data augmentation<a class="anchor" aria-label="anchor" href="#data-augmentation"></a>
</h2>
<p><code>communityModel</code> has an argument <code>augmentation</code>, which can implement fully open data augmentation or data augmentation up to a known maximum number of species.</p>
<p>We know there are 20 species in the simulated community example. We can inform the model that the community is known to consist of 20 species via: <code>augmentation = c(maxknown = 20)</code>:</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_aug1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_aug1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list          <span class="op">=</span> <span class="va">input_AHM</span>,
  augmentation       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span>maxknown <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
  modelFile          <span class="op">=</span> <span class="va">modelFile_jags_aug1</span><span class="op">)</span>

<span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_aug1</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_aug1</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span> ,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<p>Here is another example with fully open data augmentation (metacommunity size is unknown). The model will estimate the probability for each species to be part of the metacommunity. Fully open data augmentation is specified with <code>augmentation = c(full = 30)</code> (for a maximum potential community size of 30 species in this example).</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_aug2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_aug2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  augmentation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span>full <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_aug2</span><span class="op">)</span>

<span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_aug2</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_aug2</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<p>See parameters “omega” and “w[1]” to “w[30]” in the model output:</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_aug2</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-3857c7058a76b7a62254" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3857c7058a76b7a62254">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Bpvalue_species[20]","Bpvalue_species[21]","Bpvalue_species[22]","Bpvalue_species[23]","Bpvalue_species[24]","Bpvalue_species[25]","Bpvalue_species[26]","Bpvalue_species[27]","Bpvalue_species[28]","Bpvalue_species[29]","Bpvalue_species[30]","Nspecies","Ntotal","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R2[20]","R2[21]","R2[22]","R2[23]","R2[24]","R2[25]","R2[26]","R2[27]","R2[28]","R2[29]","R2[30]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind[20]","alpha.obs.ranef.cont.wind[21]","alpha.obs.ranef.cont.wind[22]","alpha.obs.ranef.cont.wind[23]","alpha.obs.ranef.cont.wind[24]","alpha.obs.ranef.cont.wind[25]","alpha.obs.ranef.cont.wind[26]","alpha.obs.ranef.cont.wind[27]","alpha.obs.ranef.cont.wind[28]","alpha.obs.ranef.cont.wind[29]","alpha.obs.ranef.cont.wind[30]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0[20]","alpha0[21]","alpha0[22]","alpha0[23]","alpha0[24]","alpha0[25]","alpha0[26]","alpha0[27]","alpha0[28]","alpha0[29]","alpha0[30]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat[1]","beta.ranef.cont.habitat[2]","beta.ranef.cont.habitat[3]","beta.ranef.cont.habitat[4]","beta.ranef.cont.habitat[5]","beta.ranef.cont.habitat[6]","beta.ranef.cont.habitat[7]","beta.ranef.cont.habitat[8]","beta.ranef.cont.habitat[9]","beta.ranef.cont.habitat[10]","beta.ranef.cont.habitat[11]","beta.ranef.cont.habitat[12]","beta.ranef.cont.habitat[13]","beta.ranef.cont.habitat[14]","beta.ranef.cont.habitat[15]","beta.ranef.cont.habitat[16]","beta.ranef.cont.habitat[17]","beta.ranef.cont.habitat[18]","beta.ranef.cont.habitat[19]","beta.ranef.cont.habitat[20]","beta.ranef.cont.habitat[21]","beta.ranef.cont.habitat[22]","beta.ranef.cont.habitat[23]","beta.ranef.cont.habitat[24]","beta.ranef.cont.habitat[25]","beta.ranef.cont.habitat[26]","beta.ranef.cont.habitat[27]","beta.ranef.cont.habitat[28]","beta.ranef.cont.habitat[29]","beta.ranef.cont.habitat[30]","beta.ranef.cont.habitat.mean","beta.ranef.cont.habitat.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0[20]","beta0[21]","beta0[22]","beta0[23]","beta0[24]","beta0[25]","beta0[26]","beta0[27]","beta0[28]","beta0[29]","beta0[30]","beta0.mean","beta0.sigma","n0","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R2[20]","new.R2[21]","new.R2[22]","new.R2[23]","new.R2[24]","new.R2[25]","new.R2[26]","new.R2[27]","new.R2[28]","new.R2[29]","new.R2[30]","new.R3","omega","w[1]","w[2]","w[3]","w[4]","w[5]","w[6]","w[7]","w[8]","w[9]","w[10]","w[11]","w[12]","w[13]","w[14]","w[15]","w[16]","w[17]","w[18]","w[19]","w[20]","w[21]","w[22]","w[23]","w[24]","w[25]","w[26]","w[27]","w[28]","w[29]","w[30]"],[0.549,0.458,0.484,0.549,0.176,0.314,0.549,0.712,0.477,0.542,0.275,0.307,0.353,0.667,0.471,0.667,0.477,0.621,0.503,0.444,0.065,0.02,0.059,0.072,0.065,0.072,0.033,0.026,0.033,0.039,0.059,20.294,21.523,3.963,2.401,1.043,2.572,4,4.422,3.47,0.633,2.989,1.22,1.915,2.399,0.922,2.169,1.787,2.053,1.206,1.439,1.363,0.187,0.042,0.117,0.163,0.184,0.134,0.076,0.049,0.088,0.149,0.176,43.331,1.079,-0.056,-0.212,-0.179,0.237,-0.843,-0.634,-0.915,-0.379,0.163,0.845,0.314,-1.348,-0.966,-0.637,-0.045,-0.739,-0.613,-0.456,-0.33,-0.369,-0.3,-0.249,-0.365,-0.252,-0.257,-0.354,-0.221,-0.357,-0.169,-0.29,0.792,-1.562,-1.156,-0.769,-1.843,-1.765,-0.573,-1.335,0.738,-1.065,0.223,-1.88,-2.052,-0.696,-1.695,-0.967,-0.416,-1.443,-1.717,-1.98,-1.348,-1.198,-1.462,-1.523,-1.565,-1.356,-1.211,-1.38,-1.417,-1.449,-1.428,-1.253,1.062,-0.474,0.13,0.683,1.919,-0.548,1.115,0.415,-0.647,0.434,-0.851,2.147,1.032,-0.074,1.433,0.699,0.398,0.822,0.671,1.297,0.605,0.5,0.694,0.674,0.62,0.638,0.531,0.504,0.572,0.557,0.456,0.577,1.084,-0.663,-1.511,-2.398,-0.738,-0.713,0.56,-1.136,-1.382,-1.149,-1.204,-1.272,-1.05,-1.972,-1.297,-1.739,-1.074,-2.258,-1.806,-2.038,-1.793,-1.681,-1.808,-1.997,-1.873,-1.671,-1.827,-1.882,-1.733,-1.766,-1.812,-1.509,1.042,2.523,4.112,2.243,0.567,3.466,4.542,4.419,2.607,0.727,2.658,1.47,2.441,2.746,0.595,2.142,1.373,2.114,0.774,1.356,1.223,0.116,0.031,0.061,0.107,0.139,0.069,0.059,0.042,0.068,0.113,0.122,42.498,0.692,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0.255,0.131,0.196,0.314,0.314,0.196,0.255,0.196,0.183,0.248,0.235],[0.499,0.5,0.501,0.499,0.382,0.466,0.499,0.454,0.501,0.5,0.448,0.463,0.479,0.473,0.501,0.473,0.501,0.487,0.502,0.499,0.248,0.139,0.236,0.259,0.248,0.259,0.178,0.16,0.178,0.195,0.236,1.292,2.458,2.456,2.057,1.274,1.51,1.991,2.092,2.018,0.44,1.998,1.309,1.242,1.515,0.894,1.369,1.564,1.929,1.179,1.206,1.198,0.568,0.241,0.424,0.457,0.487,0.453,0.289,0.211,0.425,0.483,0.748,8.108,0.497,0.394,0.701,0.433,0.355,0.264,0.431,0.376,0.422,0.364,0.651,0.493,0.696,0.485,0.573,0.319,0.654,0.516,0.717,0.768,0.815,0.894,0.9,0.832,0.843,0.828,0.908,0.878,0.825,0.789,0.226,0.224,0.486,0.57,0.927,0.456,0.522,0.28,0.541,0.348,0.447,0.342,0.662,0.614,0.723,0.561,0.614,0.379,0.877,0.865,0.935,1.266,1.339,1.293,1.185,1.239,1.248,1.285,1.219,1.063,1.246,1.197,0.304,0.315,0.585,0.67,0.781,0.923,0.62,0.573,0.649,0.468,0.606,0.52,0.993,0.786,0.577,1.075,0.734,0.503,0.879,0.623,0.918,1.011,1.145,1.185,1.042,1.059,1.152,1.102,1.041,1.087,1.191,1.262,0.308,0.365,0.711,0.621,0.831,0.605,0.686,0.582,0.639,0.424,0.537,0.454,0.637,0.78,0.551,0.62,0.599,0.474,0.836,0.753,0.925,1.394,1.381,1.376,1.471,1.432,1.239,1.437,1.353,1.481,1.445,1.438,0.49,0.431,2.458,1.951,1.539,0.779,1.243,1.721,2.424,1.656,0.623,1.643,1.119,1.297,1.326,0.803,1.159,1.203,1.638,0.933,1.003,0.939,0.378,0.166,0.226,0.319,0.368,0.281,0.265,0.161,0.299,0.39,0.647,6.462,0.111,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.437,0.338,0.398,0.466,0.466,0.398,0.437,0.398,0.388,0.433,0.426],[0.04,0.04,0.041,0.04,0.031,0.038,0.04,0.037,0.041,0.04,0.036,0.037,0.039,0.038,0.04,0.038,0.041,0.039,0.041,0.04,0.02,0.011,0.019,0.021,0.02,0.021,0.014,0.013,0.014,0.016,0.019,0.104,0.199,0.199,0.166,0.103,0.122,0.161,0.169,0.163,0.036,0.162,0.106,0.1,0.123,0.072,0.111,0.126,0.156,0.095,0.097,0.097,0.046,0.019,0.034,0.037,0.039,0.037,0.023,0.017,0.034,0.039,0.061,0.655,0.04,0.032,0.057,0.035,0.029,0.021,0.035,0.03,0.034,0.029,0.053,0.04,0.056,0.039,0.046,0.026,0.053,0.042,0.058,0.062,0.066,0.072,0.073,0.067,0.068,0.067,0.073,0.071,0.067,0.064,0.018,0.018,0.039,0.046,0.075,0.037,0.042,0.023,0.044,0.028,0.036,0.028,0.054,0.05,0.058,0.045,0.05,0.031,0.071,0.07,0.076,0.102,0.108,0.105,0.096,0.1,0.101,0.104,0.099,0.086,0.101,0.097,0.025,0.025,0.047,0.054,0.063,0.075,0.05,0.046,0.052,0.038,0.049,0.042,0.08,0.064,0.047,0.087,0.059,0.041,0.071,0.05,0.074,0.082,0.093,0.096,0.084,0.086,0.093,0.089,0.084,0.088,0.096,0.102,0.025,0.03,0.057,0.05,0.067,0.049,0.055,0.047,0.052,0.034,0.043,0.037,0.052,0.063,0.045,0.05,0.048,0.038,0.068,0.061,0.075,0.113,0.112,0.111,0.119,0.116,0.1,0.116,0.109,0.12,0.117,0.116,0.04,0.035,0.199,0.158,0.124,0.063,0.1,0.139,0.196,0.134,0.05,0.133,0.09,0.105,0.107,0.065,0.094,0.097,0.132,0.075,0.081,0.076,0.031,0.013,0.018,0.026,0.03,0.023,0.021,0.013,0.024,0.032,0.052,0.522,0.009,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.035,0.027,0.032,0.038,0.038,0.032,0.035,0.032,0.031,0.035,0.034],[0.04,0.04,0.037,0.045,0.031,0.038,0.041,0.037,0.044,0.041,0.036,0.039,0.039,0.035,0.035,0.036,0.037,0.039,0.038,0.035,0.039,0.015,0.019,0.022,0.023,0.03,0.014,0.013,0.018,0.016,0.022,0.339,0.531,0.34,0.165,0.123,0.121,0.21,0.2,0.209,0.036,0.175,0.106,0.101,0.152,0.075,0.111,0.127,0.156,0.095,0.103,0.097,0.12,0.026,0.035,0.044,0.056,0.058,0.041,0.019,0.051,0.044,0.066,0.879,0.042,0.032,0.057,0.031,0.025,0.021,0.038,0.028,0.032,0.025,0.052,0.04,0.059,0.041,0.046,0.02,0.047,0.034,0.056,0.073,0.077,0.067,0.073,0.081,0.068,0.067,0.074,0.072,0.066,0.055,0.016,0.022,0.061,0.046,0.095,0.034,0.049,0.023,0.056,0.025,0.036,0.031,0.059,0.056,0.064,0.042,0.05,0.028,0.069,0.086,0.091,0.127,0.148,0.123,0.12,0.129,0.17,0.123,0.133,0.087,0.164,0.14,0.038,0.048,0.041,0.057,0.06,0.091,0.05,0.046,0.066,0.038,0.055,0.047,0.11,0.07,0.045,0.116,0.066,0.039,0.075,0.066,0.088,0.082,0.091,0.096,0.085,0.112,0.082,0.11,0.084,0.096,0.105,0.118,0.033,0.065,0.087,0.046,0.1,0.056,0.07,0.113,0.06,0.041,0.043,0.041,0.056,0.107,0.045,0.05,0.062,0.049,0.1,0.091,0.133,0.188,0.182,0.168,0.274,0.197,0.134,0.16,0.198,0.195,0.25,0.15,0.088,0.093,0.531,0.181,0.116,0.069,0.092,0.163,0.187,0.115,0.05,0.152,0.109,0.113,0.156,0.071,0.084,0.098,0.131,0.076,0.09,0.076,0.061,0.016,0.026,0.058,0.05,0.04,0.046,0.017,0.034,0.064,0.078,0.667,0.019,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.068,0.047,0.061,0.088,0.052,0.065,0.062,0.055,0.052,0.084,0.062]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Higher numbers of species in data augmentation increase model run time.</p>
</div>
<div class="section level2">
<h2 id="categorical-covariates">Categorical covariates<a class="anchor" aria-label="anchor" href="#categorical-covariates"></a>
</h2>
<div class="section level3">
<h3 id="site-covariates">Site covariates<a class="anchor" aria-label="anchor" href="#site-covariates"></a>
</h3>
<p>Site covariates will be interpreted as categorical if they are factors in the input data frame. If a random effect of a categorical covariate is defined, there will be independent species-level random effects within each factor level of the categorical covariate. In other words, each factor level will have its own and independent random effect of species.</p>
<p>Here is an example with a categorical site covariate “categ” on occupancy:</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_categ1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model_jags_categ1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"categ"</span><span class="op">)</span><span class="op">)</span>,
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_categ1</span><span class="op">)</span>

<span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_categ1</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model_jags_categ1</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<p>Plot the results:</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">model_jags_categ1</span>,
             mcmc.list <span class="op">=</span> <span class="va">out_ahm_jags_categ1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $categ</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-46-1.png" width="700"></p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">model_jags_categ1</span>,
          mcmc.list <span class="op">=</span> <span class="va">out_ahm_jags_categ1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $categ</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-46-2.png" width="700"></p>
<p>In the table below, see the arguments <code>beta.ranef.categ.categ</code>. The species effects have two indices: [species, factorLevel]. Accordingly, there are three estimates for <code>mean</code> and <code>SD</code>, respectively. All estimates for the first factor level are 0, since the intercept refers to the first factor level (i.e. reference level, which we defined as “medium” above).</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_categ1</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-a6436a7367a109aceb1b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a6436a7367a109aceb1b">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.categ.categ[1,1]","beta.ranef.categ.categ[2,1]","beta.ranef.categ.categ[3,1]","beta.ranef.categ.categ[4,1]","beta.ranef.categ.categ[5,1]","beta.ranef.categ.categ[6,1]","beta.ranef.categ.categ[7,1]","beta.ranef.categ.categ[8,1]","beta.ranef.categ.categ[9,1]","beta.ranef.categ.categ[10,1]","beta.ranef.categ.categ[11,1]","beta.ranef.categ.categ[12,1]","beta.ranef.categ.categ[13,1]","beta.ranef.categ.categ[14,1]","beta.ranef.categ.categ[15,1]","beta.ranef.categ.categ[16,1]","beta.ranef.categ.categ[17,1]","beta.ranef.categ.categ[18,1]","beta.ranef.categ.categ[19,1]","beta.ranef.categ.categ[1,2]","beta.ranef.categ.categ[2,2]","beta.ranef.categ.categ[3,2]","beta.ranef.categ.categ[4,2]","beta.ranef.categ.categ[5,2]","beta.ranef.categ.categ[6,2]","beta.ranef.categ.categ[7,2]","beta.ranef.categ.categ[8,2]","beta.ranef.categ.categ[9,2]","beta.ranef.categ.categ[10,2]","beta.ranef.categ.categ[11,2]","beta.ranef.categ.categ[12,2]","beta.ranef.categ.categ[13,2]","beta.ranef.categ.categ[14,2]","beta.ranef.categ.categ[15,2]","beta.ranef.categ.categ[16,2]","beta.ranef.categ.categ[17,2]","beta.ranef.categ.categ[18,2]","beta.ranef.categ.categ[19,2]","beta.ranef.categ.categ[1,3]","beta.ranef.categ.categ[2,3]","beta.ranef.categ.categ[3,3]","beta.ranef.categ.categ[4,3]","beta.ranef.categ.categ[5,3]","beta.ranef.categ.categ[6,3]","beta.ranef.categ.categ[7,3]","beta.ranef.categ.categ[8,3]","beta.ranef.categ.categ[9,3]","beta.ranef.categ.categ[10,3]","beta.ranef.categ.categ[11,3]","beta.ranef.categ.categ[12,3]","beta.ranef.categ.categ[13,3]","beta.ranef.categ.categ[14,3]","beta.ranef.categ.categ[15,3]","beta.ranef.categ.categ[16,3]","beta.ranef.categ.categ[17,3]","beta.ranef.categ.categ[18,3]","beta.ranef.categ.categ[19,3]","beta.ranef.categ.categ.mean[1]","beta.ranef.categ.categ.mean[2]","beta.ranef.categ.categ.mean[3]","beta.ranef.categ.categ.sigma[1]","beta.ranef.categ.categ.sigma[2]","beta.ranef.categ.categ.sigma[3]","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.418,0.366,0.529,0.529,0.222,0.333,0.503,0.699,0.529,0.562,0.242,0.281,0.418,0.725,0.503,0.549,0.379,0.471,0.621,0.503,19,3.531,1.98,0.95,2.827,3.698,4.303,3.053,0.668,2.975,1.135,2.136,2.888,0.846,2.287,1.351,1.79,1.16,1.906,1.392,40.878,1.068,0.072,-0.14,-0.165,0.287,-0.806,-0.518,-0.877,-0.314,0.176,0.766,0.306,-1.093,-0.885,-0.457,-0.043,-0.699,-0.565,-0.213,-0.23,0.747,-1.555,-1.075,-0.649,-1.878,-1.552,-0.521,-1.223,0.708,-1.04,0.262,-1.847,-2.09,-0.475,-1.773,-0.903,-0.411,-1.31,-1.893,-2.176,-1.092,1.038,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.369,-0.243,-0.967,-1.169,0.353,-0.65,-0.197,0.389,-0.342,0.68,-1.058,-0.381,-0.642,-1.138,-1.208,-0.415,-1.052,-0.244,-0.783,-0.224,-2.111,-1.509,2.634,-1.861,2.223,-1.702,-0.33,-0.051,-0.373,3.626,1.831,-1.595,2.53,-1.999,-0.4,-1.751,1.356,1.155,0,-0.456,-0.024,0,0.945,2.553,-0.74,-1.293,-1.963,-0.871,-0.721,0.202,-1.139,-1.198,-1.062,-1.165,-1.45,-1.203,-1.714,-1.403,-1.517,-0.993,-1.988,-1.785,-1.87,-1.246,0.782,4.031,1.841,0.538,3.676,4.146,4.372,2.232,0.749,2.812,1.472,2.859,2.99,0.491,2.392,1.273,1.984,0.815,1.562,1.197,41.432],[0.495,0.483,0.501,0.501,0.417,0.473,0.502,0.46,0.501,0.498,0.43,0.451,0.495,0.448,0.502,0.499,0.487,0.501,0.487,0.502,0,2.411,1.729,1.368,1.506,2.119,1.964,1.862,0.45,2.145,1.604,1.345,1.556,1.117,1.379,1.179,1.699,1.412,1.319,1.074,7.447,0.475,0.415,0.629,0.433,0.343,0.249,0.36,0.422,0.398,0.348,0.572,0.489,0.612,0.49,0.534,0.345,0.551,0.529,0.595,0.21,0.209,0.51,0.551,1.023,0.448,0.469,0.256,0.554,0.395,0.47,0.326,0.529,0.606,0.691,0.559,0.543,0.334,0.858,0.708,0.985,0.295,0.251,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.797,0.712,1.032,1.069,0.763,0.675,0.833,0.628,0.716,0.726,1.185,0.94,0.793,1.056,1.101,0.718,1.202,0.93,1.178,1.577,2.992,2.697,2.033,2.395,2.155,2.308,0.982,1.514,1.056,2.712,1.884,2.11,2.461,2.999,1.129,2.711,1.95,1.939,0,0.471,0.95,0,0.559,1.544,0.596,0.608,0.594,0.55,0.57,0.573,0.565,0.44,0.545,0.507,0.698,0.689,0.591,0.576,0.519,0.458,0.817,0.599,0.9,0.283,0.257,1.911,1.373,0.888,1.333,1.822,2.219,1.477,0.701,1.7,1.309,1.472,1.233,0.624,1.083,1.031,1.66,0.987,1.093,0.906,6.536],[0.04,0.039,0.04,0.04,0.034,0.038,0.041,0.037,0.04,0.04,0.035,0.036,0.04,0.036,0.041,0.04,0.039,0.04,0.039,0.041,0,0.195,0.14,0.111,0.122,0.171,0.159,0.151,0.036,0.173,0.13,0.109,0.126,0.09,0.111,0.095,0.137,0.114,0.107,0.087,0.602,0.038,0.034,0.051,0.035,0.028,0.02,0.029,0.034,0.032,0.028,0.046,0.04,0.049,0.04,0.043,0.028,0.045,0.043,0.048,0.017,0.017,0.041,0.045,0.083,0.036,0.038,0.021,0.045,0.032,0.038,0.026,0.043,0.049,0.056,0.045,0.044,0.027,0.069,0.057,0.08,0.024,0.02,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.064,0.058,0.083,0.086,0.062,0.055,0.067,0.051,0.058,0.059,0.096,0.076,0.064,0.085,0.089,0.058,0.097,0.075,0.095,0.127,0.242,0.218,0.164,0.194,0.174,0.187,0.079,0.122,0.085,0.219,0.152,0.171,0.199,0.242,0.091,0.219,0.158,0.157,0,0.038,0.077,0,0.045,0.125,0.048,0.049,0.048,0.044,0.046,0.046,0.046,0.036,0.044,0.041,0.056,0.056,0.048,0.047,0.042,0.037,0.066,0.048,0.073,0.023,0.021,0.154,0.111,0.072,0.108,0.147,0.179,0.119,0.057,0.137,0.106,0.119,0.1,0.05,0.088,0.083,0.134,0.08,0.088,0.073,0.528],[0.034,0.039,0.038,0.037,0.034,0.042,0.041,0.037,0.034,0.036,0.034,0.035,0.04,0.033,0.04,0.036,0.027,0.039,0.041,0.031,0,0.292,0.141,0.111,0.115,0.212,0.163,0.192,0.036,0.205,0.148,0.157,0.126,0.086,0.111,0.096,0.128,0.109,0.106,0.1,0.831,0.042,0.034,0.055,0.029,0.028,0.02,0.029,0.03,0.027,0.028,0.051,0.04,0.055,0.04,0.04,0.024,0.04,0.039,0.052,0.017,0.019,0.041,0.06,0.092,0.037,0.042,0.017,0.045,0.032,0.033,0.026,0.042,0.049,0.055,0.045,0.044,0.019,0.072,0.067,0.122,0.026,0.02,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.082,0.062,0.119,0.176,0.078,0.088,0.059,0.063,0.066,0.111,0.15,0.063,0.064,0.11,0.174,0.058,0.16,0.074,0.15,0.166,0.448,0.431,0.325,0.366,0.32,0.311,0.08,0.163,0.085,0.439,0.25,0.203,0.321,0.514,0.091,0.411,0.3,0.201,0,0.071,0.086,0,0.11,0.39,0.067,0.043,0.052,0.075,0.059,0.055,0.058,0.036,0.046,0.065,0.085,0.067,0.053,0.052,0.042,0.038,0.091,0.052,0.124,0.035,0.032,0.246,0.109,0.08,0.098,0.199,0.18,0.131,0.057,0.175,0.141,0.127,0.095,0.059,0.109,0.084,0.134,0.082,0.121,0.104,0.624]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="observation-level-covariates">Observation-level covariates<a class="anchor" aria-label="anchor" href="#observation-level-covariates"></a>
</h3>
<p>Currently categorical observation-level covariates are only fully supported in JAGS, not Nimble. Observation-level covariates are matrices and thus can’t be factors. Thus they need to be defined as character matrices.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create example categorical observation covariate</span>
<span class="va">input_AHM</span><span class="op">$</span><span class="va">obsCovs</span><span class="op">$</span><span class="va">wind_categ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">input_AHM</span><span class="op">$</span><span class="va">obsCovs</span><span class="op">$</span><span class="va">wind</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"windy"</span>, <span class="st">"calm"</span><span class="op">)</span>

<span class="co"># result is a character matrix:</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">input_AHM</span><span class="op">$</span><span class="va">obsCovs</span><span class="op">$</span><span class="va">wind_categ</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  chr [1:30, 1:5] "calm" "calm" "windy" "windy" "calm" "calm" "windy" "calm" ...</span></code></pre>
<p>Model example:</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_categ2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model_jags_categ2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wind_categ"</span><span class="op">)</span><span class="op">)</span>,     <span class="co"># "wind_categ" now</span>
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_categ2</span><span class="op">)</span>

<span class="va">out_ahm_jags_categ2</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model_jags_categ2</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>,
                         compile <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
<p>Model estimates. As above, the estimates for the first factor level are 0. The relevant parameters here are called <code>alpha.obs.ranef.categ.wind_categ</code>.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_categ2</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-05bd6a2277db1cb33a3e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-05bd6a2277db1cb33a3e">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.categ.wind_categ[1,1]","alpha.obs.ranef.categ.wind_categ[2,1]","alpha.obs.ranef.categ.wind_categ[3,1]","alpha.obs.ranef.categ.wind_categ[4,1]","alpha.obs.ranef.categ.wind_categ[5,1]","alpha.obs.ranef.categ.wind_categ[6,1]","alpha.obs.ranef.categ.wind_categ[7,1]","alpha.obs.ranef.categ.wind_categ[8,1]","alpha.obs.ranef.categ.wind_categ[9,1]","alpha.obs.ranef.categ.wind_categ[10,1]","alpha.obs.ranef.categ.wind_categ[11,1]","alpha.obs.ranef.categ.wind_categ[12,1]","alpha.obs.ranef.categ.wind_categ[13,1]","alpha.obs.ranef.categ.wind_categ[14,1]","alpha.obs.ranef.categ.wind_categ[15,1]","alpha.obs.ranef.categ.wind_categ[16,1]","alpha.obs.ranef.categ.wind_categ[17,1]","alpha.obs.ranef.categ.wind_categ[18,1]","alpha.obs.ranef.categ.wind_categ[19,1]","alpha.obs.ranef.categ.wind_categ[1,2]","alpha.obs.ranef.categ.wind_categ[2,2]","alpha.obs.ranef.categ.wind_categ[3,2]","alpha.obs.ranef.categ.wind_categ[4,2]","alpha.obs.ranef.categ.wind_categ[5,2]","alpha.obs.ranef.categ.wind_categ[6,2]","alpha.obs.ranef.categ.wind_categ[7,2]","alpha.obs.ranef.categ.wind_categ[8,2]","alpha.obs.ranef.categ.wind_categ[9,2]","alpha.obs.ranef.categ.wind_categ[10,2]","alpha.obs.ranef.categ.wind_categ[11,2]","alpha.obs.ranef.categ.wind_categ[12,2]","alpha.obs.ranef.categ.wind_categ[13,2]","alpha.obs.ranef.categ.wind_categ[14,2]","alpha.obs.ranef.categ.wind_categ[15,2]","alpha.obs.ranef.categ.wind_categ[16,2]","alpha.obs.ranef.categ.wind_categ[17,2]","alpha.obs.ranef.categ.wind_categ[18,2]","alpha.obs.ranef.categ.wind_categ[19,2]","alpha.obs.ranef.categ.wind_categ.mean[1]","alpha.obs.ranef.categ.wind_categ.mean[2]","alpha.obs.ranef.categ.wind_categ.sigma[1]","alpha.obs.ranef.categ.wind_categ.sigma[2]","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.fixed.cont.habitat","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.503,0.373,0.549,0.529,0.222,0.392,0.503,0.588,0.621,0.503,0.222,0.301,0.373,0.66,0.516,0.699,0.451,0.627,0.608,0.477,19,3.594,2.356,0.978,3.315,4.034,4.138,2.946,0.826,3.005,0.976,2.48,2.639,1.037,2.581,1.939,1.75,1.234,1.732,1.321,42.88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.927,-0.139,0.052,-0.784,-0.192,-0.85,-0.697,-0.576,-0.509,0.203,0.329,0.153,-0.809,-1.181,-0.523,-0.071,-0.3,-0.655,-0.387,0,-0.314,0,0.81,-1.859,-1.026,-0.497,-1.67,-1.535,-0.021,-0.921,1.07,-0.839,0.214,-1.855,-2.124,0.308,-1.104,-0.694,-0.353,-1.117,-1.313,-1.827,-0.863,1.112,0.268,-0.632,-1.351,-2.11,-0.668,-0.575,0.184,-1.091,-0.986,-1.011,-0.858,-1.031,-0.984,-1.725,-1.203,-1.623,-1.084,-2.028,-1.611,-1.759,-1.174,0.789,4.123,2.116,0.487,3.971,4.3,4.532,2.579,0.819,2.849,1.331,2.901,2.878,0.61,2.505,1.412,1.821,0.898,1.465,1.212,42.81],[0.502,0.485,0.499,0.501,0.417,0.49,0.502,0.494,0.487,0.502,0.417,0.46,0.485,0.475,0.501,0.46,0.499,0.485,0.49,0.501,0,2.046,1.856,1.276,1.696,2.067,2.11,1.811,0.671,1.984,1.384,1.486,1.391,1.419,1.645,1.462,1.699,1.296,1.192,1.051,6.953,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.697,0.598,0.971,0.588,0.583,0.438,0.699,0.578,0.603,0.487,0.612,0.732,0.888,0.744,0.656,0.479,0.746,0.707,0.763,0,0.299,0,0.299,0.563,0.573,0.782,0.573,0.535,0.272,0.498,0.445,0.555,0.36,0.703,0.71,0.521,0.654,0.56,0.44,0.934,0.854,1.032,0.304,0.259,0.157,0.498,0.524,0.583,0.571,0.624,0.422,0.471,0.365,0.435,0.349,0.53,0.585,0.533,0.56,0.512,0.357,0.701,0.604,0.709,0.271,0.242,1.757,1.405,0.707,1.423,1.717,2.349,1.469,0.76,1.596,1.169,1.355,1.182,0.793,1.344,1.166,1.526,1.059,1.072,0.985,6.098],[0.041,0.039,0.04,0.04,0.034,0.04,0.041,0.04,0.039,0.041,0.034,0.037,0.039,0.038,0.041,0.037,0.04,0.039,0.04,0.041,0,0.165,0.15,0.103,0.137,0.167,0.171,0.146,0.054,0.16,0.112,0.12,0.112,0.115,0.133,0.118,0.137,0.105,0.096,0.085,0.562,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.056,0.048,0.078,0.048,0.047,0.035,0.056,0.047,0.049,0.039,0.049,0.059,0.072,0.06,0.053,0.039,0.06,0.057,0.062,0,0.024,0,0.024,0.046,0.046,0.063,0.046,0.043,0.022,0.04,0.036,0.045,0.029,0.057,0.057,0.042,0.053,0.045,0.036,0.075,0.069,0.083,0.025,0.021,0.013,0.04,0.042,0.047,0.046,0.05,0.034,0.038,0.03,0.035,0.028,0.043,0.047,0.043,0.045,0.041,0.029,0.057,0.049,0.057,0.022,0.02,0.142,0.114,0.057,0.115,0.139,0.19,0.119,0.061,0.129,0.095,0.11,0.096,0.064,0.109,0.094,0.123,0.086,0.087,0.08,0.493],[0.036,0.039,0.055,0.037,0.034,0.048,0.041,0.045,0.036,0.044,0.038,0.037,0.039,0.038,0.041,0.037,0.041,0.036,0.039,0.043,0,0.166,0.15,0.101,0.107,0.174,0.157,0.178,0.054,0.183,0.112,0.121,0.103,0.115,0.146,0.118,0.128,0.113,0.066,0.088,0.641,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.092,0.042,0.09,0.048,0.052,0.036,0.067,0.043,0.053,0.037,0.058,0.059,0.071,0.071,0.053,0.037,0.06,0.054,0.047,0,0.029,0,0.034,0.056,0.054,0.055,0.037,0.053,0.024,0.04,0.037,0.038,0.029,0.056,0.056,0.046,0.053,0.045,0.035,0.064,0.073,0.101,0.025,0.023,0.01,0.041,0.043,0.063,0.044,0.063,0.043,0.041,0.03,0.035,0.026,0.043,0.067,0.051,0.051,0.041,0.027,0.061,0.058,0.09,0.024,0.03,0.14,0.117,0.057,0.115,0.137,0.19,0.113,0.062,0.127,0.086,0.108,0.096,0.064,0.108,0.093,0.124,0.078,0.082,0.087,0.488]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Plot the results:</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">model_jags_categ2</span>, 
             mcmc.list <span class="op">=</span> <span class="va">out_ahm_jags_categ2</span>,
             submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $wind_categ</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-51-1.png" width="700"></p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">model_jags_categ2</span>, 
          mcmc.list <span class="op">=</span> <span class="va">out_ahm_jags_categ2</span>,
          submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $wind_categ</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-51-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="random-effects-other-than-species">Random effects other than species<a class="anchor" aria-label="anchor" href="#random-effects-other-than-species"></a>
</h2>
<p>By default random effects are by species. Alternatively, you can specify random effects of a categorical site covariate2 on continuous covariate1 using the pattern:</p>
<p>occuCovs(ranef = c(“covariate1|covariate2”))</p>
<p>The same syntax can be used in</p>
<p>detCovs(ranef = c(“covariate1|covariate2”))</p>
<p>and</p>
<p>detCovs(ranef = c(“covariate1|covariate2”))</p>
<p>Here is an example, where the effect of “habitat” differs between levels of “categ”.</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_ranef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_ranef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat|categ"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_ranef</span><span class="op">)</span>

<span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_ranef</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_ranef</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<p>Search for the term “habitat_categ” in the table below. There are 2 estimates (for stations with “A” and “B”), plus the mean and sigma of the random effect (this is only for demonstration, 2 factor levels is of course not enough for applying random effects).</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_ranef</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-bbe78d9f6ee0469a764e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bbe78d9f6ee0469a764e">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat_categ[1]","beta.ranef.cont.habitat_categ[2]","beta.ranef.cont.habitat_categ[3]","beta.ranef.cont.habitat_categ.mean","beta.ranef.cont.habitat_categ.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.464,0.346,0.542,0.588,0.163,0.373,0.516,0.654,0.484,0.536,0.19,0.255,0.275,0.745,0.458,0.608,0.464,0.608,0.51,0.497,19,3.202,2.068,1.09,2.826,3.99,3.86,3.009,0.801,2.782,0.936,2.261,2.345,1.152,2.162,1.698,2.072,1.354,1.752,1.373,40.736,1.095,-0.039,-0.188,-0.071,0.258,-0.815,-0.529,-0.964,-0.356,0.136,0.927,0.449,-1.224,-0.883,-0.483,-0.056,-0.645,-0.548,-0.299,-0.238,0.796,-1.496,-1.109,-0.753,-1.924,-1.591,-0.519,-1.219,0.69,-1.114,0.282,-1.996,-2.099,-0.566,-1.792,-0.98,-0.418,-1.287,-1.667,-2.047,-1.161,0.968,0.387,0.224,0.378,0.297,0.638,-0.652,-1.424,-2.045,-0.78,-0.654,0.11,-1.161,-1.048,-1.063,-0.917,-1.062,-1.056,-1.767,-1.251,-1.612,-1.098,-1.95,-1.7,-1.729,-1.162,0.724,3.841,1.883,0.552,3.864,4.276,3.881,2.445,0.856,2.744,1.48,2.912,2.728,0.622,2.193,1.407,2.043,0.865,1.572,1.239,41.404],[0.5,0.477,0.5,0.494,0.371,0.485,0.501,0.477,0.501,0.5,0.393,0.437,0.448,0.437,0.5,0.49,0.5,0.49,0.502,0.502,0,2.011,1.637,1.387,1.813,2.16,1.712,1.901,0.794,1.897,1.176,1.501,1.479,1.254,1.739,1.489,1.945,1.341,1.522,1.128,8.746,0.547,0.417,0.619,0.461,0.315,0.245,0.391,0.46,0.367,0.369,0.6,0.59,0.645,0.552,0.486,0.32,0.649,0.484,0.688,0.251,0.279,0.442,0.528,0.907,0.522,0.433,0.239,0.538,0.381,0.472,0.327,0.572,0.617,0.686,0.616,0.603,0.385,0.852,0.688,0.943,0.305,0.236,0.484,0.215,0.341,0.533,0.506,0.497,0.463,0.631,0.567,0.511,0.375,0.542,0.387,0.445,0.39,0.502,0.674,0.504,0.598,0.509,0.407,0.625,0.633,0.739,0.262,0.218,1.895,1.368,0.765,1.766,1.624,1.924,1.571,0.76,1.742,1.372,1.245,1.3,0.847,1.334,1.067,1.587,0.944,1.232,0.993,6.742],[0.04,0.039,0.04,0.04,0.03,0.039,0.041,0.039,0.041,0.04,0.032,0.035,0.036,0.035,0.04,0.04,0.04,0.04,0.041,0.041,0,0.163,0.132,0.112,0.147,0.175,0.138,0.154,0.064,0.153,0.095,0.121,0.12,0.101,0.141,0.12,0.157,0.108,0.123,0.091,0.707,0.044,0.034,0.05,0.037,0.025,0.02,0.032,0.037,0.03,0.03,0.049,0.048,0.052,0.045,0.039,0.026,0.052,0.039,0.056,0.02,0.023,0.036,0.043,0.073,0.042,0.035,0.019,0.043,0.031,0.038,0.026,0.046,0.05,0.055,0.05,0.049,0.031,0.069,0.056,0.076,0.025,0.019,0.039,0.017,0.028,0.043,0.041,0.04,0.037,0.051,0.046,0.041,0.03,0.044,0.031,0.036,0.032,0.041,0.054,0.041,0.048,0.041,0.033,0.051,0.051,0.06,0.021,0.018,0.153,0.111,0.062,0.143,0.131,0.156,0.127,0.061,0.141,0.111,0.101,0.105,0.068,0.108,0.086,0.128,0.076,0.1,0.08,0.545],[0.041,0.033,0.038,0.033,0.029,0.039,0.048,0.039,0.038,0.037,0.032,0.03,0.031,0.039,0.037,0.043,0.035,0.038,0.038,0.041,0,0.194,0.133,0.112,0.144,0.221,0.123,0.196,0.064,0.154,0.093,0.122,0.119,0.102,0.161,0.134,0.157,0.114,0.149,0.092,1.023,0.049,0.038,0.05,0.041,0.023,0.02,0.029,0.037,0.022,0.03,0.047,0.048,0.052,0.041,0.037,0.025,0.047,0.038,0.074,0.018,0.028,0.036,0.037,0.073,0.077,0.035,0.014,0.058,0.036,0.044,0.023,0.046,0.053,0.056,0.05,0.049,0.033,0.069,0.055,0.118,0.026,0.024,0.037,0.016,0.03,0.043,0.04,0.046,0.035,0.066,0.07,0.049,0.033,0.056,0.036,0.039,0.035,0.047,0.071,0.037,0.06,0.041,0.036,0.059,0.073,0.071,0.031,0.029,0.144,0.102,0.064,0.134,0.142,0.156,0.158,0.058,0.141,0.106,0.098,0.099,0.09,0.108,0.087,0.129,0.077,0.119,0.076,0.556]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Currently random effects other than species can not be plotted with <code>plot_effects</code> and <code>plot_coef</code>.</p>
</div>
<div class="section level2">
<h2 id="nested-random-effects">Nested random effects<a class="anchor" aria-label="anchor" href="#nested-random-effects"></a>
</h2>
<p>Consider a numeric covariate1 and categorical covariate2.</p>
<p>Use the keyword “+Species” to specify a species-specific random effect within each factor level of covariate2:</p>
<p>occuCovs(ranef = c(“covariate1|covariate2+Species”))</p>
<p>Here is an example, with independent random effect of “categ” on “habitat” for each species:</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat|categ+Species"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_nested</span><span class="op">)</span>

<span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_nested</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_nested</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<p>Search for the term “habitat_categ_Species” in the table below. Depending on the number of species and factor levels The number of parameter estimates is very high when using nested random effects.</p>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_nested</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-62c80c7b4633956e4632" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-62c80c7b4633956e4632">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat_categ_Species[1,1]","beta.ranef.cont.habitat_categ_Species[2,1]","beta.ranef.cont.habitat_categ_Species[3,1]","beta.ranef.cont.habitat_categ_Species[4,1]","beta.ranef.cont.habitat_categ_Species[5,1]","beta.ranef.cont.habitat_categ_Species[6,1]","beta.ranef.cont.habitat_categ_Species[7,1]","beta.ranef.cont.habitat_categ_Species[8,1]","beta.ranef.cont.habitat_categ_Species[9,1]","beta.ranef.cont.habitat_categ_Species[10,1]","beta.ranef.cont.habitat_categ_Species[11,1]","beta.ranef.cont.habitat_categ_Species[12,1]","beta.ranef.cont.habitat_categ_Species[13,1]","beta.ranef.cont.habitat_categ_Species[14,1]","beta.ranef.cont.habitat_categ_Species[15,1]","beta.ranef.cont.habitat_categ_Species[16,1]","beta.ranef.cont.habitat_categ_Species[17,1]","beta.ranef.cont.habitat_categ_Species[18,1]","beta.ranef.cont.habitat_categ_Species[19,1]","beta.ranef.cont.habitat_categ_Species[1,2]","beta.ranef.cont.habitat_categ_Species[2,2]","beta.ranef.cont.habitat_categ_Species[3,2]","beta.ranef.cont.habitat_categ_Species[4,2]","beta.ranef.cont.habitat_categ_Species[5,2]","beta.ranef.cont.habitat_categ_Species[6,2]","beta.ranef.cont.habitat_categ_Species[7,2]","beta.ranef.cont.habitat_categ_Species[8,2]","beta.ranef.cont.habitat_categ_Species[9,2]","beta.ranef.cont.habitat_categ_Species[10,2]","beta.ranef.cont.habitat_categ_Species[11,2]","beta.ranef.cont.habitat_categ_Species[12,2]","beta.ranef.cont.habitat_categ_Species[13,2]","beta.ranef.cont.habitat_categ_Species[14,2]","beta.ranef.cont.habitat_categ_Species[15,2]","beta.ranef.cont.habitat_categ_Species[16,2]","beta.ranef.cont.habitat_categ_Species[17,2]","beta.ranef.cont.habitat_categ_Species[18,2]","beta.ranef.cont.habitat_categ_Species[19,2]","beta.ranef.cont.habitat_categ_Species[1,3]","beta.ranef.cont.habitat_categ_Species[2,3]","beta.ranef.cont.habitat_categ_Species[3,3]","beta.ranef.cont.habitat_categ_Species[4,3]","beta.ranef.cont.habitat_categ_Species[5,3]","beta.ranef.cont.habitat_categ_Species[6,3]","beta.ranef.cont.habitat_categ_Species[7,3]","beta.ranef.cont.habitat_categ_Species[8,3]","beta.ranef.cont.habitat_categ_Species[9,3]","beta.ranef.cont.habitat_categ_Species[10,3]","beta.ranef.cont.habitat_categ_Species[11,3]","beta.ranef.cont.habitat_categ_Species[12,3]","beta.ranef.cont.habitat_categ_Species[13,3]","beta.ranef.cont.habitat_categ_Species[14,3]","beta.ranef.cont.habitat_categ_Species[15,3]","beta.ranef.cont.habitat_categ_Species[16,3]","beta.ranef.cont.habitat_categ_Species[17,3]","beta.ranef.cont.habitat_categ_Species[18,3]","beta.ranef.cont.habitat_categ_Species[19,3]","beta.ranef.cont.habitat_categ_Species.mean[1]","beta.ranef.cont.habitat_categ_Species.mean[2]","beta.ranef.cont.habitat_categ_Species.mean[3]","beta.ranef.cont.habitat_categ_Species.mean[4]","beta.ranef.cont.habitat_categ_Species.mean[5]","beta.ranef.cont.habitat_categ_Species.mean[6]","beta.ranef.cont.habitat_categ_Species.mean[7]","beta.ranef.cont.habitat_categ_Species.mean[8]","beta.ranef.cont.habitat_categ_Species.mean[9]","beta.ranef.cont.habitat_categ_Species.mean[10]","beta.ranef.cont.habitat_categ_Species.mean[11]","beta.ranef.cont.habitat_categ_Species.mean[12]","beta.ranef.cont.habitat_categ_Species.mean[13]","beta.ranef.cont.habitat_categ_Species.mean[14]","beta.ranef.cont.habitat_categ_Species.mean[15]","beta.ranef.cont.habitat_categ_Species.mean[16]","beta.ranef.cont.habitat_categ_Species.mean[17]","beta.ranef.cont.habitat_categ_Species.mean[18]","beta.ranef.cont.habitat_categ_Species.mean[19]","beta.ranef.cont.habitat_categ_Species.sigma[1]","beta.ranef.cont.habitat_categ_Species.sigma[2]","beta.ranef.cont.habitat_categ_Species.sigma[3]","beta.ranef.cont.habitat_categ_Species.sigma[4]","beta.ranef.cont.habitat_categ_Species.sigma[5]","beta.ranef.cont.habitat_categ_Species.sigma[6]","beta.ranef.cont.habitat_categ_Species.sigma[7]","beta.ranef.cont.habitat_categ_Species.sigma[8]","beta.ranef.cont.habitat_categ_Species.sigma[9]","beta.ranef.cont.habitat_categ_Species.sigma[10]","beta.ranef.cont.habitat_categ_Species.sigma[11]","beta.ranef.cont.habitat_categ_Species.sigma[12]","beta.ranef.cont.habitat_categ_Species.sigma[13]","beta.ranef.cont.habitat_categ_Species.sigma[14]","beta.ranef.cont.habitat_categ_Species.sigma[15]","beta.ranef.cont.habitat_categ_Species.sigma[16]","beta.ranef.cont.habitat_categ_Species.sigma[17]","beta.ranef.cont.habitat_categ_Species.sigma[18]","beta.ranef.cont.habitat_categ_Species.sigma[19]","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.739,0.621,0.686,0.647,0.163,0.542,0.51,0.745,0.516,0.621,0.314,0.359,0.451,0.693,0.614,0.634,0.477,0.634,0.68,0.601,19,6.678,3.498,1.542,2.686,5.985,4.371,3.607,0.651,3.836,1.29,2.564,2.968,1.118,3.099,1.454,1.872,1.433,3.373,1.708,53.733,0.99,0.01,-0.302,-0.249,0.367,-0.817,-0.599,-0.943,-0.372,0.195,0.663,0.395,-1.368,-1.043,-0.566,-0.023,-0.857,-0.549,-0.477,-0.308,0.784,-1.958,-1.5,-1.162,-1.927,-1.996,-0.531,-1.423,0.769,-1.265,0.292,-1.943,-2.402,-0.68,-2.132,-0.868,-0.412,-1.688,-2.553,-2.465,-1.328,1.154,-9.697,-1.79,6.773,6.195,19.52,0.579,0.631,-0.218,0.945,-1.79,6.042,0.659,-0.482,3.775,0.217,0.444,10.049,-6.88,3.12,-5.178,-0.724,9.432,6.685,-14.555,1.311,0.586,-1.067,0.471,-1.353,6.932,1.24,-0.067,6.675,14.947,0.561,10.996,-4.315,4.722,7.836,-1.899,-4.602,6.395,-43.072,1.625,-1.461,-0.866,0.352,-1.066,6.575,2.413,-2.163,5.544,-8.953,0.062,-41.77,5.849,3.943,-1.079,-1.101,0.903,5.28,-0.682,1.256,0.04,-0.755,0.607,-1.29,5.785,1.501,-0.705,3.954,-0.261,0.248,0.773,0.749,3.294,12.045,1.962,12.706,3.412,40.619,1.643,2.185,1.249,1.407,1.21,2.784,1.919,2.383,3.721,14.943,1.078,32.089,9.488,2.771,-0.884,-1.277,-1.671,-0.65,-0.776,0.556,-0.904,-1.42,-0.794,-1.438,-1.357,-0.938,-1.801,-0.825,-1.305,-0.962,-1.609,-1.373,-1.823,-1.085,0.922,6.102,2.789,0.904,3.605,5.712,4.222,2.699,0.684,3.413,1.423,2.924,3.165,0.702,2.816,1.217,1.917,0.982,2.969,1.421,49.665],[0.441,0.487,0.466,0.479,0.371,0.5,0.502,0.437,0.501,0.487,0.466,0.481,0.499,0.463,0.488,0.483,0.501,0.483,0.468,0.491,0,3.281,2.537,1.577,0.963,1.601,2.103,2.153,0.532,2.325,1.519,1.396,1.569,1.224,1.143,1.39,1.778,1.079,1.942,1.041,8.102,0.496,0.384,0.61,0.368,0.316,0.282,0.365,0.424,0.38,0.334,0.524,0.573,0.661,0.472,0.576,0.36,0.631,0.422,0.621,0.203,0.215,0.54,0.727,1.135,0.469,0.364,0.302,0.528,0.343,0.511,0.292,0.533,0.698,0.667,0.579,0.609,0.386,0.857,0.93,0.995,0.338,0.3,12.019,2.482,11.57,3.374,13.279,1.484,2.016,1.537,1.917,1.5,3.508,2.856,1.798,2.662,2.275,1.327,8.889,13.743,2.863,9.326,1.844,12.02,4.316,16.04,0.727,1.25,0.594,0.908,0.66,4.9,2.11,0.727,8.433,20.843,0.642,12.172,9.964,3.677,15.462,3.042,7.498,3.513,45.817,1.419,2.83,1.174,1.647,1.268,3.261,2.32,3.38,3.684,11.985,0.987,54.358,8.116,2.835,2.644,1.98,3.678,2.849,4.567,1.109,1.978,0.921,1.353,1.165,3.057,1.906,1.784,2.68,2.943,1.148,3.883,3.243,2.593,20.68,2.531,19.649,6.164,45.3,3.201,2.274,1.291,1.299,1.16,5.91,1.956,3.994,7.897,24.159,1.077,40.45,12.241,3.695,0.755,0.614,1.22,0.716,0.832,0.674,0.66,0.518,0.649,0.59,0.939,0.698,0.701,0.767,0.685,0.464,0.877,0.972,1.024,0.343,0.366,2.336,1.865,1.032,1.061,1.368,2.098,1.642,0.614,1.873,1.108,1.099,1.343,0.866,1.159,1.105,1.551,0.856,1.834,0.832,6.547],[0.036,0.039,0.038,0.039,0.03,0.04,0.041,0.035,0.041,0.039,0.038,0.039,0.04,0.037,0.039,0.039,0.041,0.039,0.038,0.04,0,0.265,0.205,0.127,0.078,0.129,0.17,0.174,0.043,0.188,0.123,0.113,0.127,0.099,0.092,0.112,0.144,0.087,0.157,0.084,0.655,0.04,0.031,0.049,0.03,0.026,0.023,0.03,0.034,0.031,0.027,0.042,0.046,0.053,0.038,0.047,0.029,0.051,0.034,0.05,0.016,0.017,0.044,0.059,0.092,0.038,0.029,0.024,0.043,0.028,0.041,0.024,0.043,0.056,0.054,0.047,0.049,0.031,0.069,0.075,0.08,0.027,0.024,0.972,0.201,0.935,0.273,1.074,0.12,0.163,0.124,0.155,0.121,0.284,0.231,0.145,0.215,0.184,0.107,0.719,1.111,0.231,0.754,0.149,0.972,0.349,1.297,0.059,0.101,0.048,0.073,0.053,0.396,0.171,0.059,0.682,1.685,0.052,0.984,0.806,0.297,1.25,0.246,0.606,0.284,3.704,0.115,0.229,0.095,0.133,0.102,0.264,0.188,0.273,0.298,0.969,0.08,4.395,0.656,0.229,0.214,0.16,0.297,0.23,0.369,0.09,0.16,0.074,0.109,0.094,0.247,0.154,0.144,0.217,0.238,0.093,0.314,0.262,0.21,1.672,0.205,1.589,0.498,3.662,0.259,0.184,0.104,0.105,0.094,0.478,0.158,0.323,0.638,1.953,0.087,3.27,0.99,0.299,0.061,0.05,0.099,0.058,0.067,0.055,0.053,0.042,0.052,0.048,0.076,0.056,0.057,0.062,0.055,0.038,0.071,0.079,0.083,0.028,0.03,0.189,0.151,0.083,0.086,0.111,0.17,0.133,0.05,0.151,0.09,0.089,0.109,0.07,0.094,0.089,0.125,0.069,0.148,0.067,0.529],[0.036,0.035,0.047,0.051,0.031,0.041,0.041,0.032,0.038,0.039,0.034,0.039,0.042,0.038,0.038,0.042,0.041,0.04,0.038,0.04,0,0.446,0.385,0.239,0.078,0.176,0.171,0.27,0.043,0.223,0.112,0.111,0.144,0.082,0.091,0.172,0.143,0.101,0.297,0.104,0.609,0.055,0.031,0.049,0.031,0.026,0.018,0.03,0.031,0.036,0.024,0.042,0.046,0.059,0.038,0.047,0.032,0.052,0.032,0.044,0.015,0.021,0.06,0.111,0.166,0.041,0.033,0.026,0.052,0.025,0.043,0.02,0.051,0.066,0.075,0.071,0.052,0.024,0.071,0.166,0.112,0.031,0.024,1.887,0.253,3.745,0.44,2.139,0.16,0.3,0.18,0.207,0.15,0.477,0.357,0.156,0.418,0.183,0.108,1.33,3.243,0.311,1.603,0.466,2.466,0.462,2.864,0.083,0.178,0.061,0.117,0.063,0.645,0.305,0.062,1.633,8.619,0.053,1.797,2.218,0.502,4.175,0.361,1.003,0.448,5.78,0.143,0.403,0.104,0.212,0.102,0.376,0.297,0.344,0.453,2.743,0.069,9.134,1.351,0.358,0.437,0.226,0.424,0.31,0.37,0.101,0.195,0.083,0.15,0.103,0.471,0.253,0.167,0.271,0.236,0.079,0.286,0.253,0.261,3.039,0.358,3.17,0.744,2.811,0.278,0.38,0.144,0.127,0.144,0.626,0.302,0.382,1.49,5.355,0.086,2.406,1.785,0.354,0.07,0.062,0.16,0.058,0.068,0.085,0.087,0.063,0.07,0.063,0.088,0.079,0.077,0.059,0.05,0.055,0.08,0.169,0.105,0.046,0.051,0.299,0.245,0.119,0.088,0.125,0.149,0.148,0.047,0.185,0.078,0.095,0.107,0.069,0.083,0.137,0.125,0.069,0.368,0.073,0.543]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Currently nested random effects can not be plotted with <code>plot_effects</code> and <code>plot_coef</code>.</p>
</div>
<div class="section level2">
<h2 id="quadratic-covariate-effects">Quadratic covariate effects<a class="anchor" aria-label="anchor" href="#quadratic-covariate-effects"></a>
</h2>
<p>The easiest way to include quadratic effects is by squaring the covariate and including it as a new covariate. The plot_* and predict methods will be able to identify the quadratic term via a required keyword (the suffix “_squared” by default).</p>
<p>Covariates should be scaled to prior to squaring (“habitat” in this examples is already scaled).</p>
<p>Create quadratic covariate:</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">input_AHM</span><span class="op">$</span><span class="va">siteCovs</span><span class="op">$</span><span class="va">habitat_squared</span> <span class="op">&lt;-</span> <span class="va">input_AHM</span><span class="op">$</span><span class="va">siteCovs</span><span class="op">$</span><span class="va">habitat</span> <span class="op">^</span><span class="fl">2</span></code></pre></div>
<p>Create and fit model:</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_quadratic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>


<span class="va">model1_jags_quadratic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat"</span>, <span class="st">"habitat_squared"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_quadratic</span><span class="op">)</span>

<span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_quadratic</span><span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_quadratic</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<p>Thanks to to keyword “_squared”, <code>plot_effects</code> knows that “habitat” and “habitat_squared” are the same covariate and will combine the effects of “habitat” and “habitat_squared” in response curves.</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">model1_jags_quadratic</span>, 
             <span class="va">out_ahm_jags_quadratic</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $habitat</span></code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-58-1.png" width="700"></p>
<p>The simulated data have no quadratic relationship with covariates, hence the quadratic effects are rather weak in this example.</p>
</div>
<div class="section level2">
<h2 id="waic">WAIC<a class="anchor" aria-label="anchor" href="#waic"></a>
</h2>
<p>Nimble models can return WAIC. Set argument <code>fit(..., WAIC = TRUE)</code>.</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_ahm_nimble3</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_nimble</span>, 
                       n.iter <span class="op">=</span> <span class="fl">500</span>,
                       n.burnin <span class="op">=</span> <span class="fl">250</span>,
                       thin <span class="op">=</span> <span class="fl">5</span>,
                       chains <span class="op">=</span> <span class="fl">3</span>,
                       compile <span class="op">=</span> <span class="cn">TRUE</span>,
                       quiet <span class="op">=</span> <span class="cn">F</span>, 
                       WAIC <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Defining model</span></code></pre>
<pre><code><span class="co">## Warning in checkForDeterministicDorR(code[[i]]): Model includes deterministic</span>
<span class="co">## assignment using '&lt;-' of the result of a density ('d') or simulation ('r')</span>
<span class="co">## calculation. This is likely not what you intended in: new.y[i, j, 1:maxocc] &lt;-</span>
<span class="co">## rOcc_v(n = 1, probOcc = psi[i, j], probDetect = p.eff[i, j, 1:maxocc], len =</span>
<span class="co">## maxocc).</span></code></pre>
<pre><code><span class="co">##   [Note] Using 'y' (given within 'constants') as data.</span></code></pre>
<pre><code><span class="co">## Building model</span></code></pre>
<pre><code><span class="co">## Setting data and initial values</span></code></pre>
<pre><code><span class="co">## Running calculate on model</span>
<span class="co">##   [Note] Any error reports that follow may simply reflect missing values in model variables.</span></code></pre>
<pre><code><span class="co">## Error in if (u &gt; probOcc) return(nimNumeric(0, length = k)) : </span>
<span class="co">##   missing value where TRUE/FALSE needed</span></code></pre>
<pre><code><span class="co">## Checking model sizes and dimensions</span></code></pre>
<pre><code><span class="co">##   [Note] This model is not fully initialized. This is not an error.</span>
<span class="co">##          To see which variables are not initialized, use model$initializeInfo().</span>
<span class="co">##          For more information on model initialization, see help(modelInitialization).</span></code></pre>
<pre><code><span class="co">## ===== Monitors =====</span>
<span class="co">## thin = 5: alpha.obs.ranef.cont.wind, alpha.obs.ranef.cont.wind.mean, alpha.obs.ranef.cont.wind.sigma, alpha0, alpha0.mean, alpha0.sigma, beta.ranef.cont.habitat, beta.ranef.cont.habitat.mean, beta.ranef.cont.habitat.sigma, beta0, beta0.mean, beta0.sigma, Bpvalue, Bpvalue_species, new.R2, new.R3, R2, R3</span>
<span class="co">## ===== Samplers =====</span>
<span class="co">## RW sampler (76)</span>
<span class="co">##   - beta0[]  (19 elements)</span>
<span class="co">##   - alpha0[]  (19 elements)</span>
<span class="co">##   - alpha.obs.ranef.cont.wind[]  (19 elements)</span>
<span class="co">##   - beta.ranef.cont.habitat[]  (19 elements)</span>
<span class="co">## conjugate sampler (8)</span>
<span class="co">##   - beta0.mean</span>
<span class="co">##   - beta0.tau</span>
<span class="co">##   - alpha0.mean</span>
<span class="co">##   - alpha0.tau</span>
<span class="co">##   - alpha.obs.ranef.cont.wind.mean</span>
<span class="co">##   - alpha.obs.ranef.cont.wind.tau</span>
<span class="co">##   - beta.ranef.cont.habitat.mean</span>
<span class="co">##   - beta.ranef.cont.habitat.tau</span></code></pre>
<pre><code><span class="co">## Compiling</span>
<span class="co">##   [Note] This may take a minute.</span>
<span class="co">##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></code></pre>
<pre><code><span class="co">## Compiling</span>
<span class="co">##   [Note] This may take a minute.</span>
<span class="co">##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span></code></pre>
<pre><code><span class="co">## running chain 1...</span></code></pre>
<pre><code><span class="co">## |-------------|-------------|-------------|-------------|</span>
<span class="co">## |-------------------------------------------------------|</span></code></pre>
<pre><code><span class="co">## running chain 2...</span></code></pre>
<pre><code><span class="co">## |-------------|-------------|-------------|-------------|</span>
<span class="co">## |-------------------------------------------------------|</span></code></pre>
<pre><code><span class="co">## running chain 3...</span></code></pre>
<pre><code><span class="co">## |-------------|-------------|-------------|-------------|</span>
<span class="co">## |-------------------------------------------------------|</span>
<span class="co">## There are individual pWAIC values that are greater than 0.4. This may indicate that the WAIC estimate is unstable (Vehtari et al., 2017), at least in cases without grouping of data nodes or multivariate data nodes.</span></code></pre>
<p>The message about “individual pWAIC values that are greater than 0.4” in the example is likely due to the short model run.</p>
<p>If <code>WAIC = TRUE</code>, the output will be a list with 2 elements. The first (“samples”) is the familiar mcmc.list, the second (“WAIC”) is a waicList.</p>
<p>mcmc.list is accessible with $samples:</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># not printed here</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_ahm_nimble3</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span></code></pre></div>
<p>WAIC:</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_ahm_nimble3</span><span class="op">$</span><span class="va">WAIC</span></code></pre></div>
<pre><code><span class="co">## nimbleList object of type waicList</span>
<span class="co">## Field "WAIC":</span>
<span class="co">## [1] 1068.421</span>
<span class="co">## Field "lppd":</span>
<span class="co">## [1] -489.4157</span>
<span class="co">## Field "pWAIC":</span>
<span class="co">## [1] 44.79498</span></code></pre>
</div>
<div class="section level2">
<h2 id="species-richness-estimates-for-categorical-covariates">Species richness estimates for categorical covariates<a class="anchor" aria-label="anchor" href="#species-richness-estimates-for-categorical-covariates"></a>
</h2>
<p>This is only possible in JAGS models. Argument “richnessCategories” can be used to calculate separate species richness estimates for different levels of categorical site covariates. If it is not defined, there will only be a global species richness estimate.</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  richnessCategories <span class="op">=</span> <span class="st">"categ"</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_richness</span><span class="op">)</span>

<span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_rich</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_richness</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<p>Now search for “Nspecies” in the table below. You will see 3 entries. “Nspecies” is overall, Nspecies_by_category[1] and …[2] are for the stations in category “A” and “B”, respectively.</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_rich</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-c48aeec234e5526db84a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c48aeec234e5526db84a">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","Nspecies_categ[1]","Nspecies_categ[2]","Nspecies_categ[3]","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat[1]","beta.ranef.cont.habitat[2]","beta.ranef.cont.habitat[3]","beta.ranef.cont.habitat[4]","beta.ranef.cont.habitat[5]","beta.ranef.cont.habitat[6]","beta.ranef.cont.habitat[7]","beta.ranef.cont.habitat[8]","beta.ranef.cont.habitat[9]","beta.ranef.cont.habitat[10]","beta.ranef.cont.habitat[11]","beta.ranef.cont.habitat[12]","beta.ranef.cont.habitat[13]","beta.ranef.cont.habitat[14]","beta.ranef.cont.habitat[15]","beta.ranef.cont.habitat[16]","beta.ranef.cont.habitat[17]","beta.ranef.cont.habitat[18]","beta.ranef.cont.habitat[19]","beta.ranef.cont.habitat.mean","beta.ranef.cont.habitat.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.516,0.314,0.49,0.614,0.163,0.464,0.451,0.725,0.49,0.582,0.248,0.281,0.359,0.699,0.464,0.719,0.451,0.601,0.601,0.523,19,14.542,18.105,14.654,3.506,2.337,1.157,2.376,4.197,3.981,3.342,0.686,3.296,1.079,1.937,2.428,1.255,2.273,1.899,2.005,1.218,1.851,1.175,42,1.091,-0.045,-0.183,-0.223,0.271,-0.8,-0.618,-0.929,-0.408,0.154,0.819,0.317,-1.314,-0.944,-0.569,-0.038,-0.677,-0.524,-0.445,-0.276,0.794,-1.561,-1.204,-0.818,-1.763,-1.692,-0.507,-1.284,0.739,-1.172,0.214,-1.786,-2.063,-0.696,-1.796,-1.001,-0.454,-1.457,-1.749,-1.788,-1.158,0.961,-0.464,0.093,0.699,1.814,-0.578,1.059,0.4,-0.544,0.273,-0.794,2.108,1.037,-0.011,1.576,0.728,0.491,0.975,0.604,1.272,0.563,1.073,-0.76,-1.389,-2.121,-0.843,-0.767,0.402,-1.06,-1.281,-1.03,-1.219,-1.19,-1.083,-1.828,-1.235,-1.686,-1.06,-2.041,-1.661,-1.993,-1.257,0.816,4.209,2.222,0.589,3.391,4.297,4.122,2.363,0.794,2.952,1.563,2.58,2.701,0.732,2.293,1.359,2.048,0.779,1.498,0.938,41.431],[0.501,0.466,0.502,0.488,0.371,0.5,0.499,0.448,0.502,0.495,0.433,0.451,0.481,0.46,0.5,0.451,0.499,0.491,0.491,0.501,0,1.17,0.745,1.411,2.045,1.802,1.524,1.462,2.216,2.055,1.839,0.596,2.075,1.476,1.514,1.484,1.519,1.296,1.749,1.757,1.128,1.42,1.037,8.489,0.512,0.415,0.635,0.432,0.363,0.254,0.398,0.432,0.381,0.324,0.559,0.457,0.678,0.502,0.575,0.372,0.618,0.485,0.652,0.201,0.221,0.453,0.549,0.838,0.461,0.485,0.272,0.498,0.373,0.492,0.281,0.495,0.594,0.629,0.616,0.573,0.391,0.841,0.688,0.962,0.302,0.234,0.577,0.603,0.777,0.802,0.683,0.512,0.597,0.47,0.591,0.545,1.067,0.715,0.568,0.928,0.684,0.482,0.854,0.701,0.925,0.331,0.368,0.47,0.55,0.691,0.55,0.645,0.521,0.56,0.408,0.511,0.429,0.628,0.61,0.561,0.572,0.645,0.382,0.736,0.686,0.716,0.261,0.268,1.712,1.447,0.831,1.244,1.806,2.158,1.506,0.779,1.831,1.256,1.492,1.313,0.915,1.299,1.231,1.538,0.838,1.165,0.751,6.644],[0.041,0.038,0.041,0.039,0.03,0.04,0.04,0.036,0.041,0.04,0.035,0.036,0.039,0.037,0.04,0.036,0.04,0.04,0.04,0.041,0,0.095,0.06,0.114,0.165,0.146,0.123,0.118,0.179,0.166,0.149,0.048,0.168,0.119,0.122,0.12,0.123,0.105,0.141,0.142,0.091,0.115,0.084,0.686,0.041,0.034,0.051,0.035,0.029,0.021,0.032,0.035,0.031,0.026,0.045,0.037,0.055,0.041,0.046,0.03,0.05,0.039,0.053,0.016,0.018,0.037,0.044,0.068,0.037,0.039,0.022,0.04,0.03,0.04,0.023,0.04,0.048,0.051,0.05,0.046,0.032,0.068,0.056,0.078,0.024,0.019,0.047,0.049,0.063,0.065,0.055,0.041,0.048,0.038,0.048,0.044,0.086,0.058,0.046,0.075,0.055,0.039,0.069,0.057,0.075,0.027,0.03,0.038,0.044,0.056,0.044,0.052,0.042,0.045,0.033,0.041,0.035,0.051,0.049,0.045,0.046,0.052,0.031,0.06,0.055,0.058,0.021,0.022,0.138,0.117,0.067,0.101,0.146,0.174,0.122,0.063,0.148,0.102,0.121,0.106,0.074,0.105,0.1,0.124,0.068,0.094,0.061,0.537],[0.048,0.038,0.041,0.037,0.03,0.04,0.046,0.036,0.044,0.038,0.035,0.037,0.038,0.036,0.036,0.034,0.04,0.04,0.039,0.041,0,0.133,0.06,0.15,0.175,0.142,0.178,0.108,0.203,0.183,0.166,0.048,0.161,0.12,0.139,0.12,0.122,0.102,0.142,0.133,0.101,0.109,0.078,0.758,0.041,0.034,0.051,0.035,0.03,0.02,0.028,0.035,0.031,0.026,0.056,0.029,0.059,0.041,0.046,0.03,0.054,0.043,0.057,0.016,0.018,0.035,0.041,0.097,0.04,0.039,0.022,0.046,0.03,0.047,0.023,0.044,0.065,0.044,0.05,0.055,0.033,0.074,0.055,0.083,0.024,0.023,0.055,0.062,0.081,0.076,0.054,0.041,0.051,0.04,0.046,0.044,0.165,0.063,0.046,0.108,0.066,0.039,0.072,0.054,0.089,0.036,0.046,0.036,0.05,0.075,0.038,0.067,0.061,0.056,0.033,0.039,0.038,0.046,0.049,0.056,0.046,0.051,0.036,0.072,0.064,0.066,0.03,0.038,0.138,0.107,0.109,0.093,0.196,0.162,0.121,0.063,0.148,0.115,0.112,0.106,0.046,0.103,0.089,0.125,0.077,0.081,0.057,0.61]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level2">
<h2 id="spatial-predictions">Spatial predictions<a class="anchor" aria-label="anchor" href="#spatial-predictions"></a>
</h2>
<p>You can create spatial predictions based on the occupancy models created with <code>communityModel</code>, their model fits and covariate raster stacks.</p>
<p>This requires the raster package.</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></code></pre></div>
<p>In this example we will use a model that has both a continuous and a categorical covariate.</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_categ3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model_jags_categ3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat"</span>, 
                            <span class="st">"categ"</span><span class="op">)</span><span class="op">)</span>,
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_categ3</span><span class="op">)</span>

<span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_categ3</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model_jags_categ3</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<p>create a habitat raster (we’ll use the volcano raster for demonstration).</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"volcano"</span><span class="op">)</span>
<span class="va">r_volcano</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>create a categorical raster. Since it is not possible to have categorical raster (with data type “factor”), the raster must consist of integer numbers that refer to the factor levels (as defined in the model input).</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">input_AHM</span><span class="op">$</span><span class="va">siteCovs</span><span class="op">$</span><span class="va">categ</span><span class="op">)</span>    <span class="co"># show the order of factor levels, first one is reference</span></code></pre></div>
<pre><code><span class="co">## [1] "medium" "low"    "high"</span></code></pre>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raster_categ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimMatrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">length</a></span><span class="op">(</span><span class="va">r_volcano</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span>, 
                                  ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">r_volcano</span><span class="op">)</span>,
                                  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">r_volcano</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add raster to list</span>
  <span class="va">stack_prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>habitat <span class="op">=</span> <span class="va">r_volcano</span>,
                                 categ <span class="op">=</span> <span class="va">raster_categ</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stack_prediction</span><span class="op">)</span></code></pre></div>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-68-1.png" width="700"></p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># raster categ, from west to east: 1 = medium, 2 = low, 3 = high</span></code></pre></div>
<p>Species occupancy maps:</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># species occupancy estimates</span>
  <span class="va">predictions_psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html" class="external-link">predict</a></span><span class="op">(</span>object    <span class="op">=</span> <span class="va">model_jags_categ3</span>, 
                             mcmc.list <span class="op">=</span> <span class="va">out_ahm_jags_categ3</span>,
                             x         <span class="op">=</span> <span class="va">stack_prediction</span>,
                             type      <span class="op">=</span> <span class="st">"psi"</span>,
                             draws     <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">predictions_psi</span><span class="op">$</span><span class="va">mean</span>, zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-69-1.png" width="700"></p>
<p>Species richness maps:</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># species richness estimates</span>
  <span class="va">predictions_rich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html" class="external-link">predict</a></span><span class="op">(</span>object   <span class="op">=</span> <span class="va">model_jags_categ3</span>, 
                             mcmc.list <span class="op">=</span> <span class="va">out_ahm_jags_categ3</span>,
                             x         <span class="op">=</span> <span class="va">stack_prediction</span>,
                             type      <span class="op">=</span> <span class="st">"richness"</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">predictions_rich</span><span class="op">)</span></code></pre></div>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-70-1.png" width="700"></p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># mean = mean species richness estimate</span>
  <span class="co"># sd = standard deviation of richness estimate</span></code></pre></div>
<p>In these examples we did not return confidence intervals. Doing so would be easy by setting intervals = “confidence”.</p>
<p>Computation can take long on larger rasters and can require lots of RAM. Check RAM usage during computations.</p>
</div>
<div class="section level2">
<h2 id="bayesplot">bayesplot<a class="anchor" aria-label="anchor" href="#bayesplot"></a>
</h2>
<p>We can also use the powerful bayesplot package for visualizing model estimates. One downside is that it won’t automatically insert the species names.</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></code></pre></div>
<p>Here is an example for density plots showing the species-level effects of habitat on occupancy:</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html" class="external-link">mcmc_areas</a></span><span class="op">(</span><span class="va">out_ahm_nimble2</span>, regex_pars <span class="op">=</span> <span class="st">"beta.ranef.cont.habitat"</span><span class="op">)</span></code></pre></div>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-72-1.png" width="700"></p>
<p>bayesplot has many other visualization options beyond this example. See the respective documentation, e.g. <a href="https://mc-stan.org/bayesplot/" class="external-link uri">https://mc-stan.org/bayesplot/</a>.</p>
</div>
<div class="section level2">
<h2 id="model-diagnostics">Model diagnostics<a class="anchor" aria-label="anchor" href="#model-diagnostics"></a>
</h2>
<p>Output of <code>fit()</code> is a coda::mcmc.list, so <code><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot()</a></code> provides traceplots (not shown here for space reasons):</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out_ahm_nimble2</span><span class="op">)</span></code></pre></div>
<p>The Gelman-Rubin convergence statistic (potential scale reduction factor) can be calculated with <code>gelman.diag()</code> from <code>coda</code>:</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gd</span> <span class="op">&lt;-</span> <span class="fu">gelman.diag</span><span class="op">(</span><span class="va">out_ahm_nimble2</span>,  multivariate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">gd</span></code></pre></div>
<pre><code><span class="co">## Potential scale reduction factors:</span>
<span class="co">## </span>
<span class="co">##                                 Point est. Upper C.I.</span>
<span class="co">## Bpvalue                              1.003      1.015</span>
<span class="co">## Bpvalue_species[1]                   1.000      1.006</span>
<span class="co">## Bpvalue_species[2]                   1.009      1.036</span>
<span class="co">## Bpvalue_species[3]                   1.009      1.029</span>
<span class="co">## Bpvalue_species[4]                   0.998      0.998</span>
<span class="co">## Bpvalue_species[5]                   0.998      0.999</span>
<span class="co">## Bpvalue_species[6]                   1.002      1.008</span>
<span class="co">## Bpvalue_species[7]                   1.002      1.012</span>
<span class="co">## Bpvalue_species[8]                   1.002      1.014</span>
<span class="co">## Bpvalue_species[9]                   1.003      1.016</span>
<span class="co">## Bpvalue_species[10]                  0.998      0.998</span>
<span class="co">## Bpvalue_species[11]                  1.001      1.009</span>
<span class="co">## Bpvalue_species[12]                  1.001      1.007</span>
<span class="co">## Bpvalue_species[13]                  1.002      1.013</span>
<span class="co">## Bpvalue_species[14]                  0.999      1.000</span>
<span class="co">## Bpvalue_species[15]                  0.999      1.000</span>
<span class="co">## Bpvalue_species[16]                  1.009      1.037</span>
<span class="co">## Bpvalue_species[17]                  1.006      1.020</span>
<span class="co">## Bpvalue_species[18]                  1.002      1.013</span>
<span class="co">## Bpvalue_species[19]                  1.003      1.014</span>
<span class="co">## R2[1]                                1.006      1.008</span>
<span class="co">## R2[2]                                1.003      1.014</span>
<span class="co">## R2[3]                                1.004      1.016</span>
<span class="co">## R2[4]                                1.005      1.023</span>
<span class="co">## R2[5]                                1.000      1.001</span>
<span class="co">## R2[6]                                1.004      1.013</span>
<span class="co">## R2[7]                                1.001      1.003</span>
<span class="co">## R2[8]                                1.001      1.009</span>
<span class="co">## R2[9]                                1.007      1.030</span>
<span class="co">## R2[10]                               1.017      1.056</span>
<span class="co">## R2[11]                               1.010      1.025</span>
<span class="co">## R2[12]                               1.005      1.015</span>
<span class="co">## R2[13]                               1.012      1.042</span>
<span class="co">## R2[14]                               1.005      1.009</span>
<span class="co">## R2[15]                               1.002      1.011</span>
<span class="co">## R2[16]                               1.001      1.010</span>
<span class="co">## R2[17]                               0.998      0.999</span>
<span class="co">## R2[18]                               1.013      1.039</span>
<span class="co">## R2[19]                               1.004      1.012</span>
<span class="co">## R3                                   1.004      1.009</span>
<span class="co">## alpha.obs.ranef.cont.wind[1]         1.004      1.017</span>
<span class="co">## alpha.obs.ranef.cont.wind[2]         0.999      1.003</span>
<span class="co">## alpha.obs.ranef.cont.wind[3]         1.015      1.028</span>
<span class="co">## alpha.obs.ranef.cont.wind[4]         1.001      1.009</span>
<span class="co">## alpha.obs.ranef.cont.wind[5]         1.001      1.004</span>
<span class="co">## alpha.obs.ranef.cont.wind[6]         0.999      1.000</span>
<span class="co">## alpha.obs.ranef.cont.wind[7]         1.012      1.048</span>
<span class="co">## alpha.obs.ranef.cont.wind[8]         1.007      1.025</span>
<span class="co">## alpha.obs.ranef.cont.wind[9]         1.001      1.002</span>
<span class="co">## alpha.obs.ranef.cont.wind[10]        1.004      1.009</span>
<span class="co">## alpha.obs.ranef.cont.wind[11]        1.001      1.004</span>
<span class="co">## alpha.obs.ranef.cont.wind[12]        1.000      1.001</span>
<span class="co">## alpha.obs.ranef.cont.wind[13]        1.002      1.010</span>
<span class="co">## alpha.obs.ranef.cont.wind[14]        1.000      1.003</span>
<span class="co">## alpha.obs.ranef.cont.wind[15]        1.003      1.006</span>
<span class="co">## alpha.obs.ranef.cont.wind[16]        0.999      1.001</span>
<span class="co">## alpha.obs.ranef.cont.wind[17]        1.004      1.009</span>
<span class="co">## alpha.obs.ranef.cont.wind[18]        1.001      1.007</span>
<span class="co">## alpha.obs.ranef.cont.wind[19]        1.005      1.024</span>
<span class="co">## alpha.obs.ranef.cont.wind.mean       0.999      1.001</span>
<span class="co">## alpha.obs.ranef.cont.wind.sigma      1.002      1.006</span>
<span class="co">## alpha0[1]                            1.002      1.009</span>
<span class="co">## alpha0[2]                            1.003      1.014</span>
<span class="co">## alpha0[3]                            1.003      1.011</span>
<span class="co">## alpha0[4]                            1.005      1.022</span>
<span class="co">## alpha0[5]                            0.999      1.000</span>
<span class="co">## alpha0[6]                            1.003      1.010</span>
<span class="co">## alpha0[7]                            1.001      1.004</span>
<span class="co">## alpha0[8]                            1.000      1.005</span>
<span class="co">## alpha0[9]                            1.006      1.026</span>
<span class="co">## alpha0[10]                           1.017      1.056</span>
<span class="co">## alpha0[11]                           1.002      1.008</span>
<span class="co">## alpha0[12]                           1.004      1.012</span>
<span class="co">## alpha0[13]                           1.010      1.037</span>
<span class="co">## alpha0[14]                           1.005      1.007</span>
<span class="co">## alpha0[15]                           1.004      1.016</span>
<span class="co">## alpha0[16]                           1.001      1.009</span>
<span class="co">## alpha0[17]                           0.999      1.002</span>
<span class="co">## alpha0[18]                           1.008      1.029</span>
<span class="co">## alpha0[19]                           1.005      1.009</span>
<span class="co">## alpha0.mean                          1.004      1.020</span>
<span class="co">## alpha0.sigma                         1.000      1.000</span>
<span class="co">## beta.ranef.cont.habitat[1]           1.010      1.024</span>
<span class="co">## beta.ranef.cont.habitat[2]           1.000      1.006</span>
<span class="co">## beta.ranef.cont.habitat[3]           0.999      1.000</span>
<span class="co">## beta.ranef.cont.habitat[4]           1.002      1.007</span>
<span class="co">## beta.ranef.cont.habitat[5]           1.008      1.012</span>
<span class="co">## beta.ranef.cont.habitat[6]           1.006      1.009</span>
<span class="co">## beta.ranef.cont.habitat[7]           1.003      1.014</span>
<span class="co">## beta.ranef.cont.habitat[8]           1.004      1.017</span>
<span class="co">## beta.ranef.cont.habitat[9]           1.000      1.000</span>
<span class="co">## beta.ranef.cont.habitat[10]          1.006      1.009</span>
<span class="co">## beta.ranef.cont.habitat[11]          1.042      1.104</span>
<span class="co">## beta.ranef.cont.habitat[12]          1.008      1.031</span>
<span class="co">## beta.ranef.cont.habitat[13]          1.003      1.010</span>
<span class="co">## beta.ranef.cont.habitat[14]          1.002      1.007</span>
<span class="co">## beta.ranef.cont.habitat[15]          1.009      1.025</span>
<span class="co">## beta.ranef.cont.habitat[16]          1.003      1.009</span>
<span class="co">## beta.ranef.cont.habitat[17]          1.006      1.017</span>
<span class="co">## beta.ranef.cont.habitat[18]          1.007      1.023</span>
<span class="co">## beta.ranef.cont.habitat[19]          1.005      1.017</span>
<span class="co">## beta.ranef.cont.habitat.mean         1.007      1.021</span>
<span class="co">## beta.ranef.cont.habitat.sigma        1.004      1.015</span>
<span class="co">## beta0[1]                             1.001      1.005</span>
<span class="co">## beta0[2]                             1.002      1.008</span>
<span class="co">## beta0[3]                             1.010      1.027</span>
<span class="co">## beta0[4]                             1.010      1.025</span>
<span class="co">## beta0[5]                             1.001      1.003</span>
<span class="co">## beta0[6]                             1.003      1.011</span>
<span class="co">## beta0[7]                             0.999      0.999</span>
<span class="co">## beta0[8]                             1.001      1.008</span>
<span class="co">## beta0[9]                             1.019      1.035</span>
<span class="co">## beta0[10]                            1.002      1.009</span>
<span class="co">## beta0[11]                            1.010      1.025</span>
<span class="co">## beta0[12]                            1.001      1.002</span>
<span class="co">## beta0[13]                            1.009      1.020</span>
<span class="co">## beta0[14]                            1.005      1.005</span>
<span class="co">## beta0[15]                            1.011      1.019</span>
<span class="co">## beta0[16]                            1.016      1.052</span>
<span class="co">## beta0[17]                            1.032      1.059</span>
<span class="co">## beta0[18]                            1.005      1.020</span>
<span class="co">## beta0[19]                            1.000      1.000</span>
<span class="co">## beta0.mean                           1.002      1.004</span>
<span class="co">## beta0.sigma                          1.005      1.024</span>
<span class="co">## new.R2[1]                            1.006      1.013</span>
<span class="co">## new.R2[2]                            1.004      1.019</span>
<span class="co">## new.R2[3]                            1.004      1.012</span>
<span class="co">## new.R2[4]                            1.004      1.017</span>
<span class="co">## new.R2[5]                            1.000      1.000</span>
<span class="co">## new.R2[6]                            0.999      1.000</span>
<span class="co">## new.R2[7]                            1.001      1.004</span>
<span class="co">## new.R2[8]                            1.002      1.013</span>
<span class="co">## new.R2[9]                            1.008      1.034</span>
<span class="co">## new.R2[10]                           1.006      1.028</span>
<span class="co">## new.R2[11]                           1.006      1.016</span>
<span class="co">## new.R2[12]                           1.003      1.010</span>
<span class="co">## new.R2[13]                           1.009      1.035</span>
<span class="co">## new.R2[14]                           1.008      1.011</span>
<span class="co">## new.R2[15]                           1.003      1.013</span>
<span class="co">## new.R2[16]                           1.006      1.026</span>
<span class="co">## new.R2[17]                           0.998      0.999</span>
<span class="co">## new.R2[18]                           1.009      1.029</span>
<span class="co">## new.R2[19]                           1.003      1.010</span>
<span class="co">## new.R3                               1.003      1.006</span></code></pre>
<p>One can also use <code>gelman.plot</code> to create Gelman-Rubin-Brooks plots (evolution of Gelman-Rubin statistic over iterations):</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># not shown here due to space reasons</span>
<span class="fu">gelman.plot</span><span class="op">(</span><span class="va">out_ahm_nimble2</span>,  multivariate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="single-species-occupancy-models">Single-species occupancy models<a class="anchor" aria-label="anchor" href="#single-species-occupancy-models"></a>
</h2>
<p>Incidentally, the workflow above can be used for single-species models too. The code will be less streamlined and possibly slower than normal code for single-species models (due to the species loop which is unnecessary for single-species models), but it is possible. Simply pass a single detection history in the data_list$ylist of the input to <code>communityModel</code>.</p>
<p>Take care to only define fixed effects for covariates and the intercepts, not random effects of species. It is possible however to specify random effects of categorical site covariates on continuous site covariates as in the example below.</p>
<p>In this example we use species 1 from the community created with simComm.</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">input_AHM_sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ylist <span class="op">=</span> <span class="va">ylist</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,    <span class="co"># ylist[1] is still a list, with 1 element</span>
                      siteCovs <span class="op">=</span> <span class="va">input_AHM</span><span class="op">$</span><span class="va">siteCovs</span>,
                      obsCovs <span class="op">=</span> <span class="va">input_AHM</span><span class="op">$</span><span class="va">obsCovs</span><span class="op">)</span></code></pre></div>
<p>Create model:</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model_sp1_jags_ranef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat|categ"</span><span class="op">)</span><span class="op">)</span>,    <span class="co"># response to habitat differs between categ via random effect</span>
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"fixed"</span>, occu <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM_sp1</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_sp1</span><span class="op">)</span></code></pre></div>
<p>Fit model</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_jags_sp1</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model_sp1_jags_ranef</span>, n.iter <span class="op">=</span> <span class="fl">1000</span>, n.burnin <span class="op">=</span> <span class="fl">500</span>, thin <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>Print summary statistics</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_jags_sp1</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-f5248d8386987be8912a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f5248d8386987be8912a">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species","Nspecies","R2","R3","alpha.obs.fixed.cont.wind","alpha0","beta.ranef.cont.habitat_categ[1]","beta.ranef.cont.habitat_categ[2]","beta.ranef.cont.habitat_categ[3]","beta.ranef.cont.habitat_categ.mean","beta.ranef.cont.habitat_categ.sigma","beta0","new.R2","new.R3"],[0.766,0.766,1,6.963,6.963,1.653,-2.423,-4.62,-3.583,-0.389,-1.877,4.245,0.635,5.674,5.674],[0.424,0.424,0,3.351,3.351,0.718,0.644,5.337,5.004,3.576,2.694,6.079,2.484,2.36,2.36],[0.024,0.024,0,0.192,0.192,0.041,0.037,0.307,0.287,0.205,0.155,0.349,0.143,0.136,0.136],[0.057,0.057,0,0.548,0.548,0.081,0.068,0.827,0.768,0.444,0.262,0.598,0.427,0.339,0.339]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>The <code><a href="../reference/plot_effects-commOccu-method.html">plot_effects()</a></code> and <code><a href="../reference/plot_coef-commOccu-method.html">plot_coef()</a></code> functions currently don’t work for this case, since single-species models are mostly a side-effect of the intended community occupancy workflow and not the main goal. There are other great options for Bayesian single-species occupancy models, e.g. in the packages ubms or wiqid, or unmarked for a frequentist implementation.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Juergen Niedballa, Alexandre Courtiol, Rahel Sollmann.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
