<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5. Multi-species occupancy models • camtrapR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="5. Multi-species occupancy models">
<meta property="og:description" content="camtrapR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">camtrapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/camtrapr1.html">1. Organising raw camera trap images in camtrapR</a>
    </li>
    <li>
      <a href="../articles/camtrapr2.html">2. Species and Individual Identification</a>
    </li>
    <li>
      <a href="../articles/camtrapr3.html">3. Data Extraction from Images and videos, creating occupancy &amp; secr input</a>
    </li>
    <li>
      <a href="../articles/camtrapr4.html">4. Data exploration and visualisation</a>
    </li>
    <li>
      <a href="../articles/camtrapr5.html">5. Multi-species occupancy models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jniedballa/camtrapR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="camtrapr5_files/header-attrs-2.11/header-attrs.js"></script><script src="camtrapr5_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="camtrapr5_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="camtrapr5_files/datatables-binding-0.19/datatables.js"></script><script src="camtrapr5_files/jquery-3.6.0/jquery-3.6.0.min.js"></script><link href="camtrapr5_files/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="camtrapr5_files/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="camtrapr5_files/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="camtrapr5_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="camtrapr5_files/crosstalk-1.1.1/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>5. Multi-species occupancy models</h1>
                        <h4 class="author">Juergen Niedballa (<a href="mailto:camtrapr@gmail.com" class="email">camtrapr@gmail.com</a>)</h4>
            
            <h4 class="date">2021-12-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jniedballa/camtrapR/blob/master/vignettes/camtrapr5.Rmd"><code>vignettes/camtrapr5.Rmd</code></a></small>
      <div class="hidden name"><code>camtrapr5.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jniedballa/camtrapR">camtrapR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT">DT</a></span><span class="op">)</span></code></pre></div>
<div id="motivation" class="section level1">
<h1 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h1>
<p>Multi-species occupancy models are a powerful group of models that combine information from many species to estimate individual species’ responses as well as community-level responses to environmental variables.</p>
<p>They are normally fit in Bayesian frameworks, e.g. BUGS, JAGS or Nimble. Creating the necessary input for these models from camera trapping data, writing the model code, setting parameters to monitor, initial values etc. can however be daunting, and even for seasoned users can be a tedious and time-consuming task.</p>
<p>A new extension of camtrapR aims to simplify this process by automatically and flexibly creating custom community occupancy models that are ready for analysis in JAGS or Nimble. The workflow supports:</p>
<ul>
<li>continuous and categorical site covariates on detection and occupancy probability</li>
<li>fixed and random effects of these covariates</li>
<li>continuous and categorical observation-level covariates on detection probability</li>
<li>fixed or random intercepts of detection and occupancy probability</li>
<li>nested random effects</li>
<li>random effects of categorical site covariates</li>
<li>data augmentation (fully open community or known maximum species richness)</li>
<li>species richness estimates</li>
<li>models in JAGS and Nimble</li>
<li>Bayesian p-values (overall and by species)</li>
</ul>
<p>The main function is communityModel(). It automates:</p>
<ul>
<li>writing model code</li>
<li>setting parameters to monitor</li>
<li>setting initial values</li>
<li>bundling input data</li>
</ul>
<p>The workflow provides methods for:</p>
<ul>
<li>fitting models</li>
<li>plotting marginal effect plots (response curves)</li>
<li>plotting effect sizes</li>
<li>spatial predictions of species occupancy probabilities</li>
<li>spatial predictions of species richness</li>
</ul>
<p>The output of fit() is an mcmc.list from the coda package and can be uses as such, so the summary(), plot(), etc. methods are available.</p>
<p>The main function <code>communityModel</code> does not support R formula syntax the way packages like unmarked or ubms would. Instead, covariates and their effect types are specified via a few dedicated function arguments. This non-standard approach may change in the future to instead support formula syntax. On the other hand it might be less confusing than the lme4 syntax for random effects.</p>
</div>
<div id="warning" class="section level1">
<h1 class="hasAnchor">
<a href="#warning" class="anchor"></a>Warning</h1>
<p>A word of caution, please always check the model code and make sure you understand the code and agree with it. The workflow is meant to be convenient and does not require you to even look at the model code, but you should (there are many comments in the model code make it easier). This workflow still requires a proper understanding of Bayesian modelling frameworks and the concepts behind multi-species occupancy models.</p>
</div>
<div id="limitations" class="section level1">
<h1 class="hasAnchor">
<a href="#limitations" class="anchor"></a>Limitations</h1>
<p>The workflow is still rather experimental, so please remain critical of the results and check carefully. If you encounter any problems, please let me know.</p>
<p>There are currently a few limitations in the workflow:</p>
<ul>
<li>priors can not be customized yet.</li>
<li>models with categorical observation-level covariates cannot be compiled in Nimble and must be fit in JAGS</li>
<li>nested random effects and random effects of site covariates are still experimental, and the plot_* methods don’t work on these yet</li>
<li>likewise, the output of <code>predict</code> may not be correct for these</li>
<li>predict currently only works for RasterStacks, not data.frames</li>
<li>input checks are a bit limited and may not always lead to meaningful error messages. This will improve over time with user feedback.</li>
</ul>
</div>
<div id="quick-example" class="section level1">
<h1 class="hasAnchor">
<a href="#quick-example" class="anchor"></a>Quick example</h1>
<p>Here is a quick example using the sample data that are included in camtrapR. The data set only contains 5 species and 3 stations, and use made-up covariates, so the parameter estimates will be nonsense. It is only a technical demonstration for how community models fit into the camtrapR workflow.</p>
<div id="prepare-data" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-data" class="anchor"></a>Prepare data</h2>
<p>First we load the camera trap table and create a camera operation matrix:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"camtraps"</span><span class="op">)</span>

 <span class="co"># create camera operation matrix</span>
 <span class="va">camop_no_problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cameraOperation.html">cameraOperation</a></span><span class="op">(</span>CTtable      <span class="op">=</span> <span class="va">camtraps</span>,
                                     stationCol   <span class="op">=</span> <span class="st">"Station"</span>,
                                     setupCol     <span class="op">=</span> <span class="st">"Setup_date"</span>,
                                     retrievalCol <span class="op">=</span> <span class="st">"Retrieval_date"</span>,
                                     hasProblems  <span class="op">=</span> <span class="cn">FALSE</span>,
                                     dateFormat   <span class="op">=</span> <span class="st">"dmy"</span>
 <span class="op">)</span></code></pre></div>
<p>Now we load the record table and create a list of detection histories. This is for all species, you may want to subset the record table first. Note that includeEffort = TRUE, hence the output for each species will be a list (detection history and effort matrix).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"recordTableSample"</span><span class="op">)</span>

 <span class="co"># list of detection histories</span>
 <span class="va">DetHist_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">recordTableSample</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
   <span class="fu"><a href="../reference/detectionHistory.html">detectionHistory</a></span><span class="op">(</span>
     recordTable         <span class="op">=</span> <span class="va">recordTableSample</span>,
     camOp                <span class="op">=</span> <span class="va">camop_no_problem</span>,
     stationCol           <span class="op">=</span> <span class="st">"Station"</span>,
     speciesCol           <span class="op">=</span> <span class="st">"Species"</span>,
     recordDateTimeCol    <span class="op">=</span> <span class="st">"DateTimeOriginal"</span>,
     species              <span class="op">=</span> <span class="va">x</span>,     <span class="co"># this gets modifies by lapply</span>
     occasionLength       <span class="op">=</span> <span class="fl">7</span>,
     day1                 <span class="op">=</span> <span class="st">"station"</span>,
     datesAsOccasionNames <span class="op">=</span> <span class="cn">FALSE</span>,
     includeEffort        <span class="op">=</span> <span class="cn">TRUE</span>,
     scaleEffort          <span class="op">=</span> <span class="cn">TRUE</span>,
     timeZone             <span class="op">=</span> <span class="st">"Asia/Kuala_Lumpur"</span>
   <span class="op">)</span><span class="op">}</span>
 <span class="op">)</span>

 <span class="co"># assign species names to list of detection histories</span>
 <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">DetHist_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">recordTableSample</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></code></pre></div>
<p>Get the detection history of each species and put into a list (get rid of effort matrix).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">ylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">DetHist_list</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">detection_history</span><span class="op">)</span></code></pre></div>
<p>Create some fake covariates (only for demonstration):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">sitecovs</span> <span class="op">&lt;-</span> <span class="va">camtraps</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>
 <span class="va">sitecovs</span><span class="op">$</span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">500</span>, <span class="fl">600</span><span class="op">)</span>
 <span class="va">sitecovs</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/scale.html">scale</a></span><span class="op">(</span><span class="va">sitecovs</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>   <span class="co"># scale numeric covariates</span>
 <span class="va">sitecovs</span><span class="op">$</span><span class="va">fact</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span>    <span class="co"># categorical covariate</span></code></pre></div>
<p>Now we bundle the necessary data for communityModel:</p>
<ul>
<li>ylist: the list of detection histories</li>
<li>siteCovs: data frame with site covariates</li>
<li>obsCovs: (named) list with observation level covariates. Requires at least the effort matrix.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ylist    <span class="op">=</span> <span class="va">ylist</span>,
                   siteCovs <span class="op">=</span> <span class="va">sitecovs</span>,
                   obsCovs  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>effort <span class="op">=</span> <span class="va">DetHist_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">effort</span><span class="op">)</span><span class="op">)</span>  <span class="co"># is identical for all species</span></code></pre></div>
<p>Now data_list is a list containing the detection histories, site covariates and occasion level covariates.</p>
<p>N.B.: It is always necessary to provide an effort matrix. It is needed to ensure that detection probability is 0 when there was no effort. This is achieved by creating a binary effort matrix based on the user-provided effort matrix. The binary effort matrix is 0 for all cells where effort = NA, and 1 for all cells with values (no matter what values). Thus, all occasions with effort = NA in the effort matrix will have detection probability = 0.</p>
<p>Also note that this does <strong>not</strong> include effort as a covariate on detection probability. To include effort as a covariate on detection probability, set argument <code>detCovsObservation</code> (you can specify a fixed or random effect).</p>
</div>
<div id="fit-model-in-jags" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-model-in-jags" class="anchor"></a>Fit model in JAGS</h2>
<p>Now the interesting part. The function communityModel() creates a new class, “commOccu”. It is an object that contains all relevant information for running a community occupancy model. Here we will create a JAGS model (the default).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># text file to save the model</span>
 <span class="va">modelfile1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

 <span class="va">mod.jags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span><span class="va">data_list</span>,
                            occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"utm_y"</span>, ranef <span class="op">=</span> <span class="st">"elevation"</span><span class="op">)</span>,
                            detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"effort"</span><span class="op">)</span>,
                            intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
                            modelFile <span class="op">=</span> <span class="va">modelfile1</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c41c7214.txt</code></pre>
<p>This defined a model with a fixed effect of utm_y on occupancy probability of all species, and a species-specific (random) effect of elevation on occupancy probability. Furthermore, effort is a covariate on detection probability (constant across species), and there are random effects of species on the intercepts of detection and occupancy probabilities.</p>
<p>There is a very basic summary method for commOccu objects:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod.jags</span><span class="op">)</span></code></pre></div>
<pre><code>## commOccu object (for JAGS)
## 
## 5 species,  3 stations,  7 occasions
## 21 occasions with effort
## Number of detections (by species): 2 - 11 
## 
## Available site covariates:
##  Station, utm_y, utm_x, elevation, fact 
## 
## Used site covariates:
##  utm_y, elevation 
## 
## Available site-occasion covariates:
##  effort</code></pre>
<p>The model is fit with fit().</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">fit.jags</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">mod.jags</span>,
                 n.iter <span class="op">=</span> <span class="fl">1000</span>,
                 n.burnin <span class="op">=</span> <span class="fl">500</span>,
                 chains <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 105
##    Unobserved stochastic nodes: 143
##    Total graph size: 764
## 
## Initializing model
## 
## NOTE: Stopping adaptation
## 
## 
## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 105
##    Unobserved stochastic nodes: 143
##    Total graph size: 764
## 
## Initializing model
## 
## NOTE: Stopping adaptation
## 
## 
## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 105
##    Unobserved stochastic nodes: 143
##    Total graph size: 764
## 
## Initializing model
## 
## NOTE: Stopping adaptation</code></pre>
<p>The output of the fit() method is an mcmc.list from the coda package. Summarize posterior estimates:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.jags</span><span class="op">)</span></code></pre></div>
<p>Statistics of parameter estimates:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Note, colors may not render correctly in dark themes in RStudio.</span>
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fit_summary</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-3e9fdf6c7531bca4fc83" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3e9fdf6c7531bca4fc83">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R3","alpha.obs.fixed.cont.effort","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0.mean","alpha0.sigma","beta.fixed.cont.utm_y","beta.ranef.cont.elevation[1]","beta.ranef.cont.elevation[2]","beta.ranef.cont.elevation[3]","beta.ranef.cont.elevation[4]","beta.ranef.cont.elevation[5]","beta.ranef.cont.elevation.mean","beta.ranef.cont.elevation.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R3"],[0.453,0.227,0.307,0.645,0.398,0.406,5,0.14,0.314,1.151,0.144,0.153,1.902,4.563,-1.415,-2.633,-2.882,-0.661,-0.727,-1.662,1.468,2.174,0.095,0.075,1.066,1.932,2.064,0.979,2.362,6.271,5.469,1.836,-1.452,-1.513,1.411,4.866,0.383,0.869,0.588,0.092,0.095,2.027],[0.498,0.419,0.461,0.479,0.49,0.491,0,0.151,0.247,0.943,0.436,0.476,1.217,2.151,0.961,1.05,1.297,1.299,1.234,1.163,0.977,3.822,4.601,4.356,5.033,4.501,4.158,3.63,3.362,5.194,4.57,3.693,2.369,2.495,2.381,4.075,0.568,0.889,0.676,0.219,0.23,1.264],[0.013,0.011,0.012,0.012,0.013,0.013,0,0.004,0.006,0.024,0.011,0.012,0.031,0.055,0.025,0.027,0.033,0.034,0.032,0.03,0.025,0.099,0.119,0.112,0.13,0.116,0.107,0.094,0.087,0.134,0.118,0.095,0.061,0.064,0.061,0.105,0.015,0.023,0.017,0.006,0.006,0.033],[0.015,0.01,0.013,0.02,0.014,0.016,0,0.005,0.008,0.07,0.021,0.027,0.078,0.34,0.132,0.145,0.142,0.108,0.101,0.133,0.056,0.71,0.879,0.83,1,0.99,0.937,0.836,0.336,0.635,0.617,0.375,0.188,0.217,0.13,0.474,0.015,0.023,0.026,0.007,0.009,0.037]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Quantiles of parameter estimates:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fit_summary</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-149d3909a9bb1060c866" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-149d3909a9bb1060c866">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R3","alpha.obs.fixed.cont.effort","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0.mean","alpha0.sigma","beta.fixed.cont.utm_y","beta.ranef.cont.elevation[1]","beta.ranef.cont.elevation[2]","beta.ranef.cont.elevation[3]","beta.ranef.cont.elevation[4]","beta.ranef.cont.elevation[5]","beta.ranef.cont.elevation.mean","beta.ranef.cont.elevation.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R3"],[0.453,0.227,0.307,0.645,0.398,0.406,5,0.14,0.314,1.151,0.144,0.153,1.902,4.563,-1.415,-2.633,-2.882,-0.661,-0.727,-1.662,1.468,2.174,0.095,0.075,1.066,1.932,2.064,0.979,2.362,6.271,5.469,1.836,-1.452,-1.513,1.411,4.866,0.383,0.869,0.588,0.092,0.095,2.027],[0.498,0.419,0.461,0.479,0.49,0.491,0,0.151,0.247,0.943,0.436,0.476,1.217,2.151,0.961,1.05,1.297,1.299,1.234,1.163,0.977,3.822,4.601,4.356,5.033,4.501,4.158,3.63,3.362,5.194,4.57,3.693,2.369,2.495,2.381,4.075,0.568,0.889,0.676,0.219,0.23,1.264],[0.013,0.011,0.012,0.012,0.013,0.013,0,0.004,0.006,0.024,0.011,0.012,0.031,0.055,0.025,0.027,0.033,0.034,0.032,0.03,0.025,0.099,0.119,0.112,0.13,0.116,0.107,0.094,0.087,0.134,0.118,0.095,0.061,0.064,0.061,0.105,0.015,0.023,0.017,0.006,0.006,0.033],[0.015,0.01,0.013,0.02,0.014,0.016,0,0.005,0.008,0.07,0.021,0.027,0.078,0.34,0.132,0.145,0.142,0.108,0.101,0.133,0.056,0.71,0.879,0.83,1,0.99,0.937,0.836,0.336,0.635,0.617,0.375,0.188,0.217,0.13,0.474,0.015,0.023,0.026,0.007,0.009,0.037]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Marginal effect plots (response curves) can be plotted with plot_effects(). Arguments submodel defines whether the output is for the detection or occupancy part of the model:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.jags</span>,
              <span class="va">fit.jags</span>,
              submodel <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></code></pre></div>
<pre><code>## $elevation</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<pre><code>## 
## $utm_y</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-13-2.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.jags</span>,
              <span class="va">fit.jags</span>,
              submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code>## $effort</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-13-3.png" width="700"></p>
<p>Likewise, we can plot effect sizes for easier comparison between species and for easily checking significance with plot_coef():</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.jags</span>,
           <span class="va">fit.jags</span>,
           submodel <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></code></pre></div>
<pre><code>## $elevation</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<pre><code>## 
## $utm_y</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-14-2.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.jags</span>,
           <span class="va">fit.jags</span>,
           submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code>## $effort</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-14-3.png" width="700"></p>
</div>
<div id="models-in-nimble" class="section level2">
<h2 class="hasAnchor">
<a href="#models-in-nimble" class="anchor"></a>Models in Nimble</h2>
<div id="introduction" class="section level3">
<h3 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h3>
<p>NIMBLE is a system for building and sharing analysis methods for statistical models, especially for hierarchical models and computationally-intensive methods. NIMBLE is built in R but compiles your models and algorithms using C++ for speed.</p>
<p>(<a href="https://r-nimble.org/" class="uri">https://r-nimble.org/</a>)</p>
<p>It allows you to run the same models as BUGS or JAGS, but can be much faster in some situations.</p>
<p>Using Nimble for community occupancy models requires the packages “nimble” and “nimbleEcology”:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-nimble.org">nimble</a></span><span class="op">)</span></code></pre></div>
<pre><code>## nimble version 0.12.1 is loaded.
## For more information on NIMBLE and a User Manual,
## please visit https://R-nimble.org.</code></pre>
<pre><code>## 
## Attaching package: 'nimble'</code></pre>
<pre><code>## The following object is masked from 'package:stats':
## 
##     simulate</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nimble-dev/nimbleEcology">nimbleEcology</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: package 'nimbleEcology' was built under R version 4.1.2</code></pre>
<pre><code>## Loading nimbleEcology. Registering the following distributions:
##  dOcc, dDynOcc, dCJS, dHMM, dDHMM, dNmixture.</code></pre>
</div>
<div id="compilation-and-rtools" class="section level3">
<h3 class="hasAnchor">
<a href="#compilation-and-rtools" class="anchor"></a>Compilation and Rtools</h3>
<p>Using nimble only makes sense if one can compile the models (which runs them as fast C++ code). Compiling nimble code requires Rtools.</p>
<p>You can obtain it from here: <a href="https://cran.r-project.org/bin/windows/Rtools/" class="uri">https://cran.r-project.org/bin/windows/Rtools/</a>.</p>
<p>It then needs to be put in PATH, see here for how to do it: <a href="https://cran.r-project.org/bin/windows/Rtools/#putting-rtools-on-the-path" class="uri">https://cran.r-project.org/bin/windows/Rtools/#putting-rtools-on-the-path</a>.</p>
<p>Depending on where you installed Rtools, you should see something like “C:/rtools40/usr/bin” somewhere in the output of the following line (for me it’s usually the first or second entry).</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"PATH"</span><span class="op">)</span> </code></pre></div>
</div>
<div id="fit-models-in-nimble" class="section level3">
<h3 class="hasAnchor">
<a href="#fit-models-in-nimble" class="anchor"></a>Fit models in Nimble</h3>
<p>We can fit the same model in Nimble using the exact same functions as for the JAGS model above. Only set <code>nimble = TRUE</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">modelfile2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

 <span class="va">mod.nimble</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span><span class="va">data_list</span>,
                              occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"utm_x"</span>, ranef <span class="op">=</span> <span class="st">"utm_y"</span><span class="op">)</span>,
                              detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"effort"</span><span class="op">)</span>,
                              intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
                              modelFile <span class="op">=</span> <span class="va">modelfile2</span>,
                              nimble <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>      <span class="co"># set nimble = TRUE</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c56c36e87.txt</code></pre>
<p>It is possible to fit uncompiled models, but it is usually extremely slow and should only be done for checking model structure and expected outputs, using very few iterations.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">fit.nimble.uncomp</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">mod.nimble</span>,
                          n.iter <span class="op">=</span> <span class="fl">10</span>,
                          chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## Defining model</code></pre>
<pre><code>## Warning in checkForDeterministicDorR(code[[i]]): Model includes deterministic
## assignment using '&lt;-' of the result of a density ('d') or simulation ('r')
## calculation. This is likely not what you intended in: new.y[i, j, 1:maxocc] &lt;-
## rOcc_v(n = 1, probOcc = psi[i, j], probDetect = p.eff[i, j, 1:maxocc], len =
## maxocc).</code></pre>
<pre><code>##   [Note] Using 'y' (given within 'constants') as data.</code></pre>
<pre><code>## Building model</code></pre>
<pre><code>## Setting data and initial values</code></pre>
<pre><code>## Running calculate on model
##   [Note] Any error reports that follow may simply reflect missing values in model variables.</code></pre>
<pre><code>## Error in if (u &gt; probOcc) return(nimNumeric(0, length = k)) : 
##   missing value where TRUE/FALSE needed</code></pre>
<pre><code>## Checking model sizes and dimensions</code></pre>
<pre><code>##   [Note] This model is not fully initialized. This is not an error.
##          To see which variables are not initialized, use model$initializeInfo().
##          For more information on model initialization, see help(modelInitialization).</code></pre>
<pre><code>## ===== Monitors =====
## thin = 1: alpha.obs.fixed.cont.effort, alpha0, alpha0.mean, alpha0.sigma, beta.fixed.cont.utm_x, beta.ranef.cont.utm_y, beta.ranef.cont.utm_y.mean, beta.ranef.cont.utm_y.sigma, beta0, beta0.mean, beta0.sigma, Bpvalue, Bpvalue_species, new.R2, new.R3, R2, R3
## ===== Samplers =====
## RW sampler (17)
##   - alpha.obs.fixed.cont.effort
##   - beta.fixed.cont.utm_x
##   - beta0[]  (5 elements)
##   - alpha0[]  (5 elements)
##   - beta.ranef.cont.utm_y[]  (5 elements)
## conjugate sampler (6)
##   - beta0.mean
##   - beta0.tau
##   - alpha0.mean
##   - alpha0.tau
##   - beta.ranef.cont.utm_y.mean
##   - beta.ranef.cont.utm_y.tau</code></pre>
<pre><code>## Compiling
##   [Note] This may take a minute.
##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</code></pre>
<pre><code>## Compiling
##   [Note] This may take a minute.
##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</code></pre>
<pre><code>## running chain 1...</code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the notes and the error message below are harmless</span></code></pre></div>
<p>To fit a compiled model, set compile = TRUE:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">fit.nimble.comp</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">mod.nimble</span>,
                        n.iter <span class="op">=</span> <span class="fl">10000</span>,
                        n.burnin <span class="op">=</span> <span class="fl">5000</span>,
                        chains <span class="op">=</span> <span class="fl">3</span>,
                        compile <span class="op">=</span> <span class="cn">TRUE</span>, 
<span class="op">)</span></code></pre></div>
<pre><code>## Defining model</code></pre>
<pre><code>## Warning in checkForDeterministicDorR(code[[i]]): Model includes deterministic
## assignment using '&lt;-' of the result of a density ('d') or simulation ('r')
## calculation. This is likely not what you intended in: new.y[i, j, 1:maxocc] &lt;-
## rOcc_v(n = 1, probOcc = psi[i, j], probDetect = p.eff[i, j, 1:maxocc], len =
## maxocc).</code></pre>
<pre><code>##   [Note] Using 'y' (given within 'constants') as data.</code></pre>
<pre><code>## Building model</code></pre>
<pre><code>## Setting data and initial values</code></pre>
<pre><code>## Running calculate on model
##   [Note] Any error reports that follow may simply reflect missing values in model variables.</code></pre>
<pre><code>## Error in if (u &gt; probOcc) return(nimNumeric(0, length = k)) : 
##   missing value where TRUE/FALSE needed</code></pre>
<pre><code>## Checking model sizes and dimensions</code></pre>
<pre><code>##   [Note] This model is not fully initialized. This is not an error.
##          To see which variables are not initialized, use model$initializeInfo().
##          For more information on model initialization, see help(modelInitialization).</code></pre>
<pre><code>## ===== Monitors =====
## thin = 1: alpha.obs.fixed.cont.effort, alpha0, alpha0.mean, alpha0.sigma, beta.fixed.cont.utm_x, beta.ranef.cont.utm_y, beta.ranef.cont.utm_y.mean, beta.ranef.cont.utm_y.sigma, beta0, beta0.mean, beta0.sigma, Bpvalue, Bpvalue_species, new.R2, new.R3, R2, R3
## ===== Samplers =====
## RW sampler (17)
##   - alpha.obs.fixed.cont.effort
##   - beta.fixed.cont.utm_x
##   - beta0[]  (5 elements)
##   - alpha0[]  (5 elements)
##   - beta.ranef.cont.utm_y[]  (5 elements)
## conjugate sampler (6)
##   - beta0.mean
##   - beta0.tau
##   - alpha0.mean
##   - alpha0.tau
##   - beta.ranef.cont.utm_y.mean
##   - beta.ranef.cont.utm_y.tau</code></pre>
<pre><code>## Compiling
##   [Note] This may take a minute.
##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</code></pre>
<pre><code>## Compiling
##   [Note] This may take a minute.
##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</code></pre>
<pre><code>## running chain 1...</code></pre>
<pre><code>## |-------------|-------------|-------------|-------------|
## |-------------------------------------------------------|</code></pre>
<pre><code>## running chain 2...</code></pre>
<pre><code>## |-------------|-------------|-------------|-------------|
## |-------------------------------------------------------|</code></pre>
<pre><code>## running chain 3...</code></pre>
<pre><code>## |-------------|-------------|-------------|-------------|
## |-------------------------------------------------------|</code></pre>
<p>The output as an mcmc.list, just like for the JAGS model above, and can be treated just the same:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="co"># parameter summary statistics (not shown)</span>
 <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit.nimble.comp</span><span class="op">)</span></code></pre></div>
<p>Response curves (= marginal effect plots)</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.nimble</span>,
              <span class="va">fit.nimble.comp</span>,
              submodel <span class="op">=</span> <span class="st">"state"</span>,
              combine <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## $utm_y</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<pre><code>## 
## $utm_x</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-22-2.png" width="700"></p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.nimble</span>,
              <span class="va">fit.nimble.comp</span>,
              submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code>## $effort</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-22-3.png" width="700"></p>
<p>Effect size plots:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.nimble</span>,
           <span class="va">fit.nimble.comp</span>,
           submodel <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></code></pre></div>
<pre><code>## $utm_y</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<pre><code>## 
## $utm_x</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-23-2.png" width="700"></p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.nimble</span>,
           <span class="va">fit.nimble.comp</span>,
           submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code>## $effort</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-23-3.png" width="700"></p>
<p>Traceplots (not shown)</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">fit.nimble.comp</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div id="more-complete-example" class="section level1">
<h1 class="hasAnchor">
<a href="#more-complete-example" class="anchor"></a>More complete example</h1>
<p>The example above was very small and unrealistic. We can’t provide a large camera trapping data set, but we can simulate one using the simComm function from the AHMbook package.</p>
<div id="prepare-data-1" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-data-1" class="anchor"></a>Prepare data</h2>
<p>First, install GitHub version of AHMbook:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org">remotes</a></span><span class="op">)</span>
<span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"mikemeredith/AHMbook"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sites.google.com/site/appliedhierarchicalmodeling/home">AHMbook</a></span><span class="op">)</span></code></pre></div>
<pre><code>## This is AHMbook 0.2.3.9000. For overview type ?AHMbook; for changes do news(p='AHMbook').</code></pre>
<p>Simulate community with simComm(). Here we simulate a community with 20 species, 30 camera trap stations and 5 occasions.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">com</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AHMbook/man/simComm.html">simComm</a></span><span class="op">(</span>nspecies <span class="op">=</span> <span class="fl">20</span>, 
                nsites <span class="op">=</span> <span class="fl">30</span>,
                nreps <span class="op">=</span> <span class="fl">5</span>,
                mean.psi <span class="op">=</span> <span class="fl">0.25</span>,     <span class="co"># community mean of psi over all species in community (probability scale)  (0.25 = -1.1 on logit scale)</span>
                sig.lpsi <span class="op">=</span> <span class="fl">1</span>,        <span class="co"># SD around intercept of logit(psi)</span>
                mean.p <span class="op">=</span> <span class="fl">0.25</span>,       <span class="co"># community mean of detection probability over all species (0.25 = -1.1 on logit scale)</span>
                sig.lp <span class="op">=</span> <span class="fl">1</span>,          <span class="co"># SD around intercept of logit(p)</span>
                mu.beta.lpsi <span class="op">=</span> <span class="fl">0.5</span>,  <span class="co"># mean (community) effect of habitat on logit(psi)</span>
                sig.beta.lpsi <span class="op">=</span> <span class="fl">0.5</span>, <span class="co"># SD around mean (community) effect of habitat on logit(psi)</span>
                mu.beta.lp <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,   <span class="co"># mean (community) effect of wind on logit(p)</span>
                sig.beta.lp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>     <span class="co"># SD around mean (community) effect of wind on logit(p)</span></code></pre></div>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-27-1.png" width="700"><img src="camtrapr5_files/figure-html/unnamed-chunk-27-2.png" width="700"></p>
<p>We need to wrangle the data a little to convert output of simComm() to input for communityModel(). This is only needed here because the data are generated by AHMbook::simComm.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get continuous site covariate "habitat"</span>
<span class="va">habitat</span> <span class="op">&lt;-</span> <span class="va">com</span><span class="op">$</span><span class="va">habitat</span>

<span class="co"># create categorical covariate (2 levels)</span>
<span class="va">categ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">com</span><span class="op">$</span><span class="va">nsites</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="co"># get observation covariate</span>
<span class="va">wind</span> <span class="op">&lt;-</span> <span class="va">com</span><span class="op">$</span><span class="va">wind</span>

<span class="co"># list of detection histories</span>
<span class="va">ylist</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/array-coercion.html">array_branch</a></span><span class="op">(</span><span class="va">com</span><span class="op">$</span><span class="va">y.all</span>, <span class="fl">3</span><span class="op">)</span>

<span class="co"># remove unobserved species  (we leave that to data augmentation)</span>
<span class="va">ylist</span> <span class="op">&lt;-</span> <span class="va">ylist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ylist</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">]</span>

<span class="co"># here, effort was constant at all stations and occasions. Effort is thus a matrix of all 1</span>
<span class="va">effort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimMatrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">ylist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, ncol <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span><span class="op">(</span><span class="va">ylist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="co"># bundle data</span>
<span class="va">input_AHM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ylist <span class="op">=</span> <span class="va">ylist</span>, 
                  siteCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>habitat <span class="op">=</span> <span class="va">habitat</span>,
                                        categ   <span class="op">=</span> <span class="va">categ</span><span class="op">)</span>,
                  obsCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>effort <span class="op">=</span> <span class="va">effort</span>,
                                 wind <span class="op">=</span> <span class="va">wind</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="jags-model" class="section level2">
<h2 class="hasAnchor">
<a href="#jags-model" class="anchor"></a>JAGS Model</h2>
<p>Here’s a model in JAGS, with a species-specific effect of habitat on occupancy and wind on detection, and species-specific intercepts</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c1a7b41ac.txt</code></pre>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_ahm_jags</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags</span>, 
                    n.iter <span class="op">=</span> <span class="fl">5000</span>, 
                    n.burnin <span class="op">=</span> <span class="fl">2500</span>,
                    thin <span class="op">=</span> <span class="fl">5</span>,
                    chains <span class="op">=</span> <span class="fl">3</span>,
                    cores <span class="op">=</span> <span class="fl">1</span>,      <span class="co"># seems faster if cores = 1</span>
                    quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code>## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</code></pre>
<pre><code>## sfExportAll() ignored in sequential mode.</code></pre>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation</code></pre>
<p>Summary statistics of model parameters</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-9427f6e4a53dc5973f2a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9427f6e4a53dc5973f2a">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat[1]","beta.ranef.cont.habitat[2]","beta.ranef.cont.habitat[3]","beta.ranef.cont.habitat[4]","beta.ranef.cont.habitat[5]","beta.ranef.cont.habitat[6]","beta.ranef.cont.habitat[7]","beta.ranef.cont.habitat[8]","beta.ranef.cont.habitat[9]","beta.ranef.cont.habitat[10]","beta.ranef.cont.habitat[11]","beta.ranef.cont.habitat[12]","beta.ranef.cont.habitat[13]","beta.ranef.cont.habitat[14]","beta.ranef.cont.habitat[15]","beta.ranef.cont.habitat[16]","beta.ranef.cont.habitat[17]","beta.ranef.cont.habitat[18]","beta.ranef.cont.habitat[19]","beta.ranef.cont.habitat.mean","beta.ranef.cont.habitat.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.52,0.381,0.543,0.603,0.191,0.384,0.49,0.702,0.508,0.56,0.25,0.261,0.323,0.729,0.454,0.701,0.426,0.573,0.559,0.505,19,3.52,2.463,1.096,2.44,3.908,4.032,3.283,0.702,3.033,1.083,1.779,2.39,1.083,2.154,2.006,1.978,1.205,1.605,1.263,41.025,1.12,-0.008,-0.208,-0.206,0.291,-0.821,-0.584,-0.919,-0.372,0.163,0.811,0.341,-1.303,-0.97,-0.608,-0.053,-0.783,-0.556,-0.422,-0.265,0.806,-1.526,-1.174,-0.826,-1.781,-1.652,-0.512,-1.283,0.689,-1.114,0.247,-1.816,-1.975,-0.658,-1.727,-1.038,-0.439,-1.406,-1.649,-1.878,-1.133,0.961,-0.492,0.032,0.758,1.98,-0.611,1.068,0.432,-0.632,0.393,-0.867,2.159,1.06,-0.07,1.568,0.744,0.527,0.96,0.638,1.232,0.578,1.127,-0.79,-1.464,-2.179,-0.802,-0.819,0.452,-1.145,-1.309,-1.032,-1.231,-1.245,-1.067,-1.879,-1.227,-1.635,-1.037,-2.06,-1.713,-1.978,-1.271,0.843,4.005,2.117,0.595,3.452,4.295,4.214,2.478,0.767,2.772,1.482,2.519,2.706,0.582,2.191,1.446,2.069,0.797,1.377,1.021,40.885],[0.5,0.486,0.498,0.489,0.393,0.486,0.5,0.458,0.5,0.497,0.433,0.44,0.468,0.445,0.498,0.458,0.495,0.495,0.497,0.5,0,2.121,1.986,1.362,1.405,2.007,1.803,1.959,0.62,2.049,1.331,1.287,1.539,1.253,1.382,1.592,1.8,1.215,1.325,1.116,7.678,0.497,0.39,0.626,0.41,0.348,0.241,0.393,0.394,0.375,0.328,0.571,0.533,0.662,0.483,0.528,0.34,0.635,0.513,0.709,0.237,0.228,0.426,0.556,0.922,0.484,0.455,0.252,0.53,0.363,0.466,0.321,0.547,0.608,0.665,0.582,0.581,0.387,0.862,0.727,0.91,0.285,0.229,0.589,0.671,0.805,1.018,0.638,0.578,0.633,0.483,0.597,0.513,1.024,0.754,0.61,0.883,0.714,0.519,0.894,0.725,0.907,0.34,0.367,0.516,0.565,0.729,0.601,0.591,0.525,0.56,0.425,0.536,0.44,0.61,0.664,0.573,0.593,0.579,0.443,0.718,0.67,0.768,0.287,0.267,1.813,1.472,0.834,1.298,1.715,2.112,1.583,0.68,1.671,1.218,1.313,1.359,0.762,1.187,1.204,1.562,0.881,1.057,0.869,6.476],[0.013,0.013,0.013,0.013,0.01,0.013,0.013,0.012,0.013,0.013,0.011,0.011,0.012,0.011,0.013,0.012,0.013,0.013,0.013,0.013,0,0.055,0.051,0.035,0.036,0.052,0.047,0.051,0.016,0.053,0.034,0.033,0.04,0.032,0.036,0.041,0.046,0.031,0.034,0.029,0.198,0.013,0.01,0.016,0.011,0.009,0.006,0.01,0.01,0.01,0.008,0.015,0.014,0.017,0.012,0.014,0.009,0.016,0.013,0.018,0.006,0.006,0.011,0.014,0.024,0.012,0.012,0.007,0.014,0.009,0.012,0.008,0.014,0.016,0.017,0.015,0.015,0.01,0.022,0.019,0.023,0.007,0.006,0.015,0.017,0.021,0.026,0.016,0.015,0.016,0.012,0.015,0.013,0.026,0.019,0.016,0.023,0.018,0.013,0.023,0.019,0.023,0.009,0.009,0.013,0.015,0.019,0.016,0.015,0.014,0.014,0.011,0.014,0.011,0.016,0.017,0.015,0.015,0.015,0.011,0.019,0.017,0.02,0.007,0.007,0.047,0.038,0.022,0.033,0.044,0.054,0.041,0.018,0.043,0.031,0.034,0.035,0.02,0.031,0.031,0.04,0.023,0.027,0.022,0.167],[0.013,0.013,0.013,0.013,0.01,0.013,0.013,0.012,0.013,0.015,0.011,0.012,0.012,0.011,0.013,0.011,0.013,0.013,0.013,0.013,0,0.065,0.06,0.045,0.04,0.065,0.048,0.055,0.016,0.057,0.044,0.036,0.053,0.033,0.041,0.048,0.046,0.038,0.04,0.031,0.263,0.015,0.01,0.017,0.009,0.009,0.006,0.01,0.01,0.009,0.008,0.017,0.015,0.019,0.012,0.014,0.008,0.016,0.014,0.018,0.006,0.008,0.012,0.015,0.03,0.012,0.014,0.007,0.016,0.01,0.013,0.008,0.016,0.019,0.018,0.016,0.017,0.011,0.025,0.023,0.03,0.009,0.007,0.017,0.019,0.025,0.038,0.021,0.017,0.018,0.014,0.016,0.015,0.035,0.022,0.017,0.028,0.023,0.013,0.029,0.023,0.028,0.012,0.015,0.015,0.017,0.025,0.019,0.019,0.017,0.017,0.012,0.016,0.012,0.016,0.024,0.017,0.016,0.019,0.011,0.025,0.021,0.027,0.01,0.011,0.056,0.041,0.026,0.033,0.05,0.056,0.042,0.018,0.042,0.03,0.035,0.042,0.019,0.032,0.033,0.04,0.024,0.031,0.026,0.222]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Since we used simulated data we can compare model estimates with the truth. For example, the true effect of habitat on occupancy was mean = 0.5 (SD = 0.5). See <code>beta.ranef.cont.habitat.mean</code> and <code>beta.ranef.cont.habitat.sigma</code> in the table above for estimates</p>
<p>The mean effect of wind on detection probability was -0.5 (SD = 1). See <code>alpha.obs.ranef.cont.wind.mean</code> and <code>alpha.obs.ranef.cont.wind.sigma</code> in the table above for estimates.</p>
<p>Plot response curves (marginal effects)</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_resp_jags_occu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">model1_jags</span>, 
                                    <span class="va">out_ahm_jags</span><span class="op">)</span>
<span class="va">plot_resp_jags_occu</span></code></pre></div>
<pre><code>## $habitat</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_resp_jags_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">model1_jags</span>, 
                                   <span class="va">out_ahm_jags</span>,
                                   submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span>
<span class="va">plot_resp_jags_det</span></code></pre></div>
<pre><code>## $wind</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-32-2.png" width="700"></p>
<p>Plot coefficient estimates</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_eff_jags_occu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">model1_jags</span>, 
                                <span class="va">out_ahm_jags</span><span class="op">)</span>
<span class="va">plot_eff_jags_occu</span></code></pre></div>
<pre><code>## $habitat</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_eff_jags_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">model1_jags</span>, 
                               <span class="va">out_ahm_jags</span>,
                               submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span>
<span class="va">plot_eff_jags_det</span></code></pre></div>
<pre><code>## $wind</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-33-2.png" width="700"></p>
<p>By default, species are sorted by effect size. Alternatively, you can have them sorted by species names. Set <code>ordered = FALSE</code>:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_eff_jags_occu2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">model1_jags</span>, 
                                <span class="va">out_ahm_jags</span>,
                                ordered <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">plot_eff_jags_occu2</span></code></pre></div>
<pre><code>## $habitat</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
</div>
<div id="nimble-model" class="section level2">
<h2 class="hasAnchor">
<a href="#nimble-model" class="anchor"></a>Nimble Model</h2>
<p>Here’s the same model in Nimble:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_nimble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_nimble</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>,
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_nimble</span>,
  nimble <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c598320ea.txt</code></pre>
<p>We use some more iterations, since these Nimble models tend to require more iterations than equivalend JAGS models to achieve good estimates.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compiled model run</span>
<span class="va">out_ahm_nimble2</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_nimble</span>, 
                       n.iter <span class="op">=</span> <span class="fl">5000</span>,
                       n.burnin <span class="op">=</span> <span class="fl">2500</span>,
                       thin <span class="op">=</span> <span class="fl">5</span>,
                       chains <span class="op">=</span> <span class="fl">3</span>,
                       compile <span class="op">=</span> <span class="cn">TRUE</span>,
                       quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code>## Defining model</code></pre>
<pre><code>## Warning in checkForDeterministicDorR(code[[i]]): Model includes deterministic
## assignment using '&lt;-' of the result of a density ('d') or simulation ('r')
## calculation. This is likely not what you intended in: new.y[i, j, 1:maxocc] &lt;-
## rOcc_v(n = 1, probOcc = psi[i, j], probDetect = p.eff[i, j, 1:maxocc], len =
## maxocc).</code></pre>
<pre><code>##   [Note] Using 'y' (given within 'constants') as data.</code></pre>
<pre><code>## Building model</code></pre>
<pre><code>## Setting data and initial values</code></pre>
<pre><code>## Running calculate on model
##   [Note] Any error reports that follow may simply reflect missing values in model variables.</code></pre>
<pre><code>## Error in if (u &gt; probOcc) return(nimNumeric(0, length = k)) : 
##   missing value where TRUE/FALSE needed</code></pre>
<pre><code>## Checking model sizes and dimensions</code></pre>
<pre><code>##   [Note] This model is not fully initialized. This is not an error.
##          To see which variables are not initialized, use model$initializeInfo().
##          For more information on model initialization, see help(modelInitialization).</code></pre>
<pre><code>## Compiling
##   [Note] This may take a minute.
##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.
## Compiling
##   [Note] This may take a minute.
##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</code></pre>
<pre><code>## running chain 1...</code></pre>
<pre><code>## running chain 2...</code></pre>
<pre><code>## running chain 3...</code></pre>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out_ahm_nimble2</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-da23609f9a4f16bee87b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-da23609f9a4f16bee87b">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat[1]","beta.ranef.cont.habitat[2]","beta.ranef.cont.habitat[3]","beta.ranef.cont.habitat[4]","beta.ranef.cont.habitat[5]","beta.ranef.cont.habitat[6]","beta.ranef.cont.habitat[7]","beta.ranef.cont.habitat[8]","beta.ranef.cont.habitat[9]","beta.ranef.cont.habitat[10]","beta.ranef.cont.habitat[11]","beta.ranef.cont.habitat[12]","beta.ranef.cont.habitat[13]","beta.ranef.cont.habitat[14]","beta.ranef.cont.habitat[15]","beta.ranef.cont.habitat[16]","beta.ranef.cont.habitat[17]","beta.ranef.cont.habitat[18]","beta.ranef.cont.habitat[19]","beta.ranef.cont.habitat.mean","beta.ranef.cont.habitat.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.437,0.398,0.537,0.785,0.194,0.317,0.148,0.461,0.507,0.473,0.477,0.331,0.359,0.431,0.41,0.635,0.441,0.761,0.539,0.697,25.389,33.949,49.187,19.756,20.858,26.47,31.757,71.755,32.851,59.2,21.526,18.846,52.115,27.96,41.443,46.25,35.68,27.956,25.713,668.661,1.096,-0.009,-0.231,-0.195,0.288,-0.818,-0.585,-0.932,-0.352,0.153,0.839,0.348,-1.293,-0.976,-0.577,-0.047,-0.768,-0.588,-0.43,-0.269,0.804,-1.528,-1.159,-0.847,-1.802,-1.639,-0.522,-1.282,0.731,-1.13,0.247,-1.816,-2.005,-0.652,-1.713,-1.006,-0.45,-1.506,-1.69,-1.958,-1.138,0.978,-0.468,0.061,0.701,2.067,-0.619,1.057,0.411,-0.627,0.388,-0.854,2.2,1.063,-0.083,1.579,0.763,0.549,0.956,0.637,1.225,0.585,1.135,-0.802,-1.465,-2.186,-0.796,-0.835,0.448,-1.162,-1.308,-1.055,-1.234,-1.248,-1.072,-1.878,-1.235,-1.621,-1.022,-2.01,-1.715,-1.897,-1.265,0.83,25.953,33.435,46.523,20.923,21.689,33.673,31.798,71.462,32.797,59.267,22.206,19.112,52.067,28.119,40.019,46.506,34.09,27.392,24.593,671.626],[0.496,0.49,0.499,0.411,0.396,0.466,0.355,0.499,0.5,0.499,0.5,0.471,0.48,0.495,0.492,0.482,0.497,0.427,0.499,0.46,6.751,12.591,24.379,7.519,6.895,3.093,10.382,7.662,9.455,7.713,7.423,8.644,14.726,10.461,13.49,9.544,20.208,13.784,17.679,65.724,0.518,0.386,0.625,0.418,0.341,0.245,0.395,0.397,0.371,0.332,0.577,0.542,0.657,0.503,0.548,0.347,0.644,0.492,0.688,0.231,0.231,0.428,0.559,0.929,0.478,0.453,0.244,0.53,0.372,0.445,0.319,0.54,0.613,0.66,0.599,0.555,0.369,0.938,0.735,0.935,0.284,0.234,0.585,0.632,0.768,1.017,0.691,0.546,0.677,0.466,0.58,0.524,1.057,0.74,0.582,0.849,0.709,0.525,0.887,0.729,0.932,0.342,0.366,0.517,0.582,0.728,0.595,0.607,0.554,0.55,0.433,0.517,0.442,0.563,0.661,0.561,0.588,0.558,0.433,0.787,0.679,0.751,0.275,0.274,7.725,12.96,23.347,7.583,7.39,8.042,10.925,12.809,10.228,11.523,7.526,8.708,14.712,10.647,13.625,11.23,19.47,13.443,16.684,69.259],[0.013,0.013,0.013,0.011,0.01,0.012,0.009,0.013,0.013,0.013,0.013,0.012,0.012,0.013,0.013,0.012,0.013,0.011,0.013,0.012,0.174,0.325,0.629,0.194,0.178,0.08,0.268,0.198,0.244,0.199,0.192,0.223,0.38,0.27,0.348,0.246,0.522,0.356,0.456,1.697,0.013,0.01,0.016,0.011,0.009,0.006,0.01,0.01,0.01,0.009,0.015,0.014,0.017,0.013,0.014,0.009,0.017,0.013,0.018,0.006,0.006,0.011,0.014,0.024,0.012,0.012,0.006,0.014,0.01,0.011,0.008,0.014,0.016,0.017,0.015,0.014,0.01,0.024,0.019,0.024,0.007,0.006,0.015,0.016,0.02,0.026,0.018,0.014,0.017,0.012,0.015,0.014,0.027,0.019,0.015,0.022,0.018,0.014,0.023,0.019,0.024,0.009,0.009,0.013,0.015,0.019,0.015,0.016,0.014,0.014,0.011,0.013,0.011,0.015,0.017,0.014,0.015,0.014,0.011,0.02,0.018,0.019,0.007,0.007,0.199,0.335,0.603,0.196,0.191,0.208,0.282,0.331,0.264,0.298,0.194,0.225,0.38,0.275,0.352,0.29,0.503,0.347,0.431,1.788],[0.015,0.015,0.014,0.011,0.011,0.012,0.01,0.013,0.013,0.014,0.013,0.011,0.012,0.014,0.013,0.012,0.013,0.012,0.013,0.012,0.211,0.456,0.788,0.218,0.237,0.095,0.336,0.228,0.292,0.236,0.242,0.298,0.551,0.327,0.418,0.307,0.708,0.462,0.681,3.107,0.019,0.014,0.019,0.013,0.01,0.008,0.013,0.012,0.011,0.01,0.023,0.018,0.029,0.017,0.016,0.011,0.021,0.016,0.023,0.006,0.01,0.015,0.02,0.038,0.014,0.016,0.008,0.018,0.011,0.014,0.01,0.02,0.022,0.029,0.019,0.017,0.011,0.038,0.026,0.039,0.012,0.009,0.019,0.02,0.023,0.043,0.029,0.022,0.023,0.017,0.018,0.019,0.045,0.023,0.018,0.03,0.022,0.015,0.03,0.023,0.035,0.011,0.019,0.019,0.019,0.03,0.02,0.025,0.027,0.019,0.015,0.017,0.015,0.018,0.024,0.021,0.018,0.019,0.014,0.031,0.028,0.029,0.011,0.014,0.275,0.457,0.768,0.235,0.272,0.271,0.356,0.373,0.311,0.343,0.257,0.309,0.551,0.339,0.426,0.387,0.733,0.469,0.654,3.301]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Plot responses (marginal effects)</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_resp_nimble_occu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">model1_nimble</span>, 
                                      <span class="va">out_ahm_nimble2</span><span class="op">)</span>
<span class="va">plot_resp_nimble_occu</span></code></pre></div>
<pre><code>## $habitat</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_resp_nimble_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">model1_nimble</span>, 
                                     <span class="va">out_ahm_nimble2</span>,
                                     submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span>
<span class="va">plot_resp_nimble_det</span></code></pre></div>
<pre><code>## $wind</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-37-2.png" width="700"></p>
<p>Plot coefficient estimates</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_eff_nimble_occu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">model1_nimble</span>, 
                                  <span class="va">out_ahm_nimble2</span><span class="op">)</span>
<span class="va">plot_eff_nimble_occu</span></code></pre></div>
<pre><code>## $habitat</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-38-1.png" width="700"></p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_eff_nimble_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">model1_nimble</span>, 
                                 <span class="va">out_ahm_nimble2</span>,
                                 submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span>
<span class="va">plot_eff_nimble_det</span></code></pre></div>
<pre><code>## $wind</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-38-2.png" width="700"></p>
</div>
</div>
<div id="further-possibilies" class="section level1">
<h1 class="hasAnchor">
<a href="#further-possibilies" class="anchor"></a>Further possibilies</h1>
<p>This section demonstrates additional possibilities. The models here are (mostly) fit in JAGS, but can also be fitted with Nimble.</p>
<div id="fixed-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#fixed-effects" class="anchor"></a>Fixed effects</h2>
<p>One can define fixed effects of covariates if the responses are thought to be constant across all species.</p>
</div>
<div id="priors" class="section level2">
<h2 class="hasAnchor">
<a href="#priors" class="anchor"></a>Priors</h2>
<p>It is not yet possible to customize priors. The current defaults are:</p>
<ul>
<li>dnorm(0, 0.05) : random effect means</li>
<li>dgamma(0.1, 0.1): random effect precision (tau)</li>
</ul>
</div>
<div id="data-augmentation" class="section level2">
<h2 class="hasAnchor">
<a href="#data-augmentation" class="anchor"></a>Data augmentation</h2>
<p>communityModel has an argument “augmentation”, which can implement fully open data augmentation or data augmentation up to a known maximum number of species.</p>
<p>We know there are 20 species in the community. We can inform the model that the community is known to consist of 20 species via: augmentation = c(maxknown = 20)</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_aug1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_aug1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  augmentation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span>maxknown <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_aug1</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c619627cd.txt</code></pre>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_aug1</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_aug1</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span> ,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code>## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</code></pre>
<pre><code>## sfExportAll() ignored in sequential mode.</code></pre>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation</code></pre>
<p>Here is another example with fully open data augmentation (metacommunity size is unknown). The model will estimate the probability for each species to be part of the metacommunity.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_aug2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_aug2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  augmentation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span>full <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_aug2</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c24011a64.txt</code></pre>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_aug2</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_aug2</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code>## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</code></pre>
<pre><code>## sfExportAll() ignored in sequential mode.</code></pre>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation</code></pre>
<p>See parameters “omega” and “w[1]” to “w[30]” in the model output:</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_aug2</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-1a93a4626d300785d135" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1a93a4626d300785d135">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Bpvalue_species[20]","Bpvalue_species[21]","Bpvalue_species[22]","Bpvalue_species[23]","Bpvalue_species[24]","Bpvalue_species[25]","Bpvalue_species[26]","Bpvalue_species[27]","Bpvalue_species[28]","Bpvalue_species[29]","Bpvalue_species[30]","Nspecies","Ntotal","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R2[20]","R2[21]","R2[22]","R2[23]","R2[24]","R2[25]","R2[26]","R2[27]","R2[28]","R2[29]","R2[30]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind[20]","alpha.obs.ranef.cont.wind[21]","alpha.obs.ranef.cont.wind[22]","alpha.obs.ranef.cont.wind[23]","alpha.obs.ranef.cont.wind[24]","alpha.obs.ranef.cont.wind[25]","alpha.obs.ranef.cont.wind[26]","alpha.obs.ranef.cont.wind[27]","alpha.obs.ranef.cont.wind[28]","alpha.obs.ranef.cont.wind[29]","alpha.obs.ranef.cont.wind[30]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0[20]","alpha0[21]","alpha0[22]","alpha0[23]","alpha0[24]","alpha0[25]","alpha0[26]","alpha0[27]","alpha0[28]","alpha0[29]","alpha0[30]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat[1]","beta.ranef.cont.habitat[2]","beta.ranef.cont.habitat[3]","beta.ranef.cont.habitat[4]","beta.ranef.cont.habitat[5]","beta.ranef.cont.habitat[6]","beta.ranef.cont.habitat[7]","beta.ranef.cont.habitat[8]","beta.ranef.cont.habitat[9]","beta.ranef.cont.habitat[10]","beta.ranef.cont.habitat[11]","beta.ranef.cont.habitat[12]","beta.ranef.cont.habitat[13]","beta.ranef.cont.habitat[14]","beta.ranef.cont.habitat[15]","beta.ranef.cont.habitat[16]","beta.ranef.cont.habitat[17]","beta.ranef.cont.habitat[18]","beta.ranef.cont.habitat[19]","beta.ranef.cont.habitat[20]","beta.ranef.cont.habitat[21]","beta.ranef.cont.habitat[22]","beta.ranef.cont.habitat[23]","beta.ranef.cont.habitat[24]","beta.ranef.cont.habitat[25]","beta.ranef.cont.habitat[26]","beta.ranef.cont.habitat[27]","beta.ranef.cont.habitat[28]","beta.ranef.cont.habitat[29]","beta.ranef.cont.habitat[30]","beta.ranef.cont.habitat.mean","beta.ranef.cont.habitat.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0[20]","beta0[21]","beta0[22]","beta0[23]","beta0[24]","beta0[25]","beta0[26]","beta0[27]","beta0[28]","beta0[29]","beta0[30]","beta0.mean","beta0.sigma","n0","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R2[20]","new.R2[21]","new.R2[22]","new.R2[23]","new.R2[24]","new.R2[25]","new.R2[26]","new.R2[27]","new.R2[28]","new.R2[29]","new.R2[30]","new.R3","omega","w[1]","w[2]","w[3]","w[4]","w[5]","w[6]","w[7]","w[8]","w[9]","w[10]","w[11]","w[12]","w[13]","w[14]","w[15]","w[16]","w[17]","w[18]","w[19]","w[20]","w[21]","w[22]","w[23]","w[24]","w[25]","w[26]","w[27]","w[28]","w[29]","w[30]"],[0.49,0.353,0.458,0.582,0.203,0.425,0.49,0.654,0.542,0.601,0.288,0.288,0.294,0.706,0.418,0.647,0.464,0.588,0.582,0.477,0.072,0.052,0.052,0.072,0.033,0.039,0.026,0.013,0.039,0.039,0.065,20.235,21.118,3.475,2.167,0.941,2.434,3.971,4.296,3.057,0.702,3.287,1.284,1.775,2.031,0.995,1.935,1.854,1.955,1.15,1.563,1.122,0.14,0.162,0.096,0.193,0.107,0.135,0.105,0.031,0.13,0.083,0.155,41.33,1.047,0.004,-0.259,-0.224,0.292,-0.818,-0.615,-0.906,-0.362,0.197,0.779,0.354,-1.305,-0.91,-0.607,-0.029,-0.817,-0.525,-0.325,-0.256,-0.328,-0.163,-0.339,-0.32,-0.31,-0.256,-0.291,-0.258,-0.343,-0.334,-0.256,0.771,-1.505,-1.097,-0.769,-1.791,-1.667,-0.551,-1.325,0.694,-1.142,0.265,-1.818,-2.024,-0.637,-1.693,-1.015,-0.441,-1.49,-1.654,-1.947,-1.28,-1.527,-1.34,-1.259,-1.382,-1.286,-1.092,-1.185,-1.328,-1.326,-1.314,-1.171,1.013,-0.449,0.043,0.744,2.014,-0.633,1.078,0.369,-0.675,0.357,-0.803,2.183,1.12,-0.097,1.652,0.806,0.49,0.958,0.614,1.325,0.757,0.579,0.651,0.524,0.557,0.51,0.664,0.691,0.676,0.649,0.592,0.625,1.103,-0.823,-1.551,-2.37,-0.773,-0.878,0.492,-1.22,-1.4,-1.025,-1.231,-1.241,-1.142,-2.019,-1.366,-1.723,-1.117,-2.174,-1.793,-2.032,-1.576,-1.645,-1.717,-1.617,-1.654,-1.727,-1.598,-1.615,-1.482,-1.738,-1.666,-1.456,0.967,2.118,4.048,1.903,0.503,3.476,4.298,4.346,2.521,0.681,2.992,1.613,2.371,2.464,0.499,2.106,1.364,2.038,0.773,1.341,1.003,0.084,0.158,0.045,0.126,0.083,0.105,0.086,0.009,0.079,0.065,0.106,41.282,0.696,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0.183,0.209,0.144,0.281,0.17,0.216,0.19,0.131,0.19,0.183,0.222],[0.502,0.479,0.5,0.495,0.403,0.496,0.502,0.477,0.5,0.491,0.454,0.454,0.457,0.457,0.495,0.479,0.5,0.494,0.495,0.501,0.259,0.223,0.223,0.259,0.178,0.195,0.16,0.114,0.195,0.195,0.248,1.185,1.936,2.238,1.947,1.175,1.416,2.172,1.788,1.752,0.651,2.265,1.708,1.304,1.323,1.091,1.181,1.617,1.751,1.134,1.309,0.982,0.391,0.507,0.465,0.543,0.463,0.464,0.479,0.257,0.53,0.3,0.439,8.132,0.534,0.376,0.603,0.421,0.33,0.225,0.384,0.411,0.348,0.337,0.472,0.563,0.658,0.468,0.544,0.369,0.615,0.494,0.714,0.715,0.764,0.793,0.811,0.813,0.806,0.799,0.807,0.754,0.797,0.892,0.244,0.225,0.43,0.524,0.766,0.483,0.474,0.233,0.559,0.355,0.481,0.333,0.501,0.622,0.592,0.59,0.575,0.376,0.864,0.691,1.024,1.204,1.265,1.256,1.17,1.244,1.162,1.261,1.011,1.261,1.139,1.221,0.319,0.237,0.653,0.67,0.745,1.134,0.628,0.53,0.642,0.49,0.67,0.486,0.965,0.718,0.613,0.948,0.872,0.538,0.914,0.694,1.187,1.233,1.19,1.215,1.113,1.233,1.073,1.223,1.248,1.241,0.947,1.113,0.357,0.362,0.545,0.605,0.677,0.628,0.675,0.522,0.556,0.446,0.591,0.46,0.649,0.667,0.558,0.59,0.588,0.416,0.738,0.631,0.848,1.168,1.097,1.171,1.185,1.087,1.162,1.116,1.145,1.087,1.114,1.106,0.337,0.316,1.936,1.813,1.472,0.75,1.404,1.766,2.047,1.575,0.541,1.854,1.364,1.244,1.092,0.564,1.134,1.133,1.503,0.867,1.02,0.792,0.269,0.541,0.237,0.38,0.33,0.365,0.403,0.09,0.322,0.256,0.322,6.255,0.103,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.388,0.408,0.352,0.451,0.377,0.413,0.393,0.338,0.393,0.388,0.417],[0.041,0.039,0.04,0.04,0.033,0.04,0.041,0.039,0.04,0.04,0.037,0.037,0.037,0.037,0.04,0.039,0.04,0.04,0.04,0.041,0.021,0.018,0.018,0.021,0.014,0.016,0.013,0.009,0.016,0.016,0.02,0.096,0.157,0.181,0.157,0.095,0.115,0.176,0.145,0.142,0.053,0.183,0.138,0.105,0.107,0.088,0.095,0.131,0.142,0.092,0.106,0.079,0.032,0.041,0.038,0.044,0.037,0.038,0.039,0.021,0.043,0.024,0.036,0.657,0.043,0.03,0.049,0.034,0.027,0.018,0.031,0.033,0.028,0.027,0.038,0.046,0.053,0.038,0.044,0.03,0.05,0.04,0.058,0.058,0.062,0.064,0.066,0.066,0.065,0.065,0.065,0.061,0.064,0.072,0.02,0.018,0.035,0.042,0.062,0.039,0.038,0.019,0.045,0.029,0.039,0.027,0.04,0.05,0.048,0.048,0.046,0.03,0.07,0.056,0.083,0.097,0.102,0.102,0.095,0.101,0.094,0.102,0.082,0.102,0.092,0.099,0.026,0.019,0.053,0.054,0.06,0.092,0.051,0.043,0.052,0.04,0.054,0.039,0.078,0.058,0.05,0.077,0.07,0.043,0.074,0.056,0.096,0.1,0.096,0.098,0.09,0.1,0.087,0.099,0.101,0.1,0.077,0.09,0.029,0.029,0.044,0.049,0.055,0.051,0.055,0.042,0.045,0.036,0.048,0.037,0.052,0.054,0.045,0.048,0.048,0.034,0.06,0.051,0.069,0.094,0.089,0.095,0.096,0.088,0.094,0.09,0.093,0.088,0.09,0.089,0.027,0.026,0.157,0.147,0.119,0.061,0.114,0.143,0.165,0.127,0.044,0.15,0.11,0.101,0.088,0.046,0.092,0.092,0.121,0.07,0.082,0.064,0.022,0.044,0.019,0.031,0.027,0.03,0.033,0.007,0.026,0.021,0.026,0.506,0.008,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.031,0.033,0.028,0.036,0.03,0.033,0.032,0.027,0.032,0.031,0.034],[0.041,0.039,0.038,0.04,0.033,0.028,0.05,0.043,0.04,0.04,0.037,0.033,0.037,0.034,0.04,0.06,0.039,0.04,0.047,0.041,0.026,0.02,0.021,0.021,0.014,0.02,0.016,0.009,0.016,0.016,0.02,0.229,0.376,0.197,0.166,0.12,0.106,0.169,0.156,0.134,0.053,0.255,0.139,0.132,0.123,0.088,0.101,0.129,0.159,0.13,0.104,0.126,0.037,0.067,0.038,0.063,0.041,0.063,0.039,0.021,0.049,0.028,0.038,0.956,0.041,0.04,0.05,0.037,0.023,0.02,0.028,0.033,0.028,0.027,0.038,0.046,0.063,0.034,0.036,0.025,0.05,0.034,0.069,0.057,0.062,0.059,0.072,0.06,0.071,0.063,0.066,0.061,0.072,0.067,0.02,0.019,0.032,0.049,0.062,0.039,0.043,0.017,0.055,0.022,0.049,0.027,0.076,0.05,0.054,0.055,0.052,0.026,0.082,0.051,0.102,0.097,0.131,0.093,0.11,0.118,0.104,0.092,0.072,0.142,0.093,0.101,0.035,0.021,0.084,0.045,0.06,0.123,0.051,0.04,0.054,0.039,0.054,0.039,0.101,0.073,0.045,0.086,0.085,0.043,0.083,0.057,0.153,0.09,0.082,0.123,0.057,0.109,0.084,0.098,0.099,0.087,0.071,0.09,0.032,0.054,0.05,0.054,0.064,0.061,0.068,0.048,0.045,0.038,0.042,0.034,0.053,0.071,0.044,0.048,0.048,0.038,0.065,0.064,0.13,0.116,0.11,0.118,0.126,0.105,0.092,0.121,0.118,0.127,0.112,0.106,0.042,0.047,0.376,0.146,0.119,0.089,0.113,0.166,0.15,0.143,0.044,0.148,0.089,0.101,0.094,0.046,0.092,0.092,0.097,0.077,0.091,0.077,0.027,0.066,0.019,0.047,0.037,0.065,0.032,0.007,0.04,0.032,0.029,0.553,0.013,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.038,0.06,0.036,0.061,0.047,0.042,0.045,0.044,0.05,0.071,0.045]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="categorical-covariates" class="section level2">
<h2 class="hasAnchor">
<a href="#categorical-covariates" class="anchor"></a>Categorical covariates</h2>
<div id="site-covariates" class="section level3">
<h3 class="hasAnchor">
<a href="#site-covariates" class="anchor"></a>Site covariates</h3>
<p>Site covariates will be interpreted as categorical if they are factors in the input data frame. If a random effect of a categorical covariate is defined, there will be independent species-level random effects within each factor level of the categorical covariate. In other words, each factor level will have its own and independent random effect of species.</p>
<p>Here is an example with a categorical site covariate:</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_categ1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model_jags_categ1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"categ"</span><span class="op">)</span><span class="op">)</span>,
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_categ1</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c73a776a.txt</code></pre>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_categ1</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model_jags_categ1</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code>## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</code></pre>
<pre><code>## sfExportAll() ignored in sequential mode.</code></pre>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation</code></pre>
<p>Plot the results:</p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">model_jags_categ1</span>,
             mcmc.list <span class="op">=</span> <span class="va">out_ahm_jags_categ1</span><span class="op">)</span></code></pre></div>
<pre><code>## $categ</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-43-1.png" width="700"></p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">model_jags_categ1</span>,
          mcmc.list <span class="op">=</span> <span class="va">out_ahm_jags_categ1</span><span class="op">)</span></code></pre></div>
<pre><code>## Currently coefficients of categorical covariates may not be sorted correctly. This is a known limitation.</code></pre>
<pre><code>## $categ</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-43-2.png" width="700"></p>
<p>See the arguments <code>beta.ranef.categ.categ</code>. The species effects have two indices: [species, factorLevel]. Accordingly, there are two estimates for <code>mean</code> and <code>SD</code>, respectively. All estimates for the first factor level are 0, since the intercept refers to the first factor level.</p>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_categ1</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-b90a197ca3cfc5219e27" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b90a197ca3cfc5219e27">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.categ.categ[1,1]","beta.ranef.categ.categ[2,1]","beta.ranef.categ.categ[3,1]","beta.ranef.categ.categ[4,1]","beta.ranef.categ.categ[5,1]","beta.ranef.categ.categ[6,1]","beta.ranef.categ.categ[7,1]","beta.ranef.categ.categ[8,1]","beta.ranef.categ.categ[9,1]","beta.ranef.categ.categ[10,1]","beta.ranef.categ.categ[11,1]","beta.ranef.categ.categ[12,1]","beta.ranef.categ.categ[13,1]","beta.ranef.categ.categ[14,1]","beta.ranef.categ.categ[15,1]","beta.ranef.categ.categ[16,1]","beta.ranef.categ.categ[17,1]","beta.ranef.categ.categ[18,1]","beta.ranef.categ.categ[19,1]","beta.ranef.categ.categ[1,2]","beta.ranef.categ.categ[2,2]","beta.ranef.categ.categ[3,2]","beta.ranef.categ.categ[4,2]","beta.ranef.categ.categ[5,2]","beta.ranef.categ.categ[6,2]","beta.ranef.categ.categ[7,2]","beta.ranef.categ.categ[8,2]","beta.ranef.categ.categ[9,2]","beta.ranef.categ.categ[10,2]","beta.ranef.categ.categ[11,2]","beta.ranef.categ.categ[12,2]","beta.ranef.categ.categ[13,2]","beta.ranef.categ.categ[14,2]","beta.ranef.categ.categ[15,2]","beta.ranef.categ.categ[16,2]","beta.ranef.categ.categ[17,2]","beta.ranef.categ.categ[18,2]","beta.ranef.categ.categ[19,2]","beta.ranef.categ.categ.mean[1]","beta.ranef.categ.categ.mean[2]","beta.ranef.categ.categ.sigma[1]","beta.ranef.categ.categ.sigma[2]","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.516,0.32,0.536,0.595,0.261,0.379,0.523,0.627,0.425,0.516,0.176,0.392,0.307,0.719,0.575,0.712,0.458,0.529,0.608,0.451,19,3.172,2.528,1.157,3.564,3.686,4.811,2.797,0.629,2.991,0.915,3.158,2.832,0.952,2.705,2.026,2.064,1.14,1.8,1.282,44.209,1.135,-0.029,-0.14,-0.062,0.231,-0.776,-0.596,-0.888,-0.317,0.184,0.916,0.434,-1.28,-0.916,-0.565,-0.086,-0.744,-0.533,-0.306,-0.247,0.828,-1.537,-1.179,-0.841,-2.018,-1.644,-0.531,-1.264,0.752,-1.176,0.256,-2.115,-2.289,-0.596,-1.936,-1.028,-0.419,-1.537,-1.85,-2.125,-1.197,1.09,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.002,0.098,-0.035,1.214,0.193,0.914,-0.027,-0.123,0.426,-0.668,0.979,0.52,-0.263,0.658,0.217,-0.013,0.025,0.191,0.192,0,0.257,0,0.806,-0.752,-1.505,-2.138,-1.126,-0.855,-0.209,-1.324,-1.059,-1.276,-0.76,-1.253,-1.117,-1.692,-1.418,-1.733,-1.144,-2.106,-1.671,-1.937,-1.313,0.767,3.884,2.261,0.636,4.176,4.145,4.765,2.341,0.744,2.984,1.529,3.423,3.178,0.481,2.497,1.399,2.151,0.816,1.522,1.178,44.11],[0.501,0.468,0.5,0.493,0.441,0.487,0.501,0.485,0.496,0.501,0.382,0.49,0.463,0.451,0.496,0.454,0.5,0.501,0.49,0.499,0,1.999,2.071,1.343,1.74,2.098,2.224,1.844,0.448,1.972,1.172,1.896,1.69,1.049,1.741,1.684,1.841,1.157,1.403,1.108,8.587,0.556,0.387,0.669,0.432,0.363,0.234,0.385,0.41,0.384,0.384,0.605,0.575,0.656,0.534,0.565,0.35,0.655,0.533,0.621,0.259,0.295,0.414,0.551,1.037,0.517,0.441,0.263,0.531,0.356,0.413,0.343,0.577,0.609,0.644,0.637,0.559,0.402,0.929,0.776,0.921,0.297,0.245,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.57,0.645,0.689,0.882,0.614,0.626,0.603,0.601,0.538,0.723,0.817,0.705,0.689,0.87,0.688,0.594,0.787,0.668,0.809,0,0.287,0,0.382,0.535,0.569,0.707,0.623,0.535,0.487,0.506,0.428,0.488,0.421,0.65,0.717,0.49,0.617,0.587,0.427,0.714,0.673,0.788,0.279,0.298,1.695,1.576,0.853,1.434,1.854,2.55,1.627,0.609,1.603,1.269,1.536,1.417,0.68,1.322,1.211,1.527,0.92,1.192,0.933,6.884],[0.041,0.038,0.04,0.04,0.036,0.039,0.041,0.039,0.04,0.041,0.031,0.04,0.037,0.036,0.04,0.037,0.04,0.04,0.04,0.04,0,0.162,0.167,0.109,0.141,0.17,0.18,0.149,0.036,0.159,0.095,0.153,0.137,0.085,0.141,0.136,0.149,0.094,0.113,0.09,0.694,0.045,0.031,0.054,0.035,0.029,0.019,0.031,0.033,0.031,0.031,0.049,0.046,0.053,0.043,0.046,0.028,0.053,0.043,0.05,0.021,0.024,0.033,0.045,0.084,0.042,0.036,0.021,0.043,0.029,0.033,0.028,0.047,0.049,0.052,0.051,0.045,0.033,0.075,0.063,0.074,0.024,0.02,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.046,0.052,0.056,0.071,0.05,0.051,0.049,0.049,0.044,0.058,0.066,0.057,0.056,0.07,0.056,0.048,0.064,0.054,0.065,0,0.023,0,0.031,0.043,0.046,0.057,0.05,0.043,0.039,0.041,0.035,0.039,0.034,0.053,0.058,0.04,0.05,0.047,0.034,0.058,0.054,0.064,0.023,0.024,0.137,0.127,0.069,0.116,0.15,0.206,0.132,0.049,0.13,0.103,0.124,0.115,0.055,0.107,0.098,0.123,0.074,0.096,0.075,0.557],[0.04,0.039,0.039,0.038,0.036,0.04,0.04,0.035,0.04,0.04,0.031,0.033,0.034,0.037,0.037,0.038,0.036,0.047,0.04,0.04,0,0.192,0.168,0.109,0.166,0.171,0.169,0.14,0.036,0.159,0.098,0.155,0.155,0.085,0.201,0.135,0.134,0.093,0.151,0.11,1.064,0.057,0.028,0.054,0.036,0.028,0.019,0.031,0.033,0.038,0.031,0.056,0.046,0.063,0.035,0.047,0.026,0.053,0.039,0.05,0.02,0.033,0.031,0.045,0.093,0.064,0.043,0.019,0.041,0.026,0.034,0.024,0.052,0.063,0.063,0.06,0.05,0.037,0.076,0.079,0.086,0.027,0.022,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.044,0.052,0.056,0.12,0.044,0.055,0.055,0.049,0.043,0.08,0.114,0.069,0.051,0.114,0.062,0.053,0.076,0.065,0.063,0,0.029,0,0.06,0.06,0.051,0.084,0.077,0.043,0.055,0.041,0.031,0.039,0.037,0.074,0.076,0.042,0.062,0.063,0.027,0.077,0.071,0.082,0.036,0.037,0.174,0.149,0.077,0.128,0.181,0.197,0.131,0.049,0.132,0.103,0.125,0.138,0.055,0.118,0.09,0.124,0.081,0.127,0.092,0.732]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="observation-level-covariates" class="section level3">
<h3 class="hasAnchor">
<a href="#observation-level-covariates" class="anchor"></a>Observation-level covariates</h3>
<p>Currently categorical observation-level covariates are only fully supported in JAGS, not Nimble. Observation-level covariates are matrices and can’t be factors. Thus they need to be defined as character matrices.</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create example categorical observation covariate</span>
<span class="va">input_AHM</span><span class="op">$</span><span class="va">obsCovs</span><span class="op">$</span><span class="va">wind_categ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">input_AHM</span><span class="op">$</span><span class="va">obsCovs</span><span class="op">$</span><span class="va">wind</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"windy"</span>, <span class="st">"calm"</span><span class="op">)</span>

<span class="co"># result is a character matrix:</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">input_AHM</span><span class="op">$</span><span class="va">obsCovs</span><span class="op">$</span><span class="va">wind_categ</span><span class="op">)</span></code></pre></div>
<pre><code>##  chr [1:30, 1:5] "calm" "calm" "windy" "windy" "calm" "calm" "windy" "calm" ...</code></pre>
<p>Model example:</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_categ2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model_jags_categ2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"wind_categ"</span><span class="op">)</span><span class="op">)</span>,     <span class="co"># "wind_categ" now</span>
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_categ2</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c4b143108.txt</code></pre>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_ahm_jags_categ2</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model_jags_categ2</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>,
                         compile <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
<pre><code>## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</code></pre>
<pre><code>## sfExportAll() ignored in sequential mode.</code></pre>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## Warning in rjags::jags.model(file = object@modelFile, data = object@data, :
## Unused variable "wind_categ" in data</code></pre>
<pre><code>## NOTE: Stopping adaptation</code></pre>
<pre><code>## Warning in rjags::jags.model(file = object@modelFile, data = object@data, :
## Unused variable "wind_categ" in data</code></pre>
<pre><code>## NOTE: Stopping adaptation</code></pre>
<pre><code>## Warning in rjags::jags.model(file = object@modelFile, data = object@data, :
## Unused variable "wind_categ" in data</code></pre>
<pre><code>## NOTE: Stopping adaptation</code></pre>
<p>Model estimates. As above, the estimates for the first factor level are 0. The relevant parameters here are called <code>alpha.obs.ranef.categ.wind_categ</code>.</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_categ2</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-6fd04e36d38cb187c762" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6fd04e36d38cb187c762">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.categ.wind_categ[1,1]","alpha.obs.ranef.categ.wind_categ[2,1]","alpha.obs.ranef.categ.wind_categ[3,1]","alpha.obs.ranef.categ.wind_categ[4,1]","alpha.obs.ranef.categ.wind_categ[5,1]","alpha.obs.ranef.categ.wind_categ[6,1]","alpha.obs.ranef.categ.wind_categ[7,1]","alpha.obs.ranef.categ.wind_categ[8,1]","alpha.obs.ranef.categ.wind_categ[9,1]","alpha.obs.ranef.categ.wind_categ[10,1]","alpha.obs.ranef.categ.wind_categ[11,1]","alpha.obs.ranef.categ.wind_categ[12,1]","alpha.obs.ranef.categ.wind_categ[13,1]","alpha.obs.ranef.categ.wind_categ[14,1]","alpha.obs.ranef.categ.wind_categ[15,1]","alpha.obs.ranef.categ.wind_categ[16,1]","alpha.obs.ranef.categ.wind_categ[17,1]","alpha.obs.ranef.categ.wind_categ[18,1]","alpha.obs.ranef.categ.wind_categ[19,1]","alpha.obs.ranef.categ.wind_categ[1,2]","alpha.obs.ranef.categ.wind_categ[2,2]","alpha.obs.ranef.categ.wind_categ[3,2]","alpha.obs.ranef.categ.wind_categ[4,2]","alpha.obs.ranef.categ.wind_categ[5,2]","alpha.obs.ranef.categ.wind_categ[6,2]","alpha.obs.ranef.categ.wind_categ[7,2]","alpha.obs.ranef.categ.wind_categ[8,2]","alpha.obs.ranef.categ.wind_categ[9,2]","alpha.obs.ranef.categ.wind_categ[10,2]","alpha.obs.ranef.categ.wind_categ[11,2]","alpha.obs.ranef.categ.wind_categ[12,2]","alpha.obs.ranef.categ.wind_categ[13,2]","alpha.obs.ranef.categ.wind_categ[14,2]","alpha.obs.ranef.categ.wind_categ[15,2]","alpha.obs.ranef.categ.wind_categ[16,2]","alpha.obs.ranef.categ.wind_categ[17,2]","alpha.obs.ranef.categ.wind_categ[18,2]","alpha.obs.ranef.categ.wind_categ[19,2]","alpha.obs.ranef.categ.wind_categ.mean[1]","alpha.obs.ranef.categ.wind_categ.mean[2]","alpha.obs.ranef.categ.wind_categ.sigma[1]","alpha.obs.ranef.categ.wind_categ.sigma[2]","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.fixed.cont.habitat","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.444,0.392,0.542,0.601,0.301,0.412,0.405,0.562,0.588,0.51,0.216,0.294,0.294,0.66,0.477,0.732,0.386,0.588,0.575,0.523,19,3.65,2.221,0.955,3.034,3.926,3.976,2.766,0.845,3.11,0.894,2.854,2.331,0.985,2.37,1.931,1.918,1.415,1.824,1.416,42.42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.946,-0.193,-0.061,-0.884,-0.15,-0.844,-0.689,-0.693,-0.447,0.214,0.306,0.217,-0.92,-1.098,-0.381,-0.105,-0.458,-0.658,-0.374,0,-0.336,0,0.825,-1.885,-1.022,-0.602,-1.505,-1.429,0.012,-0.758,1.101,-0.87,0.223,-1.914,-2.111,0.325,-1.154,-0.731,-0.372,-1.181,-1.285,-2.054,-0.915,1.12,0.275,-0.589,-1.314,-2.033,-0.696,-0.64,0.121,-1.176,-1.001,-0.955,-0.808,-0.879,-1.084,-1.702,-1.205,-1.59,-1.086,-1.872,-1.52,-1.638,-1.135,0.734,4.089,1.924,0.55,3.646,4.285,4.539,2.545,0.834,3.117,1.562,3.283,2.769,0.531,2.42,1.348,2.025,0.87,1.535,1.114,42.987],[0.499,0.49,0.5,0.491,0.46,0.494,0.493,0.498,0.494,0.502,0.413,0.457,0.457,0.475,0.501,0.444,0.488,0.494,0.496,0.501,0,2.153,1.88,1.284,1.895,2.032,2.176,1.98,0.853,2.142,1.253,1.721,1.324,1.42,1.825,1.756,1.916,1.438,1.427,1.163,9.469,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.797,0.637,0.76,0.708,0.5,0.368,0.647,0.508,0.544,0.552,0.755,0.75,0.943,0.78,0.621,0.491,0.771,0.754,0.737,0,0.296,0,0.379,0.586,0.667,0.851,0.572,0.533,0.312,0.496,0.409,0.57,0.345,0.761,0.706,0.583,0.778,0.669,0.437,0.907,0.709,1.064,0.368,0.294,0.141,0.507,0.511,0.568,0.598,0.533,0.419,0.484,0.369,0.499,0.385,0.538,0.521,0.495,0.586,0.522,0.451,0.66,0.593,0.632,0.224,0.244,1.898,1.398,0.828,1.332,1.851,2.167,1.647,0.773,1.725,1.423,1.291,1.189,0.645,1.488,1.247,1.473,0.936,1.102,0.952,6.405],[0.04,0.04,0.04,0.04,0.037,0.04,0.04,0.04,0.04,0.041,0.033,0.037,0.037,0.038,0.041,0.036,0.039,0.04,0.04,0.041,0,0.174,0.152,0.104,0.153,0.164,0.176,0.16,0.069,0.173,0.101,0.139,0.107,0.115,0.148,0.142,0.155,0.116,0.115,0.094,0.766,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.064,0.052,0.061,0.057,0.04,0.03,0.052,0.041,0.044,0.045,0.061,0.061,0.076,0.063,0.05,0.04,0.062,0.061,0.06,0,0.024,0,0.031,0.047,0.054,0.069,0.046,0.043,0.025,0.04,0.033,0.046,0.028,0.062,0.057,0.047,0.063,0.054,0.035,0.073,0.057,0.086,0.03,0.024,0.011,0.041,0.041,0.046,0.048,0.043,0.034,0.039,0.03,0.04,0.031,0.044,0.042,0.04,0.047,0.042,0.036,0.053,0.048,0.051,0.018,0.02,0.153,0.113,0.067,0.108,0.15,0.175,0.133,0.062,0.139,0.115,0.104,0.096,0.052,0.12,0.101,0.119,0.076,0.089,0.077,0.518],[0.04,0.039,0.038,0.04,0.037,0.04,0.04,0.039,0.042,0.038,0.033,0.029,0.037,0.032,0.041,0.039,0.04,0.034,0.04,0.041,0,0.214,0.153,0.131,0.154,0.165,0.177,0.159,0.079,0.224,0.101,0.14,0.098,0.115,0.148,0.153,0.148,0.132,0.129,0.094,1.164,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.098,0.051,0.068,0.08,0.043,0.031,0.052,0.037,0.049,0.048,0.079,0.079,0.094,0.073,0.07,0.036,0.063,0.057,0.063,0,0.027,0,0.043,0.062,0.054,0.068,0.064,0.047,0.025,0.044,0.03,0.051,0.03,0.094,0.063,0.041,0.073,0.054,0.036,0.095,0.058,0.12,0.035,0.027,0.01,0.046,0.041,0.054,0.044,0.053,0.046,0.039,0.035,0.045,0.031,0.043,0.058,0.043,0.052,0.042,0.035,0.053,0.057,0.067,0.021,0.024,0.153,0.137,0.07,0.108,0.149,0.176,0.134,0.068,0.14,0.116,0.094,0.084,0.052,0.129,0.101,0.12,0.076,0.089,0.136,0.61]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Plot the results:</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">model_jags_categ2</span>, 
             mcmc.list <span class="op">=</span> <span class="va">out_ahm_jags_categ2</span>,
             submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code>## $wind_categ</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_coef,commOccu-method.html">plot_coef</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">model_jags_categ2</span>, 
          mcmc.list <span class="op">=</span> <span class="va">out_ahm_jags_categ2</span>,
          submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></code></pre></div>
<pre><code>## Currently coefficients of categorical covariates may not be sorted correctly. This is a known limitation.</code></pre>
<pre><code>## $wind_categ</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-48-2.png" width="700"></p>
</div>
</div>
<div id="random-effects-other-than-species" class="section level2">
<h2 class="hasAnchor">
<a href="#random-effects-other-than-species" class="anchor"></a>Random effects other than species</h2>
<p>By default random effects are by species. Alternatively, you can specify random effects of a categorical site covariate2 on continous covariate1 using the pattern:</p>
<p>occuCovs(ranef = c(“covariate1|covariate2”))</p>
<p>The same syntax can be used in</p>
<p>detCovs(ranef = c(“covariate1|covariate2”))</p>
<p>and</p>
<p>detCovs(ranef = c(“covariate1|covariate2”))</p>
<p>Here is an example, where the effect of “habitat” differs between levels of “categ”.</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_ranef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_ranef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"habitat|categ"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_ranef</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c13a66ca7.txt</code></pre>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_ranef</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_ranef</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code>## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</code></pre>
<pre><code>## sfExportAll() ignored in sequential mode.</code></pre>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation</code></pre>
<p>Search for the term “habitat_categ” in the table below. There are 2 estimates (for stations with “A” and “B”), plus the mean and sigma of the random effect (this is only for demonstration, 2 factor levels is of course not enough for applying random effects).</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_ranef</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-1f286ccd8d37168cb531" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1f286ccd8d37168cb531">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat_categ[1]","beta.ranef.cont.habitat_categ[2]","beta.ranef.cont.habitat_categ.mean","beta.ranef.cont.habitat_categ.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.542,0.333,0.471,0.66,0.216,0.444,0.451,0.725,0.575,0.542,0.183,0.32,0.281,0.739,0.458,0.68,0.497,0.582,0.569,0.451,19,3.322,2.256,1.14,2.929,3.791,4.11,3.439,0.908,2.92,0.922,2.522,2.306,1.182,2.263,2.019,2.241,1.414,1.762,1.217,42.665,1.178,0.002,-0.204,-0.119,0.313,-0.794,-0.586,-0.946,-0.404,0.181,0.96,0.468,-1.332,-0.947,-0.5,-0.054,-0.668,-0.513,-0.351,-0.248,0.848,-1.552,-1.173,-0.819,-1.848,-1.613,-0.518,-1.312,0.733,-1.09,0.279,-1.972,-2.075,-0.677,-1.719,-1.075,-0.465,-1.398,-1.863,-2.204,-1.157,1.024,0.142,0.498,0.282,1.266,-0.674,-1.418,-2.14,-0.867,-0.731,-0.014,-1.193,-1.113,-1.088,-0.987,-1.03,-1.11,-1.7,-1.311,-1.594,-1.067,-1.946,-1.607,-1.717,-1.215,0.747,3.962,2.128,0.657,3.616,4.053,4.398,2.618,0.836,2.744,1.466,3.036,2.78,0.605,2.129,1.49,1.935,0.932,1.527,1.147,42.058],[0.5,0.473,0.501,0.475,0.413,0.499,0.499,0.448,0.496,0.5,0.388,0.468,0.451,0.441,0.5,0.468,0.502,0.495,0.497,0.499,0,2.237,1.973,1.403,1.81,1.873,2.116,2.044,1.05,1.859,1.157,1.676,1.459,1.187,1.601,1.697,2.102,1.503,1.471,0.902,8.173,0.57,0.393,0.609,0.408,0.35,0.264,0.364,0.404,0.376,0.338,0.584,0.538,0.624,0.484,0.614,0.346,0.684,0.582,0.689,0.251,0.239,0.413,0.559,0.971,0.546,0.459,0.25,0.528,0.371,0.458,0.335,0.602,0.608,0.68,0.544,0.606,0.369,0.898,0.781,0.974,0.311,0.27,0.205,0.303,1.295,1.467,0.498,0.536,0.706,0.581,0.456,0.458,0.542,0.393,0.465,0.384,0.574,0.623,0.439,0.569,0.533,0.414,0.702,0.649,0.623,0.252,0.217,1.737,1.459,0.956,1.511,1.746,2.149,1.762,0.903,1.569,1.19,1.42,1.307,0.712,1.262,1.237,1.437,1.041,1.161,0.797,6.858],[0.04,0.038,0.04,0.038,0.033,0.04,0.04,0.036,0.04,0.04,0.031,0.038,0.036,0.036,0.04,0.038,0.041,0.04,0.04,0.04,0,0.181,0.16,0.113,0.146,0.151,0.171,0.165,0.085,0.15,0.094,0.135,0.118,0.096,0.129,0.137,0.17,0.122,0.119,0.073,0.661,0.046,0.032,0.049,0.033,0.028,0.021,0.029,0.033,0.03,0.027,0.047,0.044,0.05,0.039,0.05,0.028,0.055,0.047,0.056,0.02,0.019,0.033,0.045,0.078,0.044,0.037,0.02,0.043,0.03,0.037,0.027,0.049,0.049,0.055,0.044,0.049,0.03,0.073,0.063,0.079,0.025,0.022,0.017,0.024,0.105,0.119,0.04,0.043,0.057,0.047,0.037,0.037,0.044,0.032,0.038,0.031,0.046,0.05,0.035,0.046,0.043,0.033,0.057,0.052,0.05,0.02,0.018,0.14,0.118,0.077,0.122,0.141,0.174,0.142,0.073,0.127,0.096,0.115,0.106,0.058,0.102,0.1,0.116,0.084,0.094,0.064,0.554],[0.04,0.037,0.041,0.039,0.054,0.04,0.04,0.039,0.04,0.049,0.031,0.034,0.037,0.033,0.042,0.038,0.041,0.036,0.047,0.04,0,0.191,0.169,0.114,0.279,0.154,0.19,0.18,0.083,0.151,0.094,0.135,0.111,0.087,0.129,0.168,0.161,0.128,0.119,0.071,0.797,0.043,0.032,0.049,0.032,0.026,0.021,0.044,0.032,0.033,0.028,0.077,0.044,0.051,0.048,0.049,0.028,0.049,0.044,0.069,0.02,0.024,0.033,0.042,0.079,0.044,0.046,0.019,0.039,0.03,0.034,0.033,0.049,0.041,0.057,0.05,0.048,0.028,0.082,0.067,0.117,0.027,0.028,0.021,0.027,0.105,0.162,0.043,0.049,0.057,0.062,0.042,0.042,0.041,0.032,0.034,0.03,0.06,0.064,0.036,0.046,0.04,0.041,0.061,0.052,0.06,0.023,0.025,0.14,0.121,0.071,0.134,0.135,0.182,0.142,0.072,0.126,0.096,0.108,0.094,0.058,0.107,0.1,0.155,0.11,0.105,0.062,0.532]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Currently random effects other than species can not be plotted with plot_effects and plot_coef.</p>
</div>
<div id="nested-random-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#nested-random-effects" class="anchor"></a>Nested random effects</h2>
<p>Consider a numeric covariate1 and categorical covariate2. Use the keyword “+Species” to specify a species-specific random effect within each factor level of covariate2:</p>
<p>occuCovs(ranef = c(“covariate1|covariate2+Species”))</p>
<p>Here is an example, with independent random effect of “categ” on “habitat” for each species:</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"habitat|categ+Species"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_nested</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432ccac162e.txt</code></pre>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_nested</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_nested</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code>## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</code></pre>
<pre><code>## sfExportAll() ignored in sequential mode.</code></pre>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation</code></pre>
<p>Search for the term “habitat_categ_Species” in the table below.</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_nested</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-24055a9e7105f7fdee46" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-24055a9e7105f7fdee46">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat_categ_Species[1,1]","beta.ranef.cont.habitat_categ_Species[2,1]","beta.ranef.cont.habitat_categ_Species[3,1]","beta.ranef.cont.habitat_categ_Species[4,1]","beta.ranef.cont.habitat_categ_Species[5,1]","beta.ranef.cont.habitat_categ_Species[6,1]","beta.ranef.cont.habitat_categ_Species[7,1]","beta.ranef.cont.habitat_categ_Species[8,1]","beta.ranef.cont.habitat_categ_Species[9,1]","beta.ranef.cont.habitat_categ_Species[10,1]","beta.ranef.cont.habitat_categ_Species[11,1]","beta.ranef.cont.habitat_categ_Species[12,1]","beta.ranef.cont.habitat_categ_Species[13,1]","beta.ranef.cont.habitat_categ_Species[14,1]","beta.ranef.cont.habitat_categ_Species[15,1]","beta.ranef.cont.habitat_categ_Species[16,1]","beta.ranef.cont.habitat_categ_Species[17,1]","beta.ranef.cont.habitat_categ_Species[18,1]","beta.ranef.cont.habitat_categ_Species[19,1]","beta.ranef.cont.habitat_categ_Species[1,2]","beta.ranef.cont.habitat_categ_Species[2,2]","beta.ranef.cont.habitat_categ_Species[3,2]","beta.ranef.cont.habitat_categ_Species[4,2]","beta.ranef.cont.habitat_categ_Species[5,2]","beta.ranef.cont.habitat_categ_Species[6,2]","beta.ranef.cont.habitat_categ_Species[7,2]","beta.ranef.cont.habitat_categ_Species[8,2]","beta.ranef.cont.habitat_categ_Species[9,2]","beta.ranef.cont.habitat_categ_Species[10,2]","beta.ranef.cont.habitat_categ_Species[11,2]","beta.ranef.cont.habitat_categ_Species[12,2]","beta.ranef.cont.habitat_categ_Species[13,2]","beta.ranef.cont.habitat_categ_Species[14,2]","beta.ranef.cont.habitat_categ_Species[15,2]","beta.ranef.cont.habitat_categ_Species[16,2]","beta.ranef.cont.habitat_categ_Species[17,2]","beta.ranef.cont.habitat_categ_Species[18,2]","beta.ranef.cont.habitat_categ_Species[19,2]","beta.ranef.cont.habitat_categ_Species.mean[1]","beta.ranef.cont.habitat_categ_Species.mean[2]","beta.ranef.cont.habitat_categ_Species.mean[3]","beta.ranef.cont.habitat_categ_Species.mean[4]","beta.ranef.cont.habitat_categ_Species.mean[5]","beta.ranef.cont.habitat_categ_Species.mean[6]","beta.ranef.cont.habitat_categ_Species.mean[7]","beta.ranef.cont.habitat_categ_Species.mean[8]","beta.ranef.cont.habitat_categ_Species.mean[9]","beta.ranef.cont.habitat_categ_Species.mean[10]","beta.ranef.cont.habitat_categ_Species.mean[11]","beta.ranef.cont.habitat_categ_Species.mean[12]","beta.ranef.cont.habitat_categ_Species.mean[13]","beta.ranef.cont.habitat_categ_Species.mean[14]","beta.ranef.cont.habitat_categ_Species.mean[15]","beta.ranef.cont.habitat_categ_Species.mean[16]","beta.ranef.cont.habitat_categ_Species.mean[17]","beta.ranef.cont.habitat_categ_Species.mean[18]","beta.ranef.cont.habitat_categ_Species.mean[19]","beta.ranef.cont.habitat_categ_Species.sigma[1]","beta.ranef.cont.habitat_categ_Species.sigma[2]","beta.ranef.cont.habitat_categ_Species.sigma[3]","beta.ranef.cont.habitat_categ_Species.sigma[4]","beta.ranef.cont.habitat_categ_Species.sigma[5]","beta.ranef.cont.habitat_categ_Species.sigma[6]","beta.ranef.cont.habitat_categ_Species.sigma[7]","beta.ranef.cont.habitat_categ_Species.sigma[8]","beta.ranef.cont.habitat_categ_Species.sigma[9]","beta.ranef.cont.habitat_categ_Species.sigma[10]","beta.ranef.cont.habitat_categ_Species.sigma[11]","beta.ranef.cont.habitat_categ_Species.sigma[12]","beta.ranef.cont.habitat_categ_Species.sigma[13]","beta.ranef.cont.habitat_categ_Species.sigma[14]","beta.ranef.cont.habitat_categ_Species.sigma[15]","beta.ranef.cont.habitat_categ_Species.sigma[16]","beta.ranef.cont.habitat_categ_Species.sigma[17]","beta.ranef.cont.habitat_categ_Species.sigma[18]","beta.ranef.cont.habitat_categ_Species.sigma[19]","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.634,0.582,0.458,0.627,0.216,0.641,0.516,0.752,0.438,0.536,0.294,0.379,0.346,0.706,0.549,0.634,0.405,0.608,0.608,0.51,19,5.493,2.249,1.155,2.839,6.932,4.482,3.707,0.762,3.033,1.272,2.302,2.733,1.047,3.114,1.731,2.183,1.754,2.173,1.509,50.469,1.058,0.023,-0.237,-0.315,0.323,-0.843,-0.596,-0.949,-0.371,0.165,0.677,0.343,-1.281,-1.008,-0.64,-0.107,-0.845,-0.586,-0.435,-0.293,0.8,-1.843,-1.175,-0.796,-1.837,-2.151,-0.537,-1.414,0.762,-1.178,0.231,-1.907,-2.181,-0.625,-2.068,-1.022,-0.458,-1.833,-1.982,-2.403,-1.296,1.139,-2.448,0.471,4.566,11.695,-13.291,1.348,0.469,-1.039,0.426,-1.481,5.82,1.367,-0.28,4.226,1.974,0.453,6.701,0.438,12.343,-1.016,-3.588,-1.101,8.337,7.672,1.893,-0.323,-0.606,-0.052,-0.801,6.462,1.909,-0.83,6.639,-0.539,0.689,5.033,1.316,6.299,-1.248,-0.832,0.999,4.052,-0.862,1.593,-0.035,-0.65,0.337,-1.225,4.561,1.372,-0.373,3.933,0.883,0.366,2.103,0.681,2.732,2.472,4.822,5.432,12.706,12.413,1.605,2.659,2.104,1.495,1.883,3.875,1.894,1.999,4.354,3.014,1.601,10.939,1.686,11.317,-0.767,-1.216,-1.836,-0.524,-0.579,0.691,-0.978,-1.51,-0.97,-1.511,-1.685,-0.902,-1.95,-0.982,-1.461,-1.017,-1.767,-1.691,-1.962,-1.166,1.001,5.239,2.065,0.703,3.682,6.377,4.224,2.723,0.877,2.876,1.537,2.592,3.053,0.617,2.767,1.383,2.291,1.406,1.899,1.376,47.688],[0.483,0.495,0.5,0.485,0.413,0.481,0.501,0.433,0.498,0.5,0.457,0.487,0.477,0.457,0.499,0.483,0.493,0.49,0.49,0.502,0,2.447,1.922,1.555,1.067,2.494,1.783,2.23,0.872,2.018,1.674,1.167,1.555,1.168,1.23,1.616,2.288,1.556,1.59,1.165,8.386,0.441,0.432,0.689,0.396,0.346,0.223,0.417,0.379,0.376,0.311,0.553,0.527,0.603,0.449,0.513,0.351,0.624,0.498,0.626,0.225,0.205,0.474,0.59,1.03,0.485,0.444,0.241,0.581,0.41,0.462,0.323,0.55,0.63,0.65,0.575,0.57,0.375,0.943,0.806,0.957,0.309,0.264,2.596,1.227,4.296,11.961,20.488,0.757,1.18,0.603,0.872,0.815,3.27,1.594,0.779,2.253,1.876,0.733,6.723,1.187,19.578,1.489,4.499,3.576,5.795,17.133,1.438,1.776,1.125,1.115,1.195,3.846,2.06,1.356,5.821,1.829,1.293,11.208,1.683,7.316,2,2.56,2.851,3.854,3.057,1.478,1.976,1.708,1.327,1.66,3.213,1.935,1.479,2.521,1.986,1.328,3.226,1.538,3.514,3.629,6.533,7.862,26.043,20.175,1.958,9.229,4.171,2.165,2.73,6.621,2.001,3.351,8.599,3.217,2.256,23.377,1.998,20.299,0.755,0.613,0.978,0.79,0.928,0.771,0.697,0.483,0.614,0.599,0.809,0.912,0.656,0.758,0.669,0.48,0.927,0.952,1.106,0.316,0.359,2.065,1.49,1.071,1.151,1.921,2.053,1.669,0.761,1.799,1.304,1.228,1.48,0.943,1.089,1.217,1.733,1.242,1.374,0.942,6.934],[0.039,0.04,0.04,0.039,0.033,0.039,0.041,0.035,0.04,0.04,0.037,0.039,0.039,0.037,0.04,0.039,0.04,0.04,0.04,0.041,0,0.198,0.155,0.126,0.086,0.202,0.144,0.18,0.071,0.163,0.135,0.094,0.126,0.094,0.099,0.131,0.185,0.126,0.129,0.094,0.678,0.036,0.035,0.056,0.032,0.028,0.018,0.034,0.031,0.03,0.025,0.045,0.043,0.049,0.036,0.041,0.028,0.05,0.04,0.051,0.018,0.017,0.038,0.048,0.083,0.039,0.036,0.019,0.047,0.033,0.037,0.026,0.044,0.051,0.053,0.046,0.046,0.03,0.076,0.065,0.077,0.025,0.021,0.21,0.099,0.347,0.967,1.656,0.061,0.095,0.049,0.071,0.066,0.264,0.129,0.063,0.182,0.152,0.059,0.544,0.096,1.583,0.12,0.364,0.289,0.469,1.385,0.116,0.144,0.091,0.09,0.097,0.311,0.167,0.11,0.471,0.148,0.105,0.906,0.136,0.591,0.162,0.207,0.23,0.312,0.247,0.12,0.16,0.138,0.107,0.134,0.26,0.156,0.12,0.204,0.161,0.107,0.261,0.124,0.284,0.293,0.528,0.636,2.105,1.631,0.158,0.746,0.337,0.175,0.221,0.535,0.162,0.271,0.695,0.26,0.182,1.89,0.162,1.641,0.061,0.05,0.079,0.064,0.075,0.062,0.056,0.039,0.05,0.048,0.065,0.074,0.053,0.061,0.054,0.039,0.075,0.077,0.089,0.026,0.029,0.167,0.12,0.087,0.093,0.155,0.166,0.135,0.061,0.145,0.105,0.099,0.12,0.076,0.088,0.098,0.14,0.1,0.111,0.076,0.561],[0.047,0.04,0.041,0.039,0.031,0.043,0.037,0.034,0.036,0.035,0.036,0.04,0.043,0.039,0.044,0.036,0.045,0.039,0.042,0.038,0,0.308,0.14,0.316,0.089,0.36,0.145,0.227,0.092,0.163,0.133,0.098,0.183,0.105,0.128,0.185,0.238,0.259,0.216,0.114,0.934,0.036,0.035,0.075,0.032,0.027,0.018,0.027,0.031,0.028,0.021,0.05,0.056,0.049,0.036,0.042,0.025,0.057,0.039,0.056,0.016,0.019,0.049,0.042,0.152,0.037,0.056,0.018,0.056,0.03,0.037,0.026,0.042,0.066,0.052,0.051,0.046,0.027,0.19,0.075,0.098,0.027,0.021,0.659,0.152,0.626,3.243,3.455,0.066,0.179,0.049,0.078,0.075,0.285,0.23,0.068,0.303,0.13,0.064,1.627,0.094,6.489,0.213,0.705,0.524,1.34,4.711,0.163,0.208,0.114,0.099,0.083,0.452,0.267,0.122,1.112,0.203,0.117,3.273,0.16,1.688,0.191,0.258,0.355,0.365,0.293,0.136,0.171,0.117,0.123,0.158,0.287,0.171,0.135,0.279,0.161,0.108,0.263,0.137,0.417,0.386,0.601,0.642,4.201,4.387,0.18,0.746,0.339,0.176,0.22,0.838,0.189,0.393,0.955,0.284,0.182,3.518,0.187,5.053,0.074,0.044,0.163,0.054,0.086,0.096,0.067,0.041,0.045,0.049,0.064,0.145,0.056,0.061,0.055,0.044,0.118,0.12,0.107,0.029,0.061,0.314,0.122,0.173,0.095,0.219,0.165,0.173,0.058,0.146,0.097,0.125,0.135,0.083,0.152,0.098,0.156,0.21,0.152,0.091,0.593]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Currently nested random effects can not be plotted with plot_effects and plot_coef.</p>
</div>
<div id="quadratic-covariate-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#quadratic-covariate-effects" class="anchor"></a>Quadratic covariate effects</h2>
<p>The easiest way to include quadratic effects is by squaring the covariate and including it as a new covariate. The plot_* and predict methods will be able to identify the quadratic term via a required keyword (the suffix “_squared” by default).</p>
<p>Covariates should be scaled to prior to squaring (“habitat” in this examples is already scaled).</p>
<p>Create quadratic covariate</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">input_AHM</span><span class="op">$</span><span class="va">siteCovs</span><span class="op">$</span><span class="va">habitat_squared</span> <span class="op">&lt;-</span> <span class="va">input_AHM</span><span class="op">$</span><span class="va">siteCovs</span><span class="op">$</span><span class="va">habitat</span> <span class="op">^</span><span class="fl">2</span></code></pre></div>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_quadratic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>



<span class="va">model1_jags_quadratic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"habitat"</span>, <span class="st">"habitat_squared"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_quadratic</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c53236d2a.txt</code></pre>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_nested</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_quadratic</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code>## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</code></pre>
<pre><code>## sfExportAll() ignored in sequential mode.</code></pre>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation
## 
## 
## NOTE: Stopping adaptation</code></pre>
<p>Thanks to to keyword “_squared”, <code>plot_effects</code> will combine the effects of “habitat” and “habitat_squared” in response curves.</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_effects,commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">model1_jags_quadratic</span>, 
             <span class="va">out_ahm_jags_nested</span><span class="op">)</span></code></pre></div>
<pre><code>## $habitat</code></pre>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-55-1.png" width="700"></p>
<p>The data have no quadratic relationship with covariates, hence the quadratic effects are rather weak</p>
</div>
<div id="waic" class="section level2">
<h2 class="hasAnchor">
<a href="#waic" class="anchor"></a>WAIC</h2>
<p>Nimble models can return WAIC. Set argument <code>fit(..., WAIC = TRUE)</code>.</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_ahm_nimble3</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_nimble</span>, 
                       n.iter <span class="op">=</span> <span class="fl">500</span>,
                       n.burnin <span class="op">=</span> <span class="fl">250</span>,
                       thin <span class="op">=</span> <span class="fl">5</span>,
                       chains <span class="op">=</span> <span class="fl">3</span>,
                       compile <span class="op">=</span> <span class="cn">TRUE</span>,
                       quiet <span class="op">=</span> <span class="cn">F</span>, 
                       WAIC <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<pre><code>## Defining model</code></pre>
<pre><code>## Warning in checkForDeterministicDorR(code[[i]]): Model includes deterministic
## assignment using '&lt;-' of the result of a density ('d') or simulation ('r')
## calculation. This is likely not what you intended in: new.y[i, j, 1:maxocc] &lt;-
## rOcc_v(n = 1, probOcc = psi[i, j], probDetect = p.eff[i, j, 1:maxocc], len =
## maxocc).</code></pre>
<pre><code>##   [Note] Using 'y' (given within 'constants') as data.</code></pre>
<pre><code>## Building model</code></pre>
<pre><code>## Setting data and initial values</code></pre>
<pre><code>## Running calculate on model
##   [Note] Any error reports that follow may simply reflect missing values in model variables.</code></pre>
<pre><code>## Error in if (u &gt; probOcc) return(nimNumeric(0, length = k)) : 
##   missing value where TRUE/FALSE needed</code></pre>
<pre><code>## Checking model sizes and dimensions</code></pre>
<pre><code>##   [Note] This model is not fully initialized. This is not an error.
##          To see which variables are not initialized, use model$initializeInfo().
##          For more information on model initialization, see help(modelInitialization).</code></pre>
<pre><code>## ===== Monitors =====
## thin = 5: alpha.obs.ranef.cont.wind, alpha.obs.ranef.cont.wind.mean, alpha.obs.ranef.cont.wind.sigma, alpha0, alpha0.mean, alpha0.sigma, beta.ranef.cont.habitat, beta.ranef.cont.habitat.mean, beta.ranef.cont.habitat.sigma, beta0, beta0.mean, beta0.sigma, Bpvalue, Bpvalue_species, new.R2, new.R3, R2, R3
## ===== Samplers =====
## RW sampler (76)
##   - beta0[]  (19 elements)
##   - alpha0[]  (19 elements)
##   - alpha.obs.ranef.cont.wind[]  (19 elements)
##   - beta.ranef.cont.habitat[]  (19 elements)
## conjugate sampler (8)
##   - beta0.mean
##   - beta0.tau
##   - alpha0.mean
##   - alpha0.tau
##   - alpha.obs.ranef.cont.wind.mean
##   - alpha.obs.ranef.cont.wind.tau
##   - beta.ranef.cont.habitat.mean
##   - beta.ranef.cont.habitat.tau</code></pre>
<pre><code>## Compiling
##   [Note] This may take a minute.
##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</code></pre>
<pre><code>## Compiling
##   [Note] This may take a minute.
##   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</code></pre>
<pre><code>## running chain 1...</code></pre>
<pre><code>## |-------------|-------------|-------------|-------------|
## |-------------------------------------------------------|</code></pre>
<pre><code>## running chain 2...</code></pre>
<pre><code>## |-------------|-------------|-------------|-------------|
## |-------------------------------------------------------|</code></pre>
<pre><code>## running chain 3...</code></pre>
<pre><code>## |-------------|-------------|-------------|-------------|
## |-------------------------------------------------------|
## There are individual pWAIC values that are greater than 0.4. This may indicate that the WAIC estimate is unstable (Vehtari et al., 2017), at least in cases without grouping of data nodes or multivariate data nodes.</code></pre>
<p>The message about “individual pWAIC values that are greater than 0.4” is likely due to the short model run.</p>
<p>If <code>WAIC = TRUE</code>, the output will be a list with 2 elements. The first (“samples”) is the familiar mcmc.list, the second (“WAIC”) is a waicList.</p>
<p>mcmc.list is accessible with $samples:</p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># not printed here</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out_ahm_nimble3</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span></code></pre></div>
<p>WAIC:</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out_ahm_nimble3</span><span class="op">$</span><span class="va">WAIC</span></code></pre></div>
<pre><code>## nimbleList object of type waicList
## Field "WAIC":
## [1] 1069.592
## Field "lppd":
## [1] -492.18
## Field "pWAIC":
## [1] 42.61578</code></pre>
</div>
<div id="species-richness-estimates-for-categorical-covariates" class="section level2">
<h2 class="hasAnchor">
<a href="#species-richness-estimates-for-categorical-covariates" class="anchor"></a>Species richness estimates for categorical covariates</h2>
<p>This is only relevant for JAGS models. Argument “richnessCategories” can be used to calculate separate species richness estimates for different levels of categorical site covariates. If it is not defined, there will only be a global species richness estimate.</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"habitat"</span><span class="op">)</span><span class="op">)</span>, 
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM</span>,
  richnessCategories <span class="op">=</span> <span class="st">"categ"</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_richness</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c19c7261.txt</code></pre>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># short model run for demonstration</span>
<span class="va">out_ahm_jags_rich</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_richness</span>, 
                         n.iter <span class="op">=</span> <span class="fl">500</span>, 
                         n.burnin <span class="op">=</span> <span class="fl">250</span>,
                         thin <span class="op">=</span> <span class="fl">5</span>,
                         chains <span class="op">=</span> <span class="fl">3</span>,
                         cores <span class="op">=</span> <span class="fl">1</span>,
                         quiet <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span></code></pre></div>
<pre><code>## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</code></pre>
<pre><code>## sfExportAll() ignored in sequential mode.</code></pre>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## Warning in rjags::jags.model(file = object@modelFile, data = object@data, :
## Unused variable "categ" in data</code></pre>
<pre><code>## Warning in rjags::jags.model(file = object@modelFile, data = object@data, :
## Unused variable "J2" in data</code></pre>
<pre><code>## NOTE: Stopping adaptation</code></pre>
<pre><code>## Warning in rjags::jags.model(file = object@modelFile, data = object@data, :
## Unused variable "categ" in data

## Warning in rjags::jags.model(file = object@modelFile, data = object@data, :
## Unused variable "J2" in data</code></pre>
<pre><code>## NOTE: Stopping adaptation</code></pre>
<pre><code>## Warning in rjags::jags.model(file = object@modelFile, data = object@data, :
## Unused variable "categ" in data

## Warning in rjags::jags.model(file = object@modelFile, data = object@data, :
## Unused variable "J2" in data</code></pre>
<pre><code>## NOTE: Stopping adaptation</code></pre>
<p>Now search for “Nspecies” in the table below. You will see 3 entries. “Nspecies” is overall, Nspecies_by_category[1] and …[2] are for the stations with category “A” and “B”, respectively.</p>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out_ahm_jags_rich</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-a57b39e9046e368be418" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a57b39e9046e368be418">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species[1]","Bpvalue_species[2]","Bpvalue_species[3]","Bpvalue_species[4]","Bpvalue_species[5]","Bpvalue_species[6]","Bpvalue_species[7]","Bpvalue_species[8]","Bpvalue_species[9]","Bpvalue_species[10]","Bpvalue_species[11]","Bpvalue_species[12]","Bpvalue_species[13]","Bpvalue_species[14]","Bpvalue_species[15]","Bpvalue_species[16]","Bpvalue_species[17]","Bpvalue_species[18]","Bpvalue_species[19]","Nspecies","Nspecies_categ[1]","Nspecies_categ[2]","R2[1]","R2[2]","R2[3]","R2[4]","R2[5]","R2[6]","R2[7]","R2[8]","R2[9]","R2[10]","R2[11]","R2[12]","R2[13]","R2[14]","R2[15]","R2[16]","R2[17]","R2[18]","R2[19]","R3","alpha.obs.ranef.cont.wind[1]","alpha.obs.ranef.cont.wind[2]","alpha.obs.ranef.cont.wind[3]","alpha.obs.ranef.cont.wind[4]","alpha.obs.ranef.cont.wind[5]","alpha.obs.ranef.cont.wind[6]","alpha.obs.ranef.cont.wind[7]","alpha.obs.ranef.cont.wind[8]","alpha.obs.ranef.cont.wind[9]","alpha.obs.ranef.cont.wind[10]","alpha.obs.ranef.cont.wind[11]","alpha.obs.ranef.cont.wind[12]","alpha.obs.ranef.cont.wind[13]","alpha.obs.ranef.cont.wind[14]","alpha.obs.ranef.cont.wind[15]","alpha.obs.ranef.cont.wind[16]","alpha.obs.ranef.cont.wind[17]","alpha.obs.ranef.cont.wind[18]","alpha.obs.ranef.cont.wind[19]","alpha.obs.ranef.cont.wind.mean","alpha.obs.ranef.cont.wind.sigma","alpha0[1]","alpha0[2]","alpha0[3]","alpha0[4]","alpha0[5]","alpha0[6]","alpha0[7]","alpha0[8]","alpha0[9]","alpha0[10]","alpha0[11]","alpha0[12]","alpha0[13]","alpha0[14]","alpha0[15]","alpha0[16]","alpha0[17]","alpha0[18]","alpha0[19]","alpha0.mean","alpha0.sigma","beta.ranef.cont.habitat[1]","beta.ranef.cont.habitat[2]","beta.ranef.cont.habitat[3]","beta.ranef.cont.habitat[4]","beta.ranef.cont.habitat[5]","beta.ranef.cont.habitat[6]","beta.ranef.cont.habitat[7]","beta.ranef.cont.habitat[8]","beta.ranef.cont.habitat[9]","beta.ranef.cont.habitat[10]","beta.ranef.cont.habitat[11]","beta.ranef.cont.habitat[12]","beta.ranef.cont.habitat[13]","beta.ranef.cont.habitat[14]","beta.ranef.cont.habitat[15]","beta.ranef.cont.habitat[16]","beta.ranef.cont.habitat[17]","beta.ranef.cont.habitat[18]","beta.ranef.cont.habitat[19]","beta.ranef.cont.habitat.mean","beta.ranef.cont.habitat.sigma","beta0[1]","beta0[2]","beta0[3]","beta0[4]","beta0[5]","beta0[6]","beta0[7]","beta0[8]","beta0[9]","beta0[10]","beta0[11]","beta0[12]","beta0[13]","beta0[14]","beta0[15]","beta0[16]","beta0[17]","beta0[18]","beta0[19]","beta0.mean","beta0.sigma","new.R2[1]","new.R2[2]","new.R2[3]","new.R2[4]","new.R2[5]","new.R2[6]","new.R2[7]","new.R2[8]","new.R2[9]","new.R2[10]","new.R2[11]","new.R2[12]","new.R2[13]","new.R2[14]","new.R2[15]","new.R2[16]","new.R2[17]","new.R2[18]","new.R2[19]","new.R3"],[0.458,0.359,0.497,0.562,0.229,0.405,0.471,0.647,0.412,0.516,0.229,0.203,0.255,0.725,0.392,0.699,0.464,0.601,0.503,0.536,19,15.601,19,3.647,2.126,0.953,2.305,4.369,4.195,3.291,0.706,2.89,1.003,1.715,2.284,0.889,2.118,1.891,2.23,1.105,1.349,1.257,40.324,1.078,-0.042,-0.171,-0.187,0.309,-0.794,-0.581,-0.932,-0.358,0.144,0.825,0.342,-1.389,-0.97,-0.617,-0.017,-0.81,-0.529,-0.404,-0.29,0.801,-1.536,-1.118,-0.724,-1.748,-1.677,-0.504,-1.279,0.659,-1.106,0.267,-1.786,-2.019,-0.66,-1.646,-1.048,-0.482,-1.473,-1.609,-1.888,-1.106,0.95,-0.52,0.037,0.741,2.05,-0.67,1.009,0.382,-0.645,0.388,-0.797,2.247,1.1,-0.126,1.508,0.705,0.482,0.973,0.691,1.286,0.556,1.165,-0.886,-1.487,-2.305,-0.744,-0.768,0.475,-1.146,-1.329,-1.027,-1.202,-1.253,-1.131,-1.888,-1.288,-1.671,-1.045,-2.157,-1.778,-1.983,-1.287,0.863,4.055,1.941,0.562,3.317,4.51,4.353,2.679,0.829,2.787,1.408,2.601,2.887,0.518,2.152,1.365,2.092,0.803,1.183,1.048,41.09],[0.5,0.481,0.502,0.498,0.421,0.493,0.501,0.479,0.494,0.501,0.421,0.403,0.437,0.448,0.49,0.46,0.5,0.491,0.502,0.5,0,0.982,0,2.129,1.921,1.206,1.233,2.169,1.846,1.77,0.648,2.035,1.244,1.19,1.447,1.003,1.336,1.582,1.862,1.166,1.33,1.054,7.521,0.483,0.384,0.708,0.423,0.359,0.231,0.414,0.414,0.398,0.321,0.603,0.558,0.665,0.502,0.505,0.354,0.699,0.46,0.64,0.202,0.265,0.416,0.529,0.9,0.448,0.459,0.24,0.488,0.366,0.459,0.334,0.535,0.62,0.638,0.569,0.636,0.359,0.829,0.692,0.901,0.282,0.223,0.607,0.595,0.814,0.959,0.737,0.522,0.605,0.49,0.579,0.473,1.017,0.847,0.629,1.001,0.684,0.564,0.955,0.716,1.031,0.37,0.422,0.476,0.528,0.693,0.554,0.605,0.517,0.548,0.467,0.494,0.466,0.587,0.764,0.543,0.509,0.593,0.412,0.745,0.654,0.777,0.266,0.248,1.738,1.369,0.753,1.237,1.713,2.145,1.686,0.785,1.744,1.141,1.184,1.277,0.645,1.152,1.167,1.549,0.813,1.03,0.816,6.296],[0.04,0.039,0.041,0.04,0.034,0.04,0.04,0.039,0.04,0.041,0.034,0.033,0.035,0.036,0.04,0.037,0.04,0.04,0.041,0.04,0,0.079,0,0.172,0.155,0.097,0.1,0.175,0.149,0.143,0.052,0.164,0.101,0.096,0.117,0.081,0.108,0.128,0.151,0.094,0.108,0.085,0.608,0.039,0.031,0.057,0.034,0.029,0.019,0.033,0.033,0.032,0.026,0.049,0.045,0.054,0.041,0.041,0.029,0.057,0.037,0.052,0.016,0.021,0.034,0.043,0.073,0.036,0.037,0.019,0.039,0.03,0.037,0.027,0.043,0.05,0.052,0.046,0.051,0.029,0.067,0.056,0.073,0.023,0.018,0.049,0.048,0.066,0.078,0.06,0.042,0.049,0.04,0.047,0.038,0.082,0.068,0.051,0.081,0.055,0.046,0.077,0.058,0.083,0.03,0.034,0.039,0.043,0.056,0.045,0.049,0.042,0.044,0.038,0.04,0.038,0.047,0.062,0.044,0.041,0.048,0.033,0.06,0.053,0.063,0.022,0.02,0.141,0.111,0.061,0.1,0.138,0.173,0.136,0.063,0.141,0.092,0.096,0.103,0.052,0.093,0.094,0.125,0.066,0.083,0.066,0.509],[0.04,0.039,0.036,0.043,0.034,0.035,0.041,0.039,0.04,0.056,0.034,0.033,0.035,0.047,0.039,0.037,0.037,0.04,0.041,0.041,0,0.1,0,0.186,0.178,0.085,0.09,0.187,0.228,0.143,0.057,0.234,0.117,0.095,0.159,0.082,0.108,0.152,0.151,0.095,0.104,0.086,0.757,0.039,0.031,0.057,0.031,0.029,0.018,0.033,0.043,0.032,0.026,0.076,0.042,0.067,0.04,0.043,0.029,0.052,0.034,0.046,0.014,0.028,0.031,0.049,0.07,0.035,0.039,0.018,0.064,0.032,0.042,0.03,0.047,0.054,0.061,0.042,0.054,0.029,0.066,0.069,0.08,0.026,0.022,0.055,0.047,0.075,0.101,0.063,0.052,0.049,0.04,0.052,0.041,0.121,0.068,0.051,0.113,0.056,0.045,0.079,0.053,0.145,0.027,0.057,0.038,0.046,0.067,0.035,0.055,0.071,0.043,0.029,0.04,0.033,0.044,0.105,0.041,0.041,0.054,0.032,0.07,0.052,0.079,0.024,0.035,0.139,0.123,0.059,0.092,0.139,0.172,0.136,0.082,0.14,0.1,0.101,0.151,0.065,0.094,0.104,0.119,0.066,0.101,0.058,0.787]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="spatial-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-predictions" class="anchor"></a>Spatial predictions</h2>
<p>You can create spatial predictions based on the occupancy models created with <code>communityModel</code>, their model fits and covariate raster stacks.</p>
<p>This requires the raster package</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span></code></pre></div>
<p>In this example we will just create a raster with random numbers.</p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raster_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimMatrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">400</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># add raster to list</span>
  <span class="va">stack_prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>habitat <span class="op">=</span> <span class="va">raster_test</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Species occupancy maps:</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># species occupancy estimates</span>
  <span class="va">predictions_psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span>object    <span class="op">=</span> <span class="va">model1_nimble</span>, 
                             mcmc.list <span class="op">=</span> <span class="va">out_ahm_nimble2</span>,
                             x         <span class="op">=</span> <span class="va">stack_prediction</span>,
                             type      <span class="op">=</span> <span class="st">"psi"</span>,
                             draws     <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">predictions_psi</span><span class="op">$</span><span class="va">mean</span>, zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-63-1.png" width="700"></p>
<p>Species richness maps:</p>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># species richness estimates</span>
  <span class="va">predictions_rich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span>object   <span class="op">=</span> <span class="va">model1_nimble</span>, 
                             mcmc.list <span class="op">=</span> <span class="va">out_ahm_nimble2</span>,
                             x         <span class="op">=</span> <span class="va">stack_prediction</span>,
                             type      <span class="op">=</span> <span class="st">"richness"</span><span class="op">)</span></code></pre></div>
<pre><code>## More than 1000 posterior samples. Watch RAM usageTRUE</code></pre>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">predictions_rich</span><span class="op">)</span></code></pre></div>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-64-1.png" width="700"></p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="co"># mean = mean species richness estimate</span>
  <span class="co"># sd = standard deviation of richness estimate</span></code></pre></div>
<p>In these examples we did not return confidence intervals. Doing so would be easy by setting intervals = “confidence”.</p>
<p>Computation can take long on larger rasters and can require lots of RAM. Check RAM usage during computations.</p>
</div>
<div id="bayesplot" class="section level2">
<h2 class="hasAnchor">
<a href="#bayesplot" class="anchor"></a>bayesplot</h2>
<p>We can also use the powerful bayesplot package for visualizing model estimates. One downside is that it won’t automatically insert the species names.</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/">bayesplot</a></span><span class="op">)</span></code></pre></div>
<p>Here is an example for density plots showing the species-level effects of habitat on occupancy:</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html">mcmc_areas</a></span><span class="op">(</span><span class="va">out_ahm_nimble2</span>, regex_pars <span class="op">=</span> <span class="st">"beta.ranef.cont.habitat"</span><span class="op">)</span></code></pre></div>
<p><img src="camtrapr5_files/figure-html/unnamed-chunk-66-1.png" width="700"></p>
<p>bayesplot has many other visualization options beyond this example.</p>
</div>
<div id="model-diagnostics" class="section level2">
<h2 class="hasAnchor">
<a href="#model-diagnostics" class="anchor"></a>Model diagnostics</h2>
<p>Output of fit() is a coda::mcmc.list, so plot() provides traceplots (not shown here for space reasons):</p>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">out_ahm_nimble2</span><span class="op">)</span></code></pre></div>
<p>The Gelman-Rubin convergence statistic (potential scale reduction factor) can be calculated with <code>gelman.diag</code> from <code>coda</code>:</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gd</span> <span class="op">&lt;-</span> <span class="fu">gelman.diag</span><span class="op">(</span><span class="va">out_ahm_nimble2</span>,  multivariate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">gd</span></code></pre></div>
<pre><code>## Potential scale reduction factors:
## 
##                                 Point est. Upper C.I.
## Bpvalue                              1.003      1.015
## Bpvalue_species[1]                   1.000      1.006
## Bpvalue_species[2]                   1.009      1.036
## Bpvalue_species[3]                   1.009      1.029
## Bpvalue_species[4]                   0.998      0.998
## Bpvalue_species[5]                   0.998      0.999
## Bpvalue_species[6]                   1.002      1.008
## Bpvalue_species[7]                   1.002      1.012
## Bpvalue_species[8]                   1.002      1.014
## Bpvalue_species[9]                   1.003      1.016
## Bpvalue_species[10]                  0.998      0.998
## Bpvalue_species[11]                  1.001      1.009
## Bpvalue_species[12]                  1.001      1.007
## Bpvalue_species[13]                  1.002      1.013
## Bpvalue_species[14]                  0.999      1.000
## Bpvalue_species[15]                  0.999      1.000
## Bpvalue_species[16]                  1.009      1.037
## Bpvalue_species[17]                  1.006      1.020
## Bpvalue_species[18]                  1.002      1.013
## Bpvalue_species[19]                  1.003      1.014
## R2[1]                                1.006      1.008
## R2[2]                                1.003      1.014
## R2[3]                                1.004      1.016
## R2[4]                                1.005      1.023
## R2[5]                                1.000      1.001
## R2[6]                                1.004      1.013
## R2[7]                                1.001      1.003
## R2[8]                                1.001      1.009
## R2[9]                                1.007      1.030
## R2[10]                               1.017      1.056
## R2[11]                               1.010      1.025
## R2[12]                               1.005      1.015
## R2[13]                               1.012      1.042
## R2[14]                               1.005      1.009
## R2[15]                               1.002      1.011
## R2[16]                               1.001      1.010
## R2[17]                               0.998      0.999
## R2[18]                               1.013      1.039
## R2[19]                               1.004      1.012
## R3                                   1.004      1.009
## alpha.obs.ranef.cont.wind[1]         1.004      1.017
## alpha.obs.ranef.cont.wind[2]         0.999      1.003
## alpha.obs.ranef.cont.wind[3]         1.015      1.028
## alpha.obs.ranef.cont.wind[4]         1.001      1.009
## alpha.obs.ranef.cont.wind[5]         1.001      1.004
## alpha.obs.ranef.cont.wind[6]         0.999      1.000
## alpha.obs.ranef.cont.wind[7]         1.012      1.048
## alpha.obs.ranef.cont.wind[8]         1.007      1.025
## alpha.obs.ranef.cont.wind[9]         1.001      1.002
## alpha.obs.ranef.cont.wind[10]        1.004      1.009
## alpha.obs.ranef.cont.wind[11]        1.001      1.004
## alpha.obs.ranef.cont.wind[12]        1.000      1.001
## alpha.obs.ranef.cont.wind[13]        1.002      1.010
## alpha.obs.ranef.cont.wind[14]        1.000      1.003
## alpha.obs.ranef.cont.wind[15]        1.003      1.006
## alpha.obs.ranef.cont.wind[16]        0.999      1.001
## alpha.obs.ranef.cont.wind[17]        1.004      1.009
## alpha.obs.ranef.cont.wind[18]        1.001      1.007
## alpha.obs.ranef.cont.wind[19]        1.005      1.024
## alpha.obs.ranef.cont.wind.mean       0.999      1.001
## alpha.obs.ranef.cont.wind.sigma      1.002      1.006
## alpha0[1]                            1.002      1.009
## alpha0[2]                            1.003      1.014
## alpha0[3]                            1.003      1.011
## alpha0[4]                            1.005      1.022
## alpha0[5]                            0.999      1.000
## alpha0[6]                            1.003      1.010
## alpha0[7]                            1.001      1.004
## alpha0[8]                            1.000      1.005
## alpha0[9]                            1.006      1.026
## alpha0[10]                           1.017      1.056
## alpha0[11]                           1.002      1.008
## alpha0[12]                           1.004      1.012
## alpha0[13]                           1.010      1.037
## alpha0[14]                           1.005      1.007
## alpha0[15]                           1.004      1.016
## alpha0[16]                           1.001      1.009
## alpha0[17]                           0.999      1.002
## alpha0[18]                           1.008      1.029
## alpha0[19]                           1.005      1.009
## alpha0.mean                          1.004      1.020
## alpha0.sigma                         1.000      1.000
## beta.ranef.cont.habitat[1]           1.010      1.024
## beta.ranef.cont.habitat[2]           1.000      1.006
## beta.ranef.cont.habitat[3]           0.999      1.000
## beta.ranef.cont.habitat[4]           1.002      1.007
## beta.ranef.cont.habitat[5]           1.008      1.012
## beta.ranef.cont.habitat[6]           1.006      1.009
## beta.ranef.cont.habitat[7]           1.003      1.014
## beta.ranef.cont.habitat[8]           1.004      1.017
## beta.ranef.cont.habitat[9]           1.000      1.000
## beta.ranef.cont.habitat[10]          1.006      1.009
## beta.ranef.cont.habitat[11]          1.042      1.104
## beta.ranef.cont.habitat[12]          1.008      1.031
## beta.ranef.cont.habitat[13]          1.003      1.010
## beta.ranef.cont.habitat[14]          1.002      1.007
## beta.ranef.cont.habitat[15]          1.009      1.025
## beta.ranef.cont.habitat[16]          1.003      1.009
## beta.ranef.cont.habitat[17]          1.006      1.017
## beta.ranef.cont.habitat[18]          1.007      1.023
## beta.ranef.cont.habitat[19]          1.005      1.017
## beta.ranef.cont.habitat.mean         1.007      1.021
## beta.ranef.cont.habitat.sigma        1.004      1.015
## beta0[1]                             1.001      1.005
## beta0[2]                             1.002      1.008
## beta0[3]                             1.010      1.027
## beta0[4]                             1.010      1.025
## beta0[5]                             1.001      1.003
## beta0[6]                             1.003      1.011
## beta0[7]                             0.999      0.999
## beta0[8]                             1.001      1.008
## beta0[9]                             1.019      1.035
## beta0[10]                            1.002      1.009
## beta0[11]                            1.010      1.025
## beta0[12]                            1.001      1.002
## beta0[13]                            1.009      1.020
## beta0[14]                            1.005      1.005
## beta0[15]                            1.011      1.019
## beta0[16]                            1.016      1.052
## beta0[17]                            1.032      1.059
## beta0[18]                            1.005      1.020
## beta0[19]                            1.000      1.000
## beta0.mean                           1.002      1.004
## beta0.sigma                          1.005      1.024
## new.R2[1]                            1.006      1.013
## new.R2[2]                            1.004      1.019
## new.R2[3]                            1.004      1.012
## new.R2[4]                            1.004      1.017
## new.R2[5]                            1.000      1.000
## new.R2[6]                            0.999      1.000
## new.R2[7]                            1.001      1.004
## new.R2[8]                            1.002      1.013
## new.R2[9]                            1.008      1.034
## new.R2[10]                           1.006      1.028
## new.R2[11]                           1.006      1.016
## new.R2[12]                           1.003      1.010
## new.R2[13]                           1.009      1.035
## new.R2[14]                           1.008      1.011
## new.R2[15]                           1.003      1.013
## new.R2[16]                           1.006      1.026
## new.R2[17]                           0.998      0.999
## new.R2[18]                           1.009      1.029
## new.R2[19]                           1.003      1.010
## new.R3                               1.003      1.006</code></pre>
<p>One can also use <code>gelman.plot</code> to create Gelman-Rubin-Brooks plots (evolution of Gelman-Rubin statistic over iterations):</p>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># not shown here due to space reasons</span>
<span class="fu">gelman.plot</span><span class="op">(</span><span class="va">out_ahm_nimble2</span>,  multivariate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div id="single-species-occupancy-models" class="section level2">
<h2 class="hasAnchor">
<a href="#single-species-occupancy-models" class="anchor"></a>Single-species occupancy models</h2>
<p>The workflow above can be used for single-species models also. The code will be less streamlined and possibly slower than normal code for single-species models (due to the then unnecessary species loop), but it is possible. Simply pass a single detection history in the data_list$ylist of the input to <code>communityModel</code>.</p>
<p>Take care to only define fixed effects for covariates and the intercepts, not random effects of species. It is possible however to specify random effects of categorical site covariates on continuous site covariates as in the example below.</p>
<p>In this example we use species 1 from the community created with simComm.</p>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">input_AHM_sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ylist <span class="op">=</span> <span class="va">ylist</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
                      siteCovs <span class="op">=</span> <span class="va">input_AHM</span><span class="op">$</span><span class="va">siteCovs</span>,
                      obsCovs <span class="op">=</span> <span class="va">input_AHM</span><span class="op">$</span><span class="va">obsCovs</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modelFile_jags_sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span>

<span class="va">model1_jags_ranef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/communityModel.html">communityModel</a></span><span class="op">(</span>
  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html">c</a></span><span class="op">(</span><span class="st">"habitat|categ"</span><span class="op">)</span><span class="op">)</span>,    <span class="co"># response to habitat differs between categ via random effect</span>
  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"wind"</span><span class="op">)</span>,
  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"fixed"</span>, occu <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span>,
  data_list <span class="op">=</span> <span class="va">input_AHM_sp1</span>,
  modelFile <span class="op">=</span> <span class="va">modelFile_jags_sp1</span><span class="op">)</span></code></pre></div>
<pre><code>## Wrote model to C:\Users\Juergen\AppData\Local\Temp\RtmpaIUZzQ\file432c1f596536.txt</code></pre>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_jags_sp1</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">model1_jags_ranef</span>, n.iter <span class="op">=</span> <span class="fl">1000</span>, n.burnin <span class="op">=</span> <span class="fl">500</span>, thin <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## snowfall 1.84-6.1 initialized: sequential execution, one CPU.</code></pre>
<pre><code>## sfExportAll() ignored in sequential mode.</code></pre>
<pre><code>## Warning in snowfall::sfClusterSetupRNG(): Uniform random number streams
## (currently) not available in serial execution. Random numbers may differ in
## serial &amp; parallel execution.</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 150
##    Unobserved stochastic nodes: 187
##    Total graph size: 2113
## 
## Initializing model
## 
## NOTE: Stopping adaptation
## 
## 
## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 150
##    Unobserved stochastic nodes: 187
##    Total graph size: 2113
## 
## Initializing model
## 
## NOTE: Stopping adaptation
## 
## 
## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 150
##    Unobserved stochastic nodes: 187
##    Total graph size: 2113
## 
## Initializing model
## 
## NOTE: Stopping adaptation</code></pre>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_jags_sp1</span><span class="op">)</span><span class="op">$</span><span class="va">statistics</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-96e09d2e16cf633b7848" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-96e09d2e16cf633b7848">{"x":{"filter":"none","vertical":false,"data":[["Bpvalue","Bpvalue_species","Nspecies","R2","R3","alpha.obs.fixed.cont.wind","alpha0","beta.ranef.cont.habitat_categ[1]","beta.ranef.cont.habitat_categ[2]","beta.ranef.cont.habitat_categ.mean","beta.ranef.cont.habitat_categ.sigma","beta0","new.R2","new.R3"],[0.733,0.733,1,6.739,6.739,1.661,-2.377,-2.205,-1.504,-1.508,2.512,0.951,5.623,5.623],[0.443,0.443,0,3.185,3.185,0.707,0.618,2.689,1.849,2.058,4.218,2.789,2.414,2.414],[0.025,0.025,0,0.183,0.183,0.041,0.035,0.154,0.106,0.118,0.242,0.16,0.139,0.139],[0.033,0.033,0,0.448,0.448,0.058,0.07,0.278,0.188,0.172,0.252,0.418,0.307,0.307]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Mean<\/th>\n      <th>SD<\/th>\n      <th>Naive SE<\/th>\n      <th>Time-series SE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>The plot_effects() and plot_coef() functions currently don’t work for this case, since single-species models are mostly a side-effect of the community occupancy workflow and not the main goal. There are other great options for Bayesian single-species occupancy models, e.g. in the packages ubms or wiqid, or unmarked for a frequentist implementation.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Juergen Niedballa, Alexandre Courtiol, Rahel Sollmann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
